<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Expires" content="-1">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="Content-Language" content="zh-CN">
    <meta name="viewport" content="width=1280, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="icon" id="favicon" origin-href="<%= BASE_URL %>favicon.ico">
    <link rel="stylesheet" id="uiTheme" href-pattern="<%= BASE_URL %>theme-XXX<%= VUE_APP_CSS_EXT || '.min.css' %>" href="">
    <title>Loading...</title>
  </head>
  <body>
    <noscript>
      <p>欢迎来到DataFlux Func！请开启JavaScript后继续。</p>
      <p>Welcome to DataFlux Func! Please enable JavaScript and continue.</p>
      <p>DataFlux Func へようこそ、JavaScript をオンにして続きましょう。</p>
    </noscript>
    <div id="app"></div>
    <!-- built files will be auto injected -->
  </body>
  <script>
    (function() {
      // 延迟处理
      var T = setInterval(function() {
        // 等待系统信息加载完毕
        if (!window._DFF_isSystemInfoLoaded) return;

        var vuexData = localStorage.getItem('vuex');
        if (!vuexData) {
          vuexData = {};
        } else if ('string' === typeof vuexData) {
          vuexData = JSON.parse(vuexData);
        }

        var SYSTEM_SETTINGS = vuexData.systemInfo.SYSTEM_SETTINGS;

        // 切换主题
        var uiTheme = vuexData.uiTheme;
        if (uiTheme !== 'dark' && uiTheme !== 'light') uiTheme = 'auto';

        var $uiThemeLink = document.getElementById('uiTheme');
        var cssHref = $uiThemeLink.getAttribute('href-pattern').replace('XXX', uiTheme);
        $uiThemeLink.setAttribute('href', cssHref);

        // 切换 favicon
        var $faviconLink = document.getElementById('favicon');
        if (SYSTEM_SETTINGS['CUSTOM_FAVICON_ENABLED'] && SYSTEM_SETTINGS['CUSTOM_FAVICON_IMAGE_SRC']) {
          $faviconLink.setAttribute('href', SYSTEM_SETTINGS['CUSTOM_FAVICON_IMAGE_SRC']);
        } else {
          var defaultHref = $faviconLink.getAttribute('origin-href');
          // $faviconLink.setAttribute('href', defaultHref);
        }

        // 切换 title
        if (SYSTEM_SETTINGS['CUSTOM_SITE_TITLE_ENABLED'] && SYSTEM_SETTINGS['CUSTOM_SITE_TITLE_TEXT']) {
          document.title = SYSTEM_SETTINGS['CUSTOM_SITE_TITLE_TEXT'];
        } else {
          document.title = 'DataFlux Func';
        }

        clearInterval(T);
      }, 300);
    })();
  </script>
</html>
