(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2fcf0c5e"],{"0fec":function(t,e,a){"use strict";a("d8b4")},"2b8f":function(t,e,a){"use strict";a("7698")},4168:function(t,e,a){"use strict";a.r(e);a("ac1f"),a("5319");var r=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"fade"}},[e("el-container",{directives:[{name:"show",rawName:"v-show",value:t.$store.state.isLoaded,expression:"$store.state.isLoaded"}],attrs:{direction:"vertical"}},[e("el-header",{attrs:{height:"60px"}},[e("div",{staticClass:"page-header"},[e("span",[t._v(t._s(t.modeName)+"脚本包")]),t._v(" "),e("div",{staticClass:"header-control"},[e("el-button",{attrs:{size:"small"},on:{click:t.goToHistory}},[e("i",{staticClass:"fa fa-fw fa-history"}),t._v("\n            脚本包导入历史\n          ")])],1)])]),t._v(" "),e("el-main",[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:15}},[e("div",{staticClass:"common-form"},[e("el-form",{ref:"form",attrs:{"label-width":"120px",model:t.form,rules:t.formRules}},[e("el-form-item",{attrs:{label:"导入脚本包",prop:"upload"}},[e("el-upload",{ref:"upload",class:t.uploadAreaBorderClass,attrs:{drag:"",limit:2,multiple:!1,"auto-upload":!1,"show-file-list":!1,"http-request":t.handleUpload,"on-change":t.onUploadFileChange,accept:t.$store.getters.CONFIG("_FUNC_PKG_EXPORT_EXT"),action:""}},[e("i",{staticClass:"fa",class:t.uploadAreaIconClass}),t._v(" "),e("div",{staticClass:"el-upload__text"},[e("span",{domProps:{innerHTML:t._s(t.uploadAreaIconText)}})])])],1),t._v(" "),e("el-form-item",{attrs:{label:"导入令牌",prop:"password"}},[e("el-input",{attrs:{resize:"none",maxlength:"64","show-word-limit":""},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}}),t._v(" "),e("InfoBlock",{attrs:{title:"填写导出时提示的密码，无密码则留空即可"}}),t._v(" "),e("InfoBlock",{attrs:{type:"warning",title:"脚本包附带导入的数据源，密码等敏感信息需要重新输入"}})],1),t._v(" "),e("el-form-item",[e("div",{staticClass:"setup-right"},[e("el-button",{attrs:{type:"primary",disabled:t.disableUpload},on:{click:t.submitData}},[t._v(t._s(t.modeName))])],1)])],1)],1)]),t._v(" "),e("el-col",{staticClass:"hidden-md-and-down",attrs:{span:9}})],1)],1),t._v(" "),e("el-dialog",{attrs:{title:"即将导入脚本包",visible:t.showConfirm,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!0,width:"750px"},on:{"update:visible":function(e){t.showConfirm=e}}},[e("span",{staticClass:"import-token-dialog-content"},[t.checkResult&&t.checkResult.diff?[t.T.isNothing(t.checkResult.diff.add)?t._e():[e("span",{staticClass:"text-good"},[t._v("新增脚本集：")]),t._v(" "),t._l(t.checkResult.diff.add,(function(a){return e("el-tag",{key:a.id,attrs:{size:"medium",type:"success"}},[t._v(t._s(a.title||a.id))])})),t._v(" "),e("hr",{staticClass:"br"})],t._v(" "),t.T.isNothing(t.checkResult.diff.replace)?t._e():[e("span",{staticClass:"text-watch"},[t._v("替换脚本集：")]),t._v(" "),t._l(t.checkResult.diff.replace,(function(a){return e("el-tag",{key:a.id,attrs:{size:"medium",type:"warning"}},[t._v(t._s(a.title||a.id))])})),t._v(" "),e("InfoBlock",{attrs:{type:"warning",title:"被替换的脚本集下所有脚本文件会被完整替换为新版本，新版本中不存在的脚本文件会被删除"}}),t._v(" "),e("hr",{staticClass:"br"})]]:t._e(),t._v(" "),t.checkResult&&t.checkResult.summary&&t.checkResult.summary.note?[e("span",{staticClass:"text-info"},[t._v("备注：")]),t._v(" "),e("pre",{staticClass:"import-note"},[t._v(t._s(t.checkResult.summary.note))]),t._v(" "),e("hr",{staticClass:"br"})]:t._e()],2),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.showConfirm=!1}}},[t._v("取消")]),t._v(" "),e("el-button",{directives:[{name:"prevent-re-click",rawName:"v-prevent-re-click"}],attrs:{type:"primary",loading:t.isImporting},on:{click:t.confirmImport}},[t._v("\n          确认导入\n        ")])],1)])],1)],1)},s=[],o=a("c7eb"),i=a("1da1"),n=(a("a15b"),a("130f"),a("a434"),a("b0c0"),{name:"ScriptSetImport",components:{},watch:{showConfirm:function(t){!1===t&&this.initFilePreview()}},methods:{submitData:function(){var t=this;return Object(i["a"])(Object(o["a"])().mark((function e(){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$refs.form.validate();case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e["catch"](0),e.abrupt("return",console.error(e.t0));case 8:e.t1=t.T.setupPageMode(),e.next="import"===e.t1?11:14;break;case 11:return e.next=13,t.$refs.upload.submit();case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e,null,[[0,5]])})))()},handleUpload:function(t){var e=this;return Object(i["a"])(Object(o["a"])().mark((function a(){var r,s,i,n,c;return Object(o["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:for(i in r=new FormData,s=e.T.jsonCopy(e.form),s)s.hasOwnProperty(i)&&(n=s[i],r.append(i,n));return r.append("checkOnly",!0),r.append("files",t.file),a.next=7,e.T.callAPI("post","/api/v1/script-sets/do/import",{body:r,alert:{muteError:!0}});case 7:if(c=a.sent,c.ok){a.next=10;break}return a.abrupt("return",e.alertOnError(c));case 10:e.showConfirm=!0,e.checkResult=c.data;case 12:case"end":return a.stop()}}),a)})))()},confirmImport:function(){var t=this;return Object(i["a"])(Object(o["a"])().mark((function e(){var a,r;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.isImporting=!0,e.next=3,t.T.callAPI("post","/api/v1/script-sets/do/confirm-import",{body:{confirmId:t.checkResult.confirmId},alert:{okMessage:t.$t("Data imported")}});case 3:if(a=e.sent,t.isImporting=!1,a.ok){e.next=7;break}return e.abrupt("return",t.alertOnError(a));case 7:if(!t.T.isNothing(a.data.pkgs)){e.next=11;break}t.goToHistory(),e.next=20;break;case 11:return t.showConfirm=!1,e.next=14,t.T.confirm(t.$t("Imported Script Set requires 3rd party packages, do you want to open PIP tool now?"));case 14:if(e.sent){e.next=18;break}t.goToHistory(),e.next=20;break;case 18:r=a.data.pkgs.join(" "),t.$router.push({name:"pip-tool",query:{pkgs:t.T.getBase64(r)}});case 20:case"end":return e.stop()}}),e)})))()},alertOnError:function(t){var e=this;if(!t.ok){switch(t.reason){case"EBizCondition.InvalidPassword":this.T.alert("导入令牌错误<br>\n              请使用复制粘贴的方式填写导入令牌，避免错填容易混淆的字母数字");break;case"EBizCondition.ConfirmingImportTimeout":this.T.alert("脚本包导入确认超时<br>\n              脚本包导入后长时间未确认，请重新尝试导入");break;default:this.T.alert("脚本包导入时发生意外错误<br>\n              请尝试重新导入，如果问题一直出现，请联系脚本包发行方");break}this.form.password="",this.initFilePreview(),setImmediate((function(){e.$refs.form.clearValidate()}))}},initFilePreview:function(){this.$refs.upload.clearFiles(),this.uploadAreaBorderClass=[],this.uploadAreaIconClass=["fa-cloud-upload"],this.uploadAreaIconText="将文件拖到此处，或 <em>点击上传</em>"},showFilePreview:function(t){this.uploadAreaBorderClass=["upload-area-active"],this.uploadAreaIconClass=["fa-cloud-upload","text-main"],this.uploadAreaIconText='<code class="text-main">'.concat(t,"</code>")},onUploadFileChange:function(t,e){e.length>1&&e.splice(0,1),this.disableUpload=e.length<=0,this.disableUpload?this.initFilePreview():this.showFilePreview(e[0].name)},goToHistory:function(){this.$router.push({name:"script-set-import-history-list"})}},computed:{modeName:function(){var t={import:"导入"};return t[this.T.setupPageMode()]}},props:{},data:function(){return{scriptSetMap:{},uploadAreaBorderClass:[],uploadAreaIconClass:["fa-cloud-upload"],uploadAreaIconText:"将文件拖到此处，或 <em>点击上传</em>",disableUpload:!0,showConfirm:!1,isImporting:!1,checkResult:{},form:{password:""},formRules:{}}},created:function(){this.$store.commit("updateLoadStatus",!0)}}),c=n,l=(a("2b8f"),a("0fec"),a("2877")),p=a("fcf7"),u=Object(l["a"])(c,r,s,!1,null,"7a3d5c53",null);"function"===typeof p["default"]&&Object(p["default"])(u);e["default"]=u.exports},7698:function(t,e,a){},a434:function(t,e,a){"use strict";var r=a("23e7"),s=a("7b0b"),o=a("23cb"),i=a("5926"),n=a("07fa"),c=a("3511"),l=a("65f0"),p=a("8418"),u=a("083a"),d=a("1dde"),f=d("splice"),m=Math.max,h=Math.min;r({target:"Array",proto:!0,forced:!f},{splice:function(t,e){var a,r,d,f,v,b,w=s(this),_=n(w),k=o(t,_),g=arguments.length;for(0===g?a=r=0:1===g?(a=0,r=_-k):(a=g-2,r=h(m(i(e),0),_-k)),c(_+a-r),d=l(w,r),f=0;f<r;f++)v=k+f,v in w&&p(d,f,w[v]);if(d.length=r,a<r){for(f=k;f<_-r;f++)v=f+r,b=f+a,v in w?w[b]=w[v]:u(w,b);for(f=_;f>_-r+a;f--)u(w,f-1)}else if(a>r)for(f=_-r;f>k;f--)v=f+r-1,b=f+a-1,v in w?w[b]=w[v]:u(w,b);for(f=0;f<a;f++)w[f+k]=arguments[f+2];return w.length=_-r+a,d}})},c5f3:function(t,e){t.exports=function(t){t.options.__i18n=t.options.__i18n||[],t.options.__i18n.push('{"zh-CN":{"Data imported":"数据已导入","Imported Script Set requires 3rd party packages, do you want to open PIP tool now?":"导入的脚本集需要第三方包，是否现在前往PIP工具？"}}'),delete t.options._Ctor}},d8b4:function(t,e,a){},fcf7:function(t,e,a){"use strict";var r=a("c5f3"),s=a.n(r);e["default"]=s.a}}]);