(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1f13f26e"],{"0162":function(t,e,i){},"032e":function(t,e,i){"use strict";i("2647")},2647:function(t,e,i){},"40bd":function(t,e){t.exports=function(t){t.options.__i18n=t.options.__i18n||[],t.options.__i18n.push('{"en":{"codeLines":"{n} line | {n} lines"}}'),delete t.options._Ctor}},"484b":function(t,e,i){"use strict";i("0162")},"5afa":function(t,e,i){"use strict";i("d612")},"5fdb":function(t,e,i){"use strict";var o=i("cdb3"),s=i.n(o);e["default"]=s.a},"7abf":function(t,e){t.exports=function(t){t.options.__i18n=t.options.__i18n||[],t.options.__i18n.push('{"zh-CN":{"Code Editor setting":"代码编辑器设置","Setting of Code Editor only effect current browser":"代码编辑器配置仅保存在当前浏览器，更换浏览器或电脑后需要重新配置","Theme":"主题","Font Size":"文字大小","Line Height":"行高","Reset to default":"恢复默认设置","Please input font size":"请输入文字大小","Font size should be a integer between 12 and 36":"文字大小设置范围为 12-36 px","Please input line height":"请输入行高","Line height should be a number between 1 and 2":"行高设置范围为 1-2 倍"}}'),delete t.options._Ctor}},"92a7":function(t,e,i){},b951:function(t,e,i){"use strict";i("b0c0");var o=function(){var t=this,e=t._self._c;return e("el-drawer",{attrs:{modal:!1,visible:t.show,direction:"rtl"},on:{"update:visible":function(e){t.show=e}}},[e("div",{attrs:{slot:"title"},slot:"title"},[e("i",{staticClass:"fa fa-fw fa-cog"}),t._v(" "+t._s(t.$t("Code Editor setting"))+"\n  ")]),t._v(" "),e("div",{staticClass:"code-editor-setting"},[e("InfoBlock",{attrs:{type:"warning",title:t.$t("Setting of Code Editor only effect current browser")}}),t._v(" "),e("br"),t._v(" "),e("el-form",{ref:"form",attrs:{"label-width":"100px",model:t.form,rules:t.formRules}},[e("el-form-item",{attrs:{label:t.$t("Theme")}},[e("el-select",{model:{value:t.form.theme,callback:function(e){t.$set(t.form,"theme",e)},expression:"form.theme"}},t._l(t.C.CODE_MIRROR_THEME,(function(i){return e("el-option",{key:i.key,attrs:{label:t.$t(i.name),value:i.key}})})),1)],1),t._v(" "),e("el-form-item",{attrs:{label:t.$t("Font Size"),prop:"style.fontSize"}},[e("el-slider",{attrs:{min:12,max:36,step:1,"show-input":!0,"show-input-controls":!1,"show-tooltip":!1},model:{value:t.form.style.fontSize,callback:function(e){t.$set(t.form.style,"fontSize",t._n(e))},expression:"form.style.fontSize"}})],1),t._v(" "),e("el-form-item",{attrs:{label:t.$t("Line Height"),prop:"style.lineHeight"}},[e("el-slider",{attrs:{min:1,max:2,step:.1,"show-input":!0,"show-input-controls":!1,"show-tooltip":!1},model:{value:t.form.style.lineHeight,callback:function(e){t.$set(t.form.style,"lineHeight",t._n(e))},expression:"form.style.lineHeight"}})],1),t._v(" "),e("el-form-item",[e("div",{staticClass:"setup-right"},[e("el-button",{on:{click:t.resetDefault}},[t._v(t._s(t.$t("Reset to default")))])],1)])],1)],1)])},s=[],r=(i("130f"),{name:"CodeEditorSetting",components:{},watch:{form:{deep:!0,handler:function(t,e){var i=this,o=this.T.jsonCopy(this.form);this.$store.commit("updateCodeMirrorSettings",o),setImmediate((function(){i.codeMirror&&i.codeMirror.refresh()}))}}},methods:{open:function(){this.show=!0},resetDefault:function(){this.form=this.T.jsonCopy({theme:this.C.CODE_MIRROR_THEME_DEFAULT.key,style:this.$store.getters.DEFAULT_STATE.codeMirrorStyle})}},props:{codeMirror:Object},data:function(){var t=this.T.jsonCopy({theme:this.$store.getters.codeMirrorSettings.theme,style:{fontSize:parseInt(this.$store.getters.codeMirrorSettings.style.fontSize),lineHeight:this.$store.getters.codeMirrorSettings.style.lineHeight}});return{show:!1,form:t,formRules:{"style.fontSize":[{trigger:"change",message:this.$t("Please input font size"),required:!0},{trigger:"change",message:this.$t("Font size should be a integer between 12 and 36"),type:"integer",min:12,max:36}],"style.lineHeight":[{trigger:"change",message:this.$t("Please input line height"),required:!0},{trigger:"change",message:this.$t("Line height should be a number between 1 and 2"),type:"number",min:1,max:2}]}}}}),n=r,a=(i("5afa"),i("484b"),i("2877")),d=i("f9af"),c=Object(a["a"])(n,o,s,!1,null,"74fede1a",null);"function"===typeof d["default"]&&Object(d["default"])(c);e["a"]=c.exports},cdb3:function(t,e){t.exports=function(t){t.options.__i18n=t.options.__i18n||[],t.options.__i18n.push('{"zh-CN":{"Script Setup":"脚本设置","Script is under editing in other tab, please wait...":"其他标签页或窗口正在编辑此脚本，请稍后...","Script is under editing in other client, please wait...":"其他客户端正在编辑此脚本，请稍后...","Shortcut":"快捷键","Select Target":"选择跳转目标","Download {type}":"下载{type}","Code Editor setting":"代码编辑器设置","This is a built-in Script, code will be reset when the system restarts":"这是一个内置脚本，代码会在系统重启后复位","This Script is locked by other user ({user})":"当前脚本被其他用户（{user}）锁定","Currently in view mode, click Edit button to enter edit mode":"当前为查看模式，点击「编辑」按钮进入编辑模式","View Mode":"查看模式","Published Code":"已发布的代码","Saved Draft Code":"已保存的草稿代码"}}'),delete t.options._Ctor}},d5cd:function(t,e,i){"use strict";i("92a7")},d612:function(t,e,i){},de39:function(t,e,i){"use strict";var o=i("40bd"),s=i.n(o);e["default"]=s.a},dfa3:function(t,e,i){"use strict";i.r(e);i("b0c0");var o=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"fade-s"}},[e("el-container",{directives:[{name:"show",rawName:"v-show",value:t.$store.state.isLoaded,expression:"$store.state.isLoaded"}]},[e("el-header",{staticClass:"code-viewer",staticStyle:{height:"unset !important"}},[e("div",{staticClass:"code-viewer-action-left"},[e("code",{staticClass:"code-viewer-action-title"},[e("i",{staticClass:"fa fa-file-code-o"}),t._v("\n          "+t._s(t.data.id)+"\n          "),e("el-tooltip",{attrs:{content:t.$t("Script Setup"),placement:"bottom",enterable:!1}},[e("el-button",{attrs:{type:"text"},on:{click:function(e){return e.stopPropagation(),t.showScriptSetup.apply(null,arguments)}}},[e("i",{staticClass:"fa fa-fw fa-wrench"})])],1)],1)]),t._v(" "),e("div",{staticClass:"code-viewer-action-breaker hidden-lg-and-up"}),t._v(" "),e("div",{staticClass:"code-viewer-action-right"},[e("el-form",{attrs:{inline:!0}},[e("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.conflictStatus,expression:"conflictStatus"}]},["otherTab"===t.conflictStatus?e("span",{staticClass:"text-bad"},[t._v(t._s(t.$t("Script is under editing in other tab, please wait...")))]):"otherClient"===t.conflictStatus?e("span",{staticClass:"text-bad"},[t._v(t._s(t.$t("Script is under editing in other client, please wait...")))]):t._e(),t._v("\n            　\n            　\n          ")]),t._v(" "),e("el-form-item",[e("el-select",{staticStyle:{width:"150px"},attrs:{"popper-class":"code-font",size:"mini",filterable:"",placeholder:t.$t("Select Target")},model:{value:t.selectedItemId,callback:function(e){t.selectedItemId=e},expression:"selectedItemId"}},t._l(t.selectableItems,(function(i){return e("el-option",{key:i.id,attrs:{label:i.name,value:i.id}},["todo"===i.type?e("el-tag",{staticClass:"select-todo-tag",attrs:{size:"mini",type:t.C.TODO_TYPE_MAP.get(i.todoType).tagType}},[e("i",{staticClass:"fa fa-fw",class:t.C.TODO_TYPE_MAP.get(i.todoType).icon}),t._v("\n                  "+t._s(i.todoType)+"\n                ")]):e("el-tag",{staticClass:"select-item-tag",attrs:{type:"info",size:"mini"}},[t._v(t._s(i.type))]),t._v("\n                "+t._s(i.name)+"\n              ")],1)})),1)],1),t._v(" "),t.conflictStatus?t._e():e("el-form-item",[e("el-tooltip",{attrs:{placement:"bottom",enterable:!1}},[e("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n                "+t._s(t.$t("Shortcut"))+t._s(t.$t(":"))),e("kbd",[t._v(t._s(t.T.getSuperKeyName()))]),t._v(" + "),e("kbd",[t._v("E")])]),t._v(" "),e("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:t.startEdit}},[e("i",{staticClass:"fa fa-fw",class:[t.C.CODE_VIEWR_USER_OPERATION_MAP.get(t.userOperation).icon]}),t._v(" "+t._s(t.C.CODE_VIEWR_USER_OPERATION_MAP.get(t.userOperation).name))])],1)],1),t._v(" "),e("el-form-item",[e("el-radio-group",{attrs:{size:"mini"},model:{value:t.showMode,callback:function(e){t.showMode=e},expression:"showMode"}},t._l(t.C.CODE_VIEWER_SHOW_MODE,(function(i,o){return e("el-tooltip",{key:i.key,attrs:{placement:"bottom",enterable:!1}},[e("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n                  "+t._s(t.$t("Shortcut"))+t._s(t.$t(":"))),e("kbd",[t._v(t._s(t.T.getSuperKeyName()))]),t._v(" + "),e("kbd",[t._v(t._s(o+1))])]),t._v(" "),e("el-radio-button",{attrs:{label:i.key}},[t._v(t._s(i.name))])],1)})),1)],1),t._v(" "),e("el-form-item",[e("el-tooltip",{attrs:{content:t.$t("Download"),placement:"bottom",enterable:!1}},[e("el-button",{directives:[{name:"prevent-re-click",rawName:"v-prevent-re-click"}],attrs:{plain:"",size:"mini"},on:{click:t.download}},[t._v(t._s(t.$t("Download {type}",{type:t.C.CODE_VIEWER_SHOW_MODE_MAP.get(t.showMode).name})))])],1)],1),t._v(" "),e("el-form-item",[e("el-tooltip",{attrs:{content:t.$t("Code Editor setting"),placement:"bottom",enterable:!1}},[e("el-button",{attrs:{plain:"",size:"mini"},on:{click:function(e){return t.$refs.codeEditorSetting.open()}}},[e("i",{staticClass:"fa fa-fw fa-cog"})])],1)],1)],1)],1),t._v(" "),t.isLockedByOther?e("InfoBlock",{attrs:{type:t.isEditable?"warning":"error",title:t.$t("This Script is locked by other user ({user})",{user:t.lockedByUser})}}):"builtin"===t.data.sset_origin?e("InfoBlock",{attrs:{type:"warning",title:t.$t("This is a built-in Script, code will be reset when the system restarts")}}):e("InfoBlock",{attrs:{type:"warning",title:t.$t("Currently in view mode, click Edit button to enter edit mode")}})],1),t._v(" "),e("el-main",{style:t.$store.getters.codeMirrorSettings.style,attrs:{id:"editorContainer_CodeViewer"}},[e("textarea",{attrs:{id:"editor_CodeViewer"}}),t._v(" "),e("h1",{attrs:{id:"viewModeHint"}},[t._v(t._s(t.$t("View Mode")))])]),t._v(" "),e("CodeEditorSetting",{ref:"codeEditorSetting",attrs:{codeMirror:t.codeMirror}}),t._v(" "),e("ScriptSetup",{ref:"setup"})],1)],1)},s=[],r=i("c7eb"),n=i("1da1"),a=(i("14d9"),i("130f"),i("99af"),i("d3b7"),i("159b"),i("b951")),d=i("bf68"),c=i("21a6"),l=i.n(c),h=i("0014"),u={name:"CodeViewer",components:{CodeEditorSetting:a["a"],ScriptSetup:h["a"]},watch:{$route:{immediate:!0,handler:function(t,e){var i=this;return Object(n["a"])(Object(r["a"])().mark((function t(){return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,i.loadData();case 2:case"end":return t.stop()}}),t)})))()}},showMode:function(t){this.loadData()},codeMirrorTheme:function(t){this.codeMirror.setOption("theme",t)},selectedItemId:function(t){this.$store.commit("updateEditor_selectedItemId",t),this.highlightQuickSelectItem()},"$store.state.Editor_selectedItemId":function(t){this.selectedItemId!==t&&(this.selectedItemId=t)},"$store.state.shortcutAction":function(t){switch(t.action){case"codeViewer.showDraft":this.showMode="draft";break;case"codeViewer.showPublished":this.showMode="published";break;case"codeViewer.showDiff":this.showMode="diff";break;case"codeViewer.enterEditor":this.conflictStatus||this.startEdit();break}}},methods:{loadData:function(){var t=this;return Object(n["a"])(Object(r["a"])().mark((function e(){var i,o;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.T.callAPI_getOne("/api/v1/scripts/do/list",t.$route.params.id,{query:{_withCode:!0,_withCodeDraft:!0}});case 2:if(i=e.sent,i.ok&&i.data){e.next=6;break}return t.$router.push({name:"intro"}),e.abrupt("return");case 6:t.data=i.data,o=t.T.getDiffInfo(t.data.code,t.data.codeDraft),t.diffAddedCount=o.addedCount,t.diffRemovedCount=o.removedCount,t.$store.commit("updateLoadStatus",!0),setImmediate((function(){switch(t.codeMirror.setValue(""),t.showMode){case"draft":case"published":var e=t.C.CODE_VIEWER_SHOW_MODE_MAP.get(t.showMode).codeField;t.codeMirror.setValue(t.data[e]||""),t.T.setCodeMirrorMode(t.codeMirror,"python");break;case"diff":var i=t.data.title?" (".concat(t.data.title,")"):"",o="".concat(t.scriptId).concat(i),s=t.data.code||"",r=t.data.codeDraft||"",n=t.$t("Published Code"),a=t.$t("Saved Draft Code"),c=Object(d["createPatch"])(o,s,r,n,a);t.codeMirror.setValue(c),t.T.setCodeMirrorMode(t.codeMirror,"diff");break}if(t.codeMirror.refresh(),t.codeMirror.focus(),t.updateSelectableItems(),t.$store.state.Editor_selectedItemId)t.selectedItemId=t.$store.state.Editor_selectedItemId,t.highlightQuickSelectItem();else{var l=t.$store.state.Editor_scriptCursorMap[t.scriptId];t.T.jumpToCodeMirrorLine(t.codeMirror,l)}t.isReady=!0}));case 13:case"end":return e.stop()}}),e)})))()},startEdit:function(){this.$router.push({name:"code-editor",params:{id:this.data.id}})},updateSelectableItems:function(){this.selectableItems=this.common.getPythonCodeItems(this.data.codeDraft,this.scriptId)},_clearLineHighlight:function(t){try{this.codeMirror.removeLineClass(t,"text"),this.codeMirror.removeLineClass(t,"background"),this.codeMirror.removeLineClass(t,"wrap");var e=this.codeMirror.lineInfo(t).widgets;Array.isArray(e)&&e.forEach((function(t){t.clear()}))}catch(i){}},_setLineHighlight:function(t){if(!this.codeMirror)return null;if(t=t||{},t.textClass&&this.codeMirror.addLineClass(t.line,"text",t.textClass),t.backgroundClass&&this.codeMirror.addLineClass(t.line,"background",t.backgroundClass),t.wrapClass&&this.codeMirror.addLineClass(t.line,"wrap",t.wrapClass),t.lineWidgetConfig){var e=t.lineWidgetConfig,i=null;switch(e.type){}i&&this.codeMirror.addLineWidget(t.line,i)}return this.T.jumpToCodeMirrorLine(this.codeMirror,t.line),this.codeMirror.lineInfo(t.line)},updateHighlightLineConfig:function(t,e){var i=this.T.jsonCopy(this.$store.state.codeViewer_highlightedLineConfigMap)||{};if(null===e?i[this.scriptId]&&delete i[this.scriptId][t]:(i[this.scriptId]||(i[this.scriptId]={}),i[this.scriptId][t]=e),this.codeMirror){for(var o in this.highlightedLineInfoMap)if(this.highlightedLineInfoMap.hasOwnProperty(o)){var s=this.highlightedLineInfoMap[o];for(var r in s)if(s.hasOwnProperty(r)){var n=s[r];this._clearLineHighlight(n.handle.lineNo())}}var a={},d=i[this.scriptId]||{};for(var c in d)if(d.hasOwnProperty(c)){var l=d[c],h=this._setLineHighlight(l);h&&(a[this.scriptId]||(a[this.scriptId]={}),a[this.scriptId][c]=h)}this.highlightedLineInfoMap=a,this.$store.commit("updateCodeViewer_highlightedLineConfigMap",i)}},highlightQuickSelectItem:function(){this.$store.state.isLoaded&&this.codeMirror&&this.selectedItem&&(this.updateHighlightLineConfig("selectedFuncLine",null),this.updateHighlightLineConfig("selectedFuncLine",{line:this.selectedItem.line,marginType:"next",textClass:"highlight-text",backgroundClass:"current-func-background highlight-code-line-blink"}))},download:function(){var t=new Blob([this.codeMirror.getValue()],{type:"text/plain"}),e=null;switch(this.showMode){case"draft":e=this.data.id+".draft.py";break;case"published":e=this.data.id+".py";break;case"diff":e=this.data.id+".py.diff";break}l.a.saveAs(t,e)},showSetup:function(){this.$refs.setup.loadData(this.scriptSetId,this.scriptId)}},computed:{codeMirrorTheme:function(){return this.T.getCodeMirrorThemeName()},scriptId:function(){return this.T.isNothing(this.data)?this.$route.params.id:this.data.id},scriptSetId:function(){return this.scriptId.split("__")[0]},conflictStatus:function(){return this.$store.getters.getConflictStatus(this.$route)},lockedByUserId:function(){return this.data.sset_lockedByUserId||this.data.lockedByUserId},lockedByUser:function(){return this.data.sset_lockedByUserId?"".concat(this.data.sset_lockedByUserName||this.data.sset_lockedByUsername):this.data.lockedByUserId?"".concat(this.data.lockedByUserName||this.data.lockedByUsername):void 0},isLockedByMe:function(){return this.lockedByUserId===this.$store.getters.userId},isLockedByOther:function(){return this.lockedByUserId&&!this.isLockedByMe},isEditable:function(){return!!this.$store.getters.isAdmin||!this.isLockedByOther},userOperation:function(){return this.isEditable?"edit":"debug"},codeLines:function(){return(this.data.code||"").split("\n").length},codeDraftLines:function(){return(this.data.codeDraft||"").split("\n").length},selectedItem:function(){if(!this.selectedItemId)return null;for(var t=0;t<this.selectableItems.length;t++){var e=this.selectableItems[t];if(e.id===this.selectedItemId)return e}}},props:{},data:function(){return{isReady:!1,codeMirror:null,highlightedLineInfoMap:{},data:{},selectableItems:[],selectedItemId:"",showMode:"draft",diffAddedCount:0,diffRemovedCount:0}},mounted:function(){var t=this;setImmediate((function(){t.codeMirror=t.T.initCodeMirror("editor_CodeViewer"),t.codeMirror.setOption("theme",t.codeMirrorTheme),t.codeMirror.on("cursorActivity",(function(){if(t.isReady){var e={scriptId:t.scriptId,cursor:t.codeMirror.getCursor()};t.$store.commit("updateEditor_scriptCursorMap",e)}})),t.T.setCodeMirrorReadOnly(t.codeMirror,!0)}))},beforeDestroy:function(){this.T.destoryCodeMirror(this.codeMirror)}},f=u,p=(i("d5cd"),i("032e"),i("2877")),m=i("de39"),g=i("5fdb"),_=Object(p["a"])(f,o,s,!1,null,"4b399b4e",null);"function"===typeof m["default"]&&Object(m["default"])(_),"function"===typeof g["default"]&&Object(g["default"])(_);e["default"]=_.exports},f9af:function(t,e,i){"use strict";var o=i("7abf"),s=i.n(o);e["default"]=s.a}}]);