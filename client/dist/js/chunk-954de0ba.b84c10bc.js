(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-954de0ba"],{"03fb":function(e,t,i){"use strict";i("aa55")},"0d62":function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"fade"}},[i("el-container",{directives:[{name:"show",rawName:"v-show",value:e.$store.state.isLoaded,expression:"$store.state.isLoaded"}]},[i("el-header",{staticClass:"code-viewer",staticStyle:{height:"unset !important"}},[i("div",{staticClass:"code-viewer-action-left"},[i("code",{staticClass:"code-viewer-action-title"},[i("i",{staticClass:"fa fa-file-code-o"}),e._v("\n          "+e._s(e.data.id)+"\n          "),i("el-tooltip",{attrs:{content:e.$t("Script Setup"),placement:"bottom",enterable:!1}},[i("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.$router.push({name:"script-setup",params:{id:e.data.id}})}}},[i("i",{staticClass:"fa fa-fw fa-wrench"})])],1)],1)]),e._v(" "),i("div",{staticClass:"code-viewer-action-breaker hidden-lg-and-up"}),e._v(" "),i("div",{staticClass:"code-viewer-action-right"},[i("el-form",{attrs:{inline:!0}},[i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.conflictStatus,expression:"conflictStatus"}]},["otherTab"===e.conflictStatus?i("span",{staticClass:"text-bad"},[e._v(e._s(e.$t("Script is under editing mode in other browser tab, please wait...")))]):"otherClient"===e.conflictStatus?i("span",{staticClass:"text-bad"},[e._v(e._s(e.$t("Script is under editing mode in other client, please wait...")))]):e._e(),e._v("\n            　\n            　\n          ")]),e._v(" "),e.conflictStatus?e._e():i("el-form-item",[i("el-tooltip",{attrs:{placement:"bottom",enterable:!1}},[i("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                "+e._s(e.$t("Shortcut"))+e._s(e.$t(":"))+" "),i("code",[e._v(e._s(e.T.getSuperKeyName())+" + E")])]),e._v(" "),i("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:e.startEdit}},[i("i",{staticClass:"fa fa-fw",class:[e.C.CODE_VIEWR_USER_OPERATION_MAP.get(e.userOperation).icon]}),e._v(" "+e._s(e.C.CODE_VIEWR_USER_OPERATION_MAP.get(e.userOperation).name))])],1)],1),e._v(" "),i("el-form-item",[i("el-select",{staticStyle:{width:"150px"},attrs:{size:"mini",filterable:"",placeholder:e.$t("Select Func")},model:{value:e.selectedFuncId,callback:function(t){e.selectedFuncId=t},expression:"selectedFuncId"}},e._l(e.draftFuncs,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),i("el-form-item",[i("el-radio-group",{attrs:{size:"mini",plain:""},model:{value:e.showMode,callback:function(t){e.showMode=t},expression:"showMode"}},e._l(e.C.CODE_VIEWER_SHOW_MODE,(function(t,r){return i("el-tooltip",{key:t.key,attrs:{placement:"bottom",enterable:!1}},[i("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                  "+e._s(e.$t("Shortcut"))+e._s(e.$t(":"))+" "),i("code",[e._v(e._s(e.T.getSuperKeyName())+" + "+e._s(r+1))])]),e._v(" "),i("el-radio-button",{attrs:{label:t.key}},[e._v(e._s(t.name))])],1)})),1)],1),e._v(" "),i("el-form-item",[i("el-tooltip",{attrs:{content:e.$t("Download"),placement:"bottom",enterable:!1}},[i("el-button",{directives:[{name:"prevent-re-click",rawName:"v-prevent-re-click"}],attrs:{plain:"",size:"mini"},on:{click:e.download}},[e._v(e._s(e.$t("Download {type}",{type:e.C.CODE_VIEWER_SHOW_MODE_MAP.get(e.showMode).name})))])],1)],1)],1)],1),e._v(" "),e.isLockedByOther?i("InfoBlock",{attrs:{type:e.isEditable?"warning":"error",title:e.$t("This Script is locked by other user({user})",{user:e.lockedByUser})}}):e.data.isBuiltin?i("InfoBlock",{attrs:{type:"warning",title:e.$t("This is a builtin Script, code will be reset when the system restarts")}}):i("InfoBlock",{attrs:{type:"warning",title:e.$t("Currently in view mode, click Edit button to enter edit mode")}})],1),e._v(" "),i("el-main",{style:e.$store.getters.codeMirrorSetting.style,attrs:{id:"editorContainer_CodeViewer"}},[i("textarea",{attrs:{id:"editor_CodeViewer"}}),e._v(" "),i("h1",{attrs:{id:"viewModeHint"}},[e._v(e._s(e.$t("View Mode")))])])],1)],1)},o=[],n=i("1da1"),a=(i("130f"),i("99af"),i("a630"),i("3ca3"),i("ac1f"),i("a1f0"),i("d3b7"),i("1276"),i("5319"),i("498a"),i("159b"),i("96cf"),i("bf68")),s=i("21a6"),d=i.n(s),c={name:"CodeViewer",components:{},watch:{$route:{immediate:!0,handler:function(e,t){var i=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i.loadData();case 2:case"end":return e.stop()}}),e)})))()}},showMode:function(e){this.loadData()},selectedFuncId:function(e){this.$store.commit("updateEditor_highlightedFuncId",e),this.highlightFunc(e)},highlightedFuncId:function(e){this.selectedFuncId=e},codeMirrorTheme:function(e){this.codeMirror.setOption("theme",e)},"$store.state.shortcutAction":function(e){switch(e.action){case"codeViewer.showDraft":this.showMode="draft";break;case"codeViewer.showPublished":this.showMode="published";break;case"codeViewer.showDiff":this.showMode="diff";break;case"codeViewer.enterEditor":this.conflictStatus||this.startEdit();break}}},methods:{loadData:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var i,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.T.callAPI_getOne("/api/v1/scripts/do/list",e.$route.params.id,{query:{_withCode:!0,_withCodeDraft:!0}});case 2:if(i=t.sent,i.ok){t.next=6;break}return e.$router.push({name:"intro"}),t.abrupt("return");case 6:e.data=i.data,r=e.T.getDiffInfo(e.data.code,e.data.codeDraft),e.diffAddedCount=r.addedCount,e.diffRemovedCount=r.removedCount,e.$store.commit("updateLoadStatus",!0),setImmediate((function(){switch(e.codeMirror.setValue(""),e.showMode){case"draft":case"published":var t=e.C.CODE_VIEWER_SHOW_MODE_MAP.get(e.showMode).codeField;e.codeMirror.setValue(e.data[t]||""),e.T.setCodeMirrorMode(e.codeMirror,"python");break;case"diff":var i=e.data.title?" (".concat(e.data.title,")"):"",r="".concat(e.scriptId).concat(i),o=e.data.code||"",n=e.data.codeDraft||"",s=e.$t("Published Code"),d=e.$t("Saved Draft Code"),c=Object(a["createPatch"])(r,o,n,s,d);e.codeMirror.setValue(c),e.T.setCodeMirrorMode(e.codeMirror,"diff");break}e.codeMirror.refresh(),e.updateFuncList(),e.selectedFuncId=e.highlightedFuncId,e.$store.commit("updateCodeViewer_isCodeLoaded",!0)}));case 13:case"end":return t.stop()}}),t)})))()},startEdit:function(){this.$router.push({name:"code-editor",params:{id:this.data.id}})},updateFuncList:function(){var e=this;if(this.data.codeDraft){var t=/^def ([a-zA-Z][a-zA-Z0-9_]+)\((.*)\)\:/gm,i=Array.from(this.data.codeDraft.matchAll(t),(function(t){var i=t[1],r="".concat(e.scriptId,".").concat(i),o=t[2].replace(/\n/g," ").split(",").reduce((function(e,t){var i=t.trim().split("=")[0];return i&&(e[i]="".concat(i.toUpperCase())),e}),{});return{id:r,name:i,kwargs:o}})),r=[],o={};i.forEach((function(e){o[e.id]||(r.push(e),o[e.id]=!0)})),this.draftFuncs=r}},_clearLineHighlight:function(e){try{this.codeMirror.removeLineClass(e,"text"),this.codeMirror.removeLineClass(e,"background"),this.codeMirror.removeLineClass(e,"wrap");var t=this.codeMirror.lineInfo(e).widgets;Array.isArray(t)&&t.forEach((function(e){e.clear()}))}catch(i){}},_setLineHighlight:function(e){if(!this.codeMirror)return null;e=e||{};var t=e.line+(e.scroll||0);if(t=Math.min(Math.max(t,0),this.codeMirror.lineCount()-1),"next"===e.marginType?(this.codeMirror.setCursor({line:this.codeMirror.lineCount()-1}),this.codeMirror.setCursor({line:t})):"prev"===e.marginType&&(this.codeMirror.setCursor({line:0}),this.codeMirror.setCursor({line:t})),this.codeMirror.setCursor({line:e.line}),e.textClass&&this.codeMirror.addLineClass(e.line,"text",e.textClass),e.backgroundClass&&this.codeMirror.addLineClass(e.line,"background",e.backgroundClass),e.wrapClass&&this.codeMirror.addLineClass(e.line,"wrap",e.wrapClass),e.lineWidgetConfig){var i=e.lineWidgetConfig,r=null;switch(i.type){}r&&this.codeMirror.addLineWidget(e.line,r)}return this.codeMirror.lineInfo(e.line)},updateHighlightLineConfig:function(e,t){var i=this.T.jsonCopy(this.$store.state.codeViewer_highlightedLineConfigMap)||{};if(null===t?i[this.scriptId]&&delete i[this.scriptId][e]:(i[this.scriptId]||(i[this.scriptId]={}),i[this.scriptId][e]=t),this.codeMirror){for(var r in this.highlightedLineInfoMap)if(this.highlightedLineInfoMap.hasOwnProperty(r)){var o=this.highlightedLineInfoMap[r];for(var n in o)if(o.hasOwnProperty(n)){var a=o[n];this._clearLineHighlight(a.handle.lineNo())}}var s={},d=i[this.scriptId]||{};for(var c in d)if(d.hasOwnProperty(c)){var l=d[c],u=this._setLineHighlight(l);u&&(s[this.scriptId]||(s[this.scriptId]={}),s[this.scriptId][c]=u)}this.highlightedLineInfoMap=s,this.$store.commit("updateCodeViewer_highlightedLineConfigMap",i)}},highlightFunc:function(e){if(this.codeMirror&&e){var t=e.split(".")[1];this.updateHighlightLineConfig("selectedFuncLine",null);var i="def ".concat(t,"("),r=this.codeMirror.getSearchCursor(i);if(r.findNext()){var o=r.from().line;this.updateHighlightLineConfig("selectedFuncLine",{line:o,marginType:"next",scroll:-1,textClass:"highlight-text",backgroundClass:"current-func-background highlight-code-line-blink"})}}},download:function(){var e=new Blob([this.codeMirror.getValue()],{type:"text/plain"}),t=null;switch(this.showMode){case"draft":t=this.data.id+".draft.py";break;case"published":t=this.data.id+".py";break;case"diff":t=this.data.id+".py.diff";break}d.a.saveAs(e,t)}},computed:{codeMirrorTheme:function(){return this.T.getCodeMirrorThemeName()},scriptId:function(){return this.$route.params.id},scriptSetId:function(){return this.scriptId.split("__")[0]},conflictStatus:function(){return this.$store.getters.getConflictStatus(this.$route)},lockedByUserId:function(){return this.data.sset_lockedByUserId||this.data.lockedByUserId},lockedByUser:function(){return this.data.sset_lockedByUserId?"".concat(this.data.sset_lockedByUserName||this.data.sset_lockedByUsername):this.data.lockedByUserId?"".concat(this.data.lockedByUserName||this.data.lockedByUsername):void 0},isLockedByMe:function(){return this.lockedByUserId===this.$store.getters.userId},isLockedByOther:function(){return this.lockedByUserId&&!this.isLockedByMe},isEditable:function(){return!!this.$store.getters.isAdmin||!this.isLockedByOther},userOperation:function(){return this.isEditable?"edit":"debug"},highlightedFuncId:function(){return this.$store.state.Editor_highlightedFuncId},codeLines:function(){return(this.data.code||"").split("\n").length},codeDraftLines:function(){return(this.data.codeDraft||"").split("\n").length}},props:{},data:function(){return{codeMirror:null,highlightedLineInfoMap:{},data:{},draftFuncs:[],selectedFuncId:"",showMode:"draft",diffAddedCount:0,diffRemovedCount:0}},mounted:function(){var e=this;setImmediate((function(){e.codeMirror=e.T.initCodeMirror("editor_CodeViewer"),e.codeMirror.setOption("theme",e.codeMirrorTheme),e.T.setCodeMirrorReadOnly(e.codeMirror,!0)}))},beforeDestroy:function(){this.T.destoryCodeMirror(this.codeMirror)}},l=c,u=(i("252d"),i("03fb"),i("2877")),h=i("7f09"),f=i("2383"),p=Object(u["a"])(l,r,o,!1,null,"10e04753",null);"function"===typeof h["default"]&&Object(h["default"])(p),"function"===typeof f["default"]&&Object(f["default"])(p);t["default"]=p.exports},"21a6":function(e,t,i){(function(i){var r,o,n;(function(i,a){o=[],r=a,n="function"===typeof r?r.apply(t,o):r,void 0===n||(e.exports=n)})(0,(function(){"use strict";function t(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function r(e,t,i){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){s(r.response,t,i)},r.onerror=function(){console.error("could not download file")},r.send()}function o(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function n(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(r){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof i&&i.global===i?i:void 0,s=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype?function(e,t,i){var s=a.URL||a.webkitURL,d=document.createElement("a");t=t||e.name||"download",d.download=t,d.rel="noopener","string"==typeof e?(d.href=e,d.origin===location.origin?n(d):o(d.href)?r(e,t,i):n(d,d.target="_blank")):(d.href=s.createObjectURL(e),setTimeout((function(){s.revokeObjectURL(d.href)}),4e4),setTimeout((function(){n(d)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,i,a){if(i=i||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,a),i);else if(o(e))r(e,i,a);else{var s=document.createElement("a");s.href=e,s.target="_blank",setTimeout((function(){n(s)}))}}:function(e,t,i,o){if(o=o||open("","_blank"),o&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof e)return r(e,t,i);var n="application/octet-stream"===e.type,s=/constructor/i.test(a.HTMLElement)||a.safari,d=/CriOS\/[\d]+/.test(navigator.userAgent);if((d||n&&s)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=d?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},c.readAsDataURL(e)}else{var l=a.URL||a.webkitURL,u=l.createObjectURL(e);o?o.location=u:location.href=u,o=null,setTimeout((function(){l.revokeObjectURL(u)}),4e4)}});a.saveAs=s.saveAs=s,e.exports=s}))}).call(this,i("c8ba"))},2383:function(e,t,i){"use strict";var r=i("25c2"),o=i.n(r);t["default"]=o.a},"252d":function(e,t,i){"use strict";i("2e4d")},"25c2":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"zh-CN":{"Script Setup":"脚本设置","Script is under editing mode in other browser tab, please wait...":"其他标签页或窗口正在编辑此脚本，请稍后...","Script is under editing mode in other client, please wait...":"其他客户端正在编辑此脚本，请稍后...","Shortcut":"快捷键","Select Func":"选择聚焦函数","Download {type}":"下载{type}","Setup Code Editor":"调整编辑器显示样式","This is a builtin Script, code will be reset when the system restarts":"这是一个内置脚本，代码会在系统重启后复位","This Script is locked by other user({user})":"当前脚本被其他用户（{user}）锁定","Currently in view mode, click Edit button to enter edit mode":"当前为查看模式，点击「编辑」按钮进入编辑模式","View Mode":"查看模式","Published Code":"已发布的代码","Saved Draft Code":"已保存的草稿代码"}}'),delete e.options._Ctor}},"2e4d":function(e,t,i){},"4df4":function(e,t,i){"use strict";var r=i("da84"),o=i("0366"),n=i("c65b"),a=i("7b0b"),s=i("9bdd"),d=i("e95a"),c=i("68ee"),l=i("07fa"),u=i("8418"),h=i("9a1f"),f=i("35a1"),p=r.Array;e.exports=function(e){var t=a(e),i=c(this),r=arguments.length,g=r>1?arguments[1]:void 0,v=void 0!==g;v&&(g=o(g,r>2?arguments[2]:void 0));var m,w,b,_,y,C,M=f(t),k=0;if(!M||this==p&&d(M))for(m=l(t),w=i?new this(m):p(m);m>k;k++)C=v?g(t[k],k):t[k],u(w,k,C);else for(_=h(t,M),y=_.next,w=i?new this:[];!(b=n(y,_)).done;k++)C=v?s(_,g,[b.value,k],!0):b.value,u(w,k,C);return w.length=k,w}},"7e33":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"codeLines":"{n} line | {n} lines"}}'),delete e.options._Ctor}},"7f09":function(e,t,i){"use strict";var r=i("7e33"),o=i.n(r);t["default"]=o.a},"9bdd":function(e,t,i){var r=i("825a"),o=i("2a62");e.exports=function(e,t,i,n){try{return n?t(r(i)[0],i[1]):t(i)}catch(a){o(e,"throw",a)}}},a1f0:function(e,t,i){"use strict";var r=i("23e7"),o=i("da84"),n=i("c65b"),a=i("e330"),s=i("9ed3"),d=i("1d80"),c=i("50c4"),l=i("577e"),u=i("825a"),h=i("c6b6"),f=i("3a9b"),p=i("44e7"),g=i("ad6d"),v=i("dc4a"),m=i("6eeb"),w=i("d039"),b=i("b622"),_=i("4840"),y=i("8aa5"),C=i("14c3"),M=i("69f3"),k=i("c430"),I=b("matchAll"),E="RegExp String",x=E+" Iterator",L=M.set,S=M.getterFor(x),O=RegExp.prototype,$=o.TypeError,R=a(g),T=a("".indexOf),A=a("".matchAll),D=!!A&&!w((function(){A("a",/./)})),B=s((function(e,t,i,r){L(this,{type:x,regexp:e,string:t,global:i,unicode:r,done:!1})}),E,(function(){var e=S(this);if(e.done)return{value:void 0,done:!0};var t=e.regexp,i=e.string,r=C(t,i);return null===r?{value:void 0,done:e.done=!0}:e.global?(""===l(r[0])&&(t.lastIndex=y(i,c(t.lastIndex),e.unicode)),{value:r,done:!1}):(e.done=!0,{value:r,done:!1})})),F=function(e){var t,i,r,o,n,a,s=u(this),d=l(e);return t=_(s,RegExp),i=s.flags,void 0===i&&f(O,s)&&!("flags"in O)&&(i=R(s)),r=void 0===i?"":l(i),o=new t(t===RegExp?s.source:s,r),n=!!~T(r,"g"),a=!!~T(r,"u"),o.lastIndex=c(s.lastIndex),new B(o,d,n,a)};r({target:"String",proto:!0,forced:D},{matchAll:function(e){var t,i,r,o,a=d(this);if(null!=e){if(p(e)&&(t=l(d("flags"in O?e.flags:R(e))),!~T(t,"g")))throw $("`.matchAll` does not allow non-global regexes");if(D)return A(a,e);if(r=v(e,I),void 0===r&&k&&"RegExp"==h(e)&&(r=F),r)return n(r,e,a)}else if(D)return A(a,e);return i=l(a),o=new RegExp(e,"g"),k?n(F,o,i):o[I](i)}}),k||I in O||m(O,I,F)},a630:function(e,t,i){var r=i("23e7"),o=i("4df4"),n=i("1c7e"),a=!n((function(e){Array.from(e)}));r({target:"Array",stat:!0,forced:a},{from:o})},aa55:function(e,t,i){}}]);