(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-466cad08"],{"0212":function(t,e,n){"use strict";n("a178")},"0538":function(t,e,n){"use strict";var i=n("e330"),r=n("59ed"),o=n("861d"),a=n("1a2d"),s=n("f36a"),u=n("40d5"),c=Function,l=i([].concat),d=i([].join),h={},f=function(t,e,n){if(!a(h,e)){for(var i=[],r=0;r<e;r++)i[r]="a["+r+"]";h[e]=c("C,a","return new C("+d(i,",")+")")}return h[e](t,n)};t.exports=u?c.bind:function(t){var e=r(this),n=e.prototype,i=s(arguments,1),a=function(){var n=l(i,s(arguments));return this instanceof a?f(e,n.length,n):e.apply(t,n)};return o(n)&&(a.prototype=n),a}},"06c5":function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));n("fb6a"),n("d3b7"),n("b0c0"),n("a630"),n("3ca3"),n("ac1f"),n("00b4");var i=n("6b75");function r(t,e){if(t){if("string"===typeof t)return Object(i["a"])(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Object(i["a"])(t,e):void 0}}},"0f29":function(t,e){t.exports=function(t){t.options.__i18n=t.options.__i18n||[],t.options.__i18n.push('{"zh-CN":{"Deployed":"已部署","Not Deployed":"未部署","Start":"开始","End":"结束","Process Step":"处理步骤","Branch Step":"分支步骤","True":"真","False":"假","Select Blueprint":"选择蓝图","Add Process Step":"添加处理步骤","Add Branch Step":"添加分支步骤","Select all":"全选","Function \\"entry_func(prev_result)\\" is the main func of the node":"函数\\"entry_func(prev_res)\\"为节点的入口函数","Code":"代码","Kwargs":"执行参数","Add Kwargs":"添加执行参数","Global Vars":"全局变量","Add Global Var":"添加全局变量","Please input ID":"请输入ID","Only alphabets, numbers and underscore are allowed":"只能包含大小写英文、数字及下划线","Cannot not starts with a number":"不得以数字开头","ID cannot contains double underscore \\"__\\"":"ID不能包含\\"__\\"","Blueprint created":"蓝图已创建","Blueprint saved":"蓝图已保存","Blueprint deployed":"蓝图已部署","Blueprint deleted":"蓝图已删除","Are you sure you want to delete the Blueprint?":"是否确认删除此蓝图？"}}'),delete t.options._Ctor}},"0f3d":function(t,e,n){"use strict";n("e57a")},"1c59":function(t,e,n){"use strict";var i=n("6d61"),r=n("6566");i("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),r)},2909:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var i=n("6b75");function r(t){if(Array.isArray(t))return Object(i["a"])(t)}n("a4d3"),n("e01a"),n("d3b7"),n("d28b"),n("3ca3"),n("ddb0"),n("a630");function o(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}var a=n("06c5");n("d9e2");function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t){return r(t)||o(t)||Object(a["a"])(t)||s()}},"42ad":function(t,e,n){"use strict";var i=n("0f29"),r=n.n(i);e["default"]=r.a},"4ae1":function(t,e,n){var i=n("23e7"),r=n("d066"),o=n("2ba4"),a=n("0538"),s=n("5087"),u=n("825a"),c=n("861d"),l=n("7c73"),d=n("d039"),h=r("Reflect","construct"),f=Object.prototype,p=[].push,m=d((function(){function t(){}return!(h((function(){}),[],t)instanceof t)})),v=!d((function(){h((function(){}))})),b=m||v;i({target:"Reflect",stat:!0,forced:b,sham:b},{construct:function(t,e){s(t),u(e);var n=arguments.length<3?t:s(arguments[2]);if(v&&!m)return h(t,e,n);if(t==n){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}var i=[null];return o(p,i,e),new(o(a,t,i))}var r=n.prototype,d=l(c(r)?r:f),b=o(t,d,e);return c(b)?b:d}})},"4fad":function(t,e,n){var i=n("d039"),r=n("861d"),o=n("c6b6"),a=n("d86b"),s=Object.isExtensible,u=i((function(){s(1)}));t.exports=u||a?function(t){return!!r(t)&&((!a||"ArrayBuffer"!=o(t))&&(!s||s(t)))}:s},"53e4":function(t,e,n){},6062:function(t,e,n){n("1c59")},6566:function(t,e,n){"use strict";var i=n("9bf2").f,r=n("7c73"),o=n("6964"),a=n("0366"),s=n("19aa"),u=n("2266"),c=n("7dd0"),l=n("2626"),d=n("83ab"),h=n("f183").fastKey,f=n("69f3"),p=f.set,m=f.getterFor;t.exports={getConstructor:function(t,e,n,c){var l=t((function(t,i){s(t,f),p(t,{type:e,index:r(null),first:void 0,last:void 0,size:0}),d||(t.size=0),void 0!=i&&u(i,t[c],{that:t,AS_ENTRIES:n})})),f=l.prototype,v=m(e),b=function(t,e,n){var i,r,o=v(t),a=g(t,e);return a?a.value=n:(o.last=a={index:r=h(e,!0),key:e,value:n,previous:i=o.last,next:void 0,removed:!1},o.first||(o.first=a),i&&(i.next=a),d?o.size++:t.size++,"F"!==r&&(o.index[r]=a)),t},g=function(t,e){var n,i=v(t),r=h(e);if("F"!==r)return i.index[r];for(n=i.first;n;n=n.next)if(n.key==e)return n};return o(f,{clear:function(){var t=this,e=v(t),n=e.index,i=e.first;while(i)i.removed=!0,i.previous&&(i.previous=i.previous.next=void 0),delete n[i.index],i=i.next;e.first=e.last=void 0,d?e.size=0:t.size=0},delete:function(t){var e=this,n=v(e),i=g(e,t);if(i){var r=i.next,o=i.previous;delete n.index[i.index],i.removed=!0,o&&(o.next=r),r&&(r.previous=o),n.first==i&&(n.first=r),n.last==i&&(n.last=o),d?n.size--:e.size--}return!!i},forEach:function(t){var e,n=v(this),i=a(t,arguments.length>1?arguments[1]:void 0);while(e=e?e.next:n.first){i(e.value,e.key,this);while(e&&e.removed)e=e.previous}},has:function(t){return!!g(this,t)}}),o(f,n?{get:function(t){var e=g(this,t);return e&&e.value},set:function(t,e){return b(this,0===t?0:t,e)}}:{add:function(t){return b(this,t=0===t?0:t,t)}}),d&&i(f,"size",{get:function(){return v(this).size}}),l},setStrong:function(t,e,n){var i=e+" Iterator",r=m(e),o=m(i);c(t,e,(function(t,e){p(this,{type:i,target:t,state:r(t),kind:e,last:void 0})}),(function(){var t=o(this),e=t.kind,n=t.last;while(n&&n.removed)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),l(e)}}},"6b75":function(t,e,n){"use strict";function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}n.d(e,"a",(function(){return i}))},"6d61":function(t,e,n){"use strict";var i=n("23e7"),r=n("da84"),o=n("e330"),a=n("94ca"),s=n("cb2d"),u=n("f183"),c=n("2266"),l=n("19aa"),d=n("1626"),h=n("861d"),f=n("d039"),p=n("1c7e"),m=n("d44e"),v=n("7156");t.exports=function(t,e,n){var b=-1!==t.indexOf("Map"),g=-1!==t.indexOf("Weak"),y=b?"set":"add",k=r[t],w=k&&k.prototype,_=k,x={},C=function(t){var e=o(w[t]);s(w,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(g&&!h(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return g&&!h(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(g&&!h(t))&&e(this,0===t?0:t)}:function(t,n){return e(this,0===t?0:t,n),this})},O=a(t,!d(k)||!(g||w.forEach&&!f((function(){(new k).entries().next()}))));if(O)_=n.getConstructor(e,t,b,y),u.enable();else if(a(t,!0)){var L=new _,M=L[y](g?{}:-0,1)!=L,A=f((function(){L.has(1)})),j=p((function(t){new k(t)})),P=!g&&f((function(){var t=new k,e=5;while(e--)t[y](e,e);return!t.has(-0)}));j||(_=e((function(t,e){l(t,w);var n=v(new k,t,_);return void 0!=e&&c(e,n[y],{that:n,AS_ENTRIES:b}),n})),_.prototype=w,w.constructor=_),(A||P)&&(C("delete"),C("has"),b&&C("get")),(P||M)&&C(y),g&&w.clear&&delete w.clear}return x[t]=_,i({global:!0,constructor:!0,forced:_!=k},x),m(_,t),g||n.setStrong(_,t,b),_}},"73dc":function(t,e,n){"use strict";n("cf64")},"7db0":function(t,e,n){"use strict";var i=n("23e7"),r=n("b727").find,o=n("44d2"),a="find",s=!0;a in[]&&Array(1)[a]((function(){s=!1})),i({target:"Array",proto:!0,forced:s},{find:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),o(a)},"81d5":function(t,e,n){"use strict";var i=n("7b0b"),r=n("23cb"),o=n("07fa");t.exports=function(t){var e=i(this),n=o(e),a=arguments.length,s=r(a>1?arguments[1]:void 0,n),u=a>2?arguments[2]:void 0,c=void 0===u?n:r(u,n);while(c>s)e[s++]=t;return e}},"857a":function(t,e,n){var i=n("e330"),r=n("1d80"),o=n("577e"),a=/"/g,s=i("".replace);t.exports=function(t,e,n,i){var u=o(r(t)),c="<"+e;return""!==n&&(c+=" "+n+'="'+s(o(i),a,"&quot;")+'"'),c+">"+u+"</"+e+">"}},"8abe":function(t,e,n){"use strict";n("53e4")},"969e":function(t,e,n){"use strict";n("b489")},9911:function(t,e,n){"use strict";var i=n("23e7"),r=n("857a"),o=n("af03");i({target:"String",proto:!0,forced:o("link")},{link:function(t){return r(this,"a","href",t)}})},a178:function(t,e,n){},a434:function(t,e,n){"use strict";var i=n("23e7"),r=n("7b0b"),o=n("23cb"),a=n("5926"),s=n("07fa"),u=n("3511"),c=n("65f0"),l=n("8418"),d=n("083a"),h=n("1dde"),f=h("splice"),p=Math.max,m=Math.min;i({target:"Array",proto:!0,forced:!f},{splice:function(t,e){var n,i,h,f,v,b,g=r(this),y=s(g),k=o(t,y),w=arguments.length;for(0===w?n=i=0:1===w?(n=0,i=y-k):(n=w-2,i=m(p(a(e),0),y-k)),u(y+n-i),h=c(g,i),f=0;f<i;f++)v=k+f,v in g&&l(h,f,g[v]);if(h.length=i,n<i){for(f=k;f<y-i;f++)v=f+i,b=f+n,v in g?g[b]=g[v]:d(g,b);for(f=y;f>y-i+n;f--)d(g,f-1)}else if(n>i)for(f=y-i;f>k;f--)v=f+i-1,b=f+n-1,v in g?g[b]=g[v]:d(g,b);for(f=0;f<n;f++)g[f+k]=arguments[f+2];return g.length=y-i+n,h}})},a630:function(t,e,n){var i=n("23e7"),r=n("4df4"),o=n("1c7e"),a=!o((function(t){Array.from(t)}));i({target:"Array",stat:!0,forced:a},{from:r})},af03:function(t,e,n){var i=n("d039");t.exports=function(t){return i((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}))}},b19d:function(t,e,n){"use strict";n("fab5")},b489:function(t,e,n){},bb2f:function(t,e,n){var i=n("d039");t.exports=!i((function(){return Object.isExtensible(Object.preventExtensions({}))}))},bf19:function(t,e,n){"use strict";var i=n("23e7"),r=n("c65b");i({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return r(URL.prototype.toString,this)}})},cb29:function(t,e,n){var i=n("23e7"),r=n("81d5"),o=n("44d2");i({target:"Array",proto:!0},{fill:r}),o("fill")},cf64:function(t,e,n){},d11f:function(t,e,n){"use strict";n.r(e);n("99af");var i=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"fade"}},[e("el-container",{directives:[{name:"show",rawName:"v-show",value:t.$store.state.isLoaded,expression:"$store.state.isLoaded"}],attrs:{direction:"vertical"}},[e("el-header",{attrs:{height:"60px"}},[e("div",{staticClass:"page-header"},[e("span",[t._v(t._s(t.$t("Blueprint"))+" (WIP)")]),t._v(" "),e("div",{staticClass:"header-control header-control-left"},[e("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:t.openAddBlueprint}},[e("i",{staticClass:"fa fa-fw fa-plus"})]),t._v(" "),e("el-select",{staticClass:"blueprint-list",attrs:{size:"small",placeholder:t.$t("Select Blueprint")},on:{change:function(e){return t.loadData(t.data.id)}},model:{value:t.data.id,callback:function(e){t.$set(t.data,"id",e)},expression:"data.id"}},t._l(t.blueprints,(function(n){return e("el-option",{key:n.id,attrs:{label:n.title,value:n.id}},[e("span",{staticClass:"float-left"},[t._v(t._s(n.title||n.id))]),t._v(" "),n.isDeployed?e("span",{staticClass:"float-right text-good"},[t._v(t._s(t.$t("Deployed")))]):e("span",{staticClass:"float-right text-bad"},[t._v(t._s(t.$t("Not Deployed")))])])})),1),t._v(" "),t.data.id?[e("el-button-group",[e("el-button",{attrs:{size:"small"},on:{click:t.openRenameBlueprint}},[e("i",{staticClass:"fa fa-fw fa-edit"}),t._v(" "+t._s(t.$t("Rename"))+"\n              ")]),t._v(" "),e("el-button",{directives:[{name:"prevent-re-click",rawName:"v-prevent-re-click"}],attrs:{size:"small"},on:{click:t.saveBlueprintCanvas}},[e("i",{staticClass:"fa fa-fw fa-save"}),t._v(" "+t._s(t.$t("Save"))+"\n              ")])],1),t._v(" "),e("el-button",{directives:[{name:"prevent-re-click",rawName:"v-prevent-re-click"}],staticClass:"fix-compact-button",attrs:{type:"primary",plain:"",size:"small"},on:{click:t.deployBlueprintCanvas}},[e("i",{staticClass:"fa fa-fw fa-coffee"}),t._v(" "+t._s(t.$t("Deploy"))+"\n              ")]),t._v(" "),e("el-button",{staticClass:"fix-compact-button",attrs:{size:"small"},on:{click:t.deleteBlueprintCanvas}},[e("i",{staticClass:"fa fa-fw fa-times"}),t._v(" "+t._s(t.$t("Delete"))+"\n            ")])]:t._e()],2)])]),t._v(" "),t.data.canvasJSON?e("super-flow",{ref:"superFlow",attrs:{"graph-menu":t.graphMenu,"node-menu":t.nodeMenu,"link-menu":t.linkMenu,"enter-intercept":t.enterIntercept,"output-intercept":t.outputIntercept,"link-base-style":t.linkBaseStyle,"link-desc":t.linkDesc,"node-list":t.data.canvasJSON.nodeList,"link-list":t.data.canvasJSON.linkList,"before-node-create":t.beforeNodeCreate,"on-node-created":t.onNodeCreated,"before-link-create":t.beforeLinkCreate,"on-link-created":t.onLinkCreated},scopedSlots:t._u([{key:"node",fn:function(n){var i=n.meta;return["start"===i.type?e("el-card",{staticClass:"node-card point-card",attrs:{shadow:"hover"}},[e("span",[t._v(t._s(t.$t("Start")))])]):"end"===i.type?e("el-card",{staticClass:"node-card point-card",attrs:{shadow:"hover"}},[e("span",[t._v(t._s(t.$t("End")))])]):"code"===i.type?e("el-card",{staticClass:"node-card code-step-card",attrs:{shadow:"hover"}},[e("div",{staticClass:"step-header code-step-header"},[e("i",{staticClass:"fa fa-fw fa-file-code-o"})]),t._v(" "),e("div",{staticClass:"node-title"},[e("div",{staticClass:"node-title-content"},[e("span",[t._v(t._s(t.getTitle(i)))])])])]):"branch"===i.type?e("el-card",{staticClass:"node-card branch-step-card",attrs:{shadow:"hover"}},[e("div",{staticClass:"step-header branch-step-header"},[e("i",{staticClass:"fa fa-fw fa-code-fork"})]),t._v(" "),e("div",{staticClass:"node-title"},[e("div",{staticClass:"node-title-content"},[e("span",[t._v(t._s(t.getTitle(i)))])])])]):t._e()]}}],null,!1,1011235252)}):t._e(),t._v(" "),e("el-dialog",{attrs:{title:"add"===t.blueprintPanelMode?t.$t("Add"):t.$t("Rename"),visible:t.showBlueprintPanel,width:"620px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.showBlueprintPanel=e}}},[e("el-form",{attrs:{"label-width":"100px",model:t.form,rules:t.formRules}},["add"===t.blueprintPanelMode?e("el-form-item",{attrs:{label:"ID",prop:"id"}},[e("el-input",{attrs:{disabled:"setup"===t.T.setupPageMode(),maxlength:"80"},model:{value:t.form.id,callback:function(e){t.$set(t.form,"id",e)},expression:"form.id"}})],1):t._e(),t._v(" "),e("el-form-item",{attrs:{label:t.$t("Title")}},[e("el-input",{attrs:{placeholder:t.$t("Optional"),maxlength:"25"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),t._v(" "),e("el-form-item",[e("div",{staticClass:"setup-right"},[e("el-button",{attrs:{type:"primary"},on:{click:t.submitBlueprint}},[t._v(t._s(t.$t("Save")))])],1)])],1)],1),t._v(" "),t.currentItem?e("el-dialog",{attrs:{title:"".concat(t.$t("Setup")," - ").concat(t.currentItem.id),visible:t.showItemConfigPanel,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.showItemConfigPanel=e}}},[e("el-form",{attrs:{"label-width":"100px",model:t.itemMetaConfigForm}},[t.hasConfig(t.currentItem.meta.type,"title")?e("el-form-item",{attrs:{label:t.$t("Title")}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.itemMetaConfigForm.title,callback:function(e){t.$set(t.itemMetaConfigForm,"title",e)},expression:"itemMetaConfigForm.title"}})],1):t._e(),t._v(" "),e("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.hasConfig(t.currentItem.meta.type,"code"),expression:"hasConfig(currentItem.meta.type, 'code')"}],attrs:{label:t.$t("Code")}},[e("InfoBlock",{attrs:{type:"info",title:t.$t('Function "entry_func(prev_result)" is the main func of the node')}}),t._v(" "),e("div",{style:t.$store.getters.codeMirrorSetting.style,attrs:{id:"codeStageContainer_Blueprint"}},[e("textarea",{attrs:{id:"codeStage_Blueprint"}})])],1),t._v(" "),t.hasConfig(t.currentItem.meta.type,"kwargs")?e("el-form-item",{attrs:{label:t.$t("Kwargs"),prop:"kwargs"}},[t._l(t.itemMetaConfigForm.kwargs,(function(n){return e("el-tag",{key:n,attrs:{type:"primary",closable:""},on:{close:function(e){return t.removeKwargs(n)}}},[t._v(t._s(n))])})),t._v(" "),t.showAddKwargs?e("el-input",{ref:"newKwargs",attrs:{size:"mini"},on:{blur:t.addKwargs},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addKwargs.apply(null,arguments)}},model:{value:t.newKwargs,callback:function(e){t.newKwargs=e},expression:"newKwargs"}}):e("el-button",{attrs:{type:"text"},on:{click:t.openAddKwargsInput}},[t._v(t._s(t.$t("Add Kwargs")))])],2):t._e(),t._v(" "),t.hasConfig(t.currentItem.meta.type,"globalVars")?e("el-form-item",{attrs:{label:t.$t("Global Vars"),prop:"globalVars"}},[t._l(t.itemMetaConfigForm.globalVars,(function(n){return e("el-tag",{key:n,attrs:{type:"info",closable:""},on:{close:function(e){return t.removeGlobalVar(n)}}},[t._v(t._s(n))])})),t._v(" "),t.showAddGlobalVar?e("el-input",{ref:"newGlobalVar",attrs:{size:"mini"},on:{blur:t.addGlobalVar},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addGlobalVar.apply(null,arguments)}},model:{value:t.newGlobalVar,callback:function(e){t.newGlobalVar=e},expression:"newGlobalVar"}}):e("el-button",{attrs:{type:"text"},on:{click:t.openAddGlobalVarInput}},[t._v(t._s(t.$t("Add Global Var")))])],2):t._e()],1),t._v(" "),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.showItemConfigPanel=!1}}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.updateItemMeta}},[t._v(t._s(t.$t("Confirm")))])],1)],1):t._e()],1)],1)},r=[],o=n("c7eb"),a=n("1da1"),s=(n("130f"),n("d3b7"),n("159b"),n("e9c4"),n("bf19"),n("7db0"),n("14d9"),n("b64b"),n("4e82"),n("d81d"),n("4de4"),n("a434"),n("d9e2"),n("9911"),function(){var t=this,e=t._self._c;return e("div",{ref:"flow-canvas",staticClass:"super-flow",on:{contextmenu:function(e){return e.preventDefault(),e.stopPropagation(),t.contextmenu.apply(null,arguments)}}},[t.temEdgeConf.visible?e("graph-line",{attrs:{padding:t.linkPadding,graph:t.graph,link:t.temEdgeConf.link,"link-base-style":t.linkBaseStyle,"link-desc":t.linkDesc,"link-style":t.linkStyle}}):t._e(),t._v(" "),t._l(t.graph.linkList,(function(n,i){return e("graph-line",{key:n.key,attrs:{index:i,padding:t.linkPadding,graph:t.graph,link:n,"link-base-style":t.linkBaseStyle,"link-desc":t.linkDesc,"link-style":t.linkStyle}})})),t._v(" "),t.moveNodeConf.isMove&&t.hasMarkLine?e("mark-line",{attrs:{width:t.clientWidth,height:t.clientHeight,"mark-color":t.markLineColor,markLine:t.moveNodeConf.markLine}}):t._e(),t._v(" "),t._l(t.graph.nodeList,(function(n,i){return e("graph-node",{key:n.key,attrs:{index:i,node:n,graph:t.graph,"is-move":n===t.moveNodeConf.node,"is-tem-edge":t.temEdgeConf.visible,"node-intercept":t.nodeIntercept(n),"line-drop":t.linkAddable,"node-drop":t.draggable},on:{"node-mousedown":t.nodeMousedown,"node-mouseenter":t.nodeMouseenter,"node-mouseleave":t.nodeMouseleave,"node-mouseup":t.nodeMouseup,"side-mousedown":t.sideMousedown,"node-contextmenu":t.nodeContextmenu},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.meta;return[t._t("node",null,{meta:n})]}}],null,!0)})})),t._v(" "),e("graph-menu",{attrs:{visible:t.menuConf.visible,graph:t.graph,position:t.menuConf.position,list:t.menuConf.list,source:t.menuConf.source},on:{"update:visible":function(e){return t.$set(t.menuConf,"visible",e)}},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.item;return[t._t("menuItem",null,{item:n})]}}],null,!0)}),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.graph.graphSelected,expression:"graph.graphSelected"}],ref:"selectAllMask",staticClass:"select-all__mask",style:t.maskStyle,attrs:{tabindex:"-1"},on:{blur:function(e){t.graph.graphSelected=!1},mousedown:t.selectAllMaskMouseDown,contextmenu:function(t){t.preventDefault(),t.stopPropagation()}}})],2)}),u=[],c=n("2909"),l=(n("a4d3"),n("e439"),n("dbb4"),n("ade3"));function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){Object(l["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}n("a9e3"),n("6062"),n("3ca3"),n("ddb0"),n("b0c0");function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var p=n("a38e");function m(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Object(p["a"])(i.key),i)}}function v(t,e,n){return e&&m(t.prototype,e),n&&m(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}n("131a");function b(t,e){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},b(t,e)}function g(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&b(t,e)}n("4ae1"),n("f8c9"),n("3410");function y(t){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},y(t)}function k(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var w=n("53ca");function _(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function x(t,e){if(e&&("object"===Object(w["a"])(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _(t)}function C(t){var e=k();return function(){var n,i=y(t);if(e){var r=y(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return x(this,n)}}n("3c65");var O,L=function(){function t(){f(this,t),this.listeners={}}return v(t,[{key:"add",value:function(t,e){t in this.listeners||(this.listeners[t]=[]),this.listeners[t].push(e)}},{key:"remove",value:function(t,e){if(t in this.listeners)for(var n=this.listeners[t],i=0,r=n.length;i<r;i++)if(n[i]===e)return n.splice(i,1),this.remove(t,e)}},{key:"dispatch",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.type in this.listeners){var i=this.listeners[t.type];t.target=this,n?i.some((function(n,r){var o=n.call(e,t);return o&&i.unshift.apply(i,Object(c["a"])(i.splice(r,1))),o})):i.forEach((function(n){return n.call(e,t)}))}}}]),t}();n("13d5"),n("a15b"),n("fb6a");function M(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t.clientX,i=t.clientY,r=t.currentTarget,o=e||r,a=o.getBoundingClientRect(),s=a.left,u=a.top;return[n-s,i-u]}function A(t,e){return[t[0]+e[0],t[1]+e[1]]}function j(t,e){return[t[0]*e,t[1]*e]}function P(t,e){return[e[0]-t[0],e[1]-t[1]]}function S(t,e){return[t[0]-e[0],t[1]-e[1]]}function $(t,e){return t[0]*e[0]+t[1]*e[1]}function I(t,e){return t[0]*e[1]-t[1]*e[0]}function N(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return[t[0]/e,t[1]/e]}function D(t,e){return t[0]===e[0]&&t[1]===e[1]}function B(t){return Math.round(180/Math.PI*Math.atan2(t[1],t[0]))+180}function T(t,e){return t[0]*e[1]-t[1]*e[0]===0}function E(t){var e={add:A,multiply:j,differ:P,minus:S,dotProduct:$,cross:I,unitVector:N,equals:D,angle:B,parallel:T},n={};return Object.keys(e).forEach((function(i){Object.defineProperty(n,i,{get:function(){return function(r){return t=e[i](t,r),n}}})})),Object.defineProperty(n,"end",{get:function(){return t}}),n}function F(t){return Object.prototype.toString.call(t).slice(8,-1).toLocaleLowerCase()}function V(t){return"function"===F(t)}function G(t){return"boolean"===F(t)}function R(t){return"string"===F(t)}function z(t){return"object"===F(t)}function K(t,e){t.splice.apply(t,[0,t.length].concat(Object(c["a"])(e)))}var J={top:1,right:2,bottom:3,left:4},W=(O={},Object(l["a"])(O,J.top,[0,-1]),Object(l["a"])(O,J.right,[1,0]),Object(l["a"])(O,J.bottom,[0,1]),Object(l["a"])(O,J.left,[-1,0]),O),Y=n("40f5"),X=function(){function t(e,n){f(this,t);var i=e.id,r=void 0===i?Y["genDataId"]("node"):i,o=e.width,a=void 0===o?180:o,s=e.height,u=void 0===s?100:s,l=e.coordinate,d=void 0===l?[0,0]:l,h=e.meta,p=void 0===h?null:h;this.key=Y["genDataId"]("node"),this.graph=n,this.id=r,this.coordinate=Object(c["a"])(d),this.meta=p,this.width=a,this.height=u}return v(t,[{key:"position",get:function(){return E(this.coordinate).add(this.graph.origin).end},set:function(t){this.coordinate=E(t).minus(this.graph.origin).end}},{key:"center",get:function(){return E(this.coordinate).add([this.width/2,this.height/2]).end},set:function(t){this.coordinate=E(t).minus([this.width/2,this.height/2]).end}},{key:"width",get:function(){return this._width},set:function(t){t=Math.floor(t),this._width=t>50?t:50,this.angle()}},{key:"height",get:function(){return this._height},set:function(t){t=Math.floor(t),this._height=t>20?t:20,this.angle()}},{key:"angle",value:function(){var t=this.width/2,e=this.height/2,n=[0,0],i=E(n).minus([t,e]).angle().end,r=E(n).add([t,0]).minus([0,e]).angle().end,o=E(n).add([t,e]).angle().end,a=E(n).add([0,e]).minus([t,0]).angle().end;this.angleList=[i,r,o,a]}},{key:"relative",value:function(t){var e=E(t).minus([this.width/2,this.height/2]).angle().end,n=this.angleList,i=[J.top,J.right,J.bottom,J.left],r=J.left;return n.reduce((function(t,n,o){return e>=t&&e<n&&(r=i[o-1]),n})),{position:this.fixOffset(t,r),direction:W[r]}}},{key:"fixOffset",value:function(t,e){switch(e){case J.top:t[0]=this.width/2,t[1]=0;break;case J.right:t[0]=this.width,t[1]=this.height/2;break;case J.bottom:t[0]=this.width/2,t[1]=this.height;break;case J.left:default:t[0]=0,t[1]=this.height/2;break}return t}},{key:"remove",value:function(){return this.graph.removeNode(this)}},{key:"toJSON",value:function(){return{id:this.id,width:this.width,height:this.height,coordinate:Object(c["a"])(this.coordinate),meta:this.meta}}}]),t}();function H(t){if(Array.isArray(t))return t}n("e01a"),n("d28b");function q(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=o.call(n)).done)&&(s.push(i.value),s.length!==e);u=!0);}catch(l){c=!0,r=l}finally{try{if(!u&&null!=n["return"]&&(a=n["return"](),Object(a)!==a))return}finally{if(c)throw r}}return s}}var U=n("06c5");function Z(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Q(t,e){return H(t)||q(t,e)||Object(U["a"])(t,e)||Z()}var tt=function(){function t(e,n){f(this,t);var i=e.id,r=void 0===i?Y["genDataId"]("link"):i,o=e.start,a=e.end,s=void 0===a?null:a,u=e.startAt,c=void 0===u?[0,0]:u,l=e.endAt,d=void 0===l?[0,0]:l,h=e.meta,p=void 0===h?null:h;this.key=Y["genDataId"]("link"),this.id=r,this.graph=n,this.start=o,this.meta=p,this.end=s,this.startDirection=W[J.top],this.endDirection=W[J.top],this.startAt=c,this.endAt=d}return v(t,[{key:"end",get:function(){return this._end},set:function(t){if(this.start===t)return!1;this._end=t}},{key:"startAt",get:function(){return this._startAt},set:function(t){var e=this.start.relative(t);this._startAt=e.position,this.startDirection=e.direction}},{key:"endAt",get:function(){return this._endAt},set:function(t){if(this.end){var e=this.end.relative(t);this._endAt=e.position,this.endDirection=e.direction}else this._endAt=t}},{key:"movePosition",get:function(){return this._movePosition},set:function(t){if(this._movePosition=t,!this.end){var e=this.start.relative(E(t).minus(this.graph.origin).minus(this.start.coordinate).end);this.endDirection=E(e.direction).multiply(-1).end}}},{key:"pathPointList",get:function(){var t=this.coordinateList(),e=[],n=[];return t.forEach((function(t){e.push(t[0]),n.push(t[1])})),{pointList:t,xList:e,yList:n,minX:Math.min.apply(Math,e),maxX:Math.max.apply(Math,e),minY:Math.min.apply(Math,n),maxY:Math.max.apply(Math,n)}}},{key:"startCoordinate",value:function(){return E(this.start.position).add(this.startAt).end}},{key:"endCoordinate",value:function(){return this.end?E(this.end.position).add(this.endAt).end:this.movePosition}},{key:"coordinateList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,n=this.startCoordinate(),i=this.endCoordinate(),r=this.startDirection,o=this.endDirection,a=E(r).multiply(t.distance).add(n).end,s=E(o).multiply(t.distance).add(i).end;o=E(o).multiply(-1).end;var u=[s[0]-a[0],0],c=[0,s[1]-a[1]],l=this.pathDirection(c,u,r),d=this.pathDirection(c,u,o),h=E(l).dotProduct(d).end>0?2:1,f=d===u?c:u,p=[];if(p.push(n,a),1===h){var m=E(a).add(l).end,v=E(m).add(d).end;p.push(m,v)}else{var b=E(l).multiply(e).add(a).end,g=E(b).add(f).end,y=E(d).multiply(1-e).add(g).end;p.push(b,g,y)}return p.push(i),p}},{key:"pathDirection",value:function(t,e,n){return E(e).parallel(n).end?E(e).dotProduct(n).end>0?e:t:E(t).dotProduct(n).end>0?t:e}},{key:"isPointInLink",value:function(t,e){var n=e||this.pathPointList,i=n.pointList,r=n.minX,o=n.minY,a=n.maxX,s=n.maxY,u=5;if(t[0]<r-u||t[0]>a+u||t[1]<o-u||t[1]>s+u)return!1;for(var c=0;c<i.length-2;c++){var l=i[c],d=i[c+1],h=Math.min(l[1],d[1])-u,f=Math.max(l[0],d[0])+u,p=Math.max(l[1],d[1])+u,m=Math.min(l[0],d[0])-u,v=Q(t,2),b=v[0],g=v[1];if(b>m&&b<f&&g>h&&g<p)return!0}return!1}},{key:"remove",value:function(){return this.graph.removeLink(this)}},{key:"toJSON",value:function(){return{id:this.id,startId:this.start.id,endId:this.end.id,startAt:this.startAt,endAt:this.endAt,meta:this.meta}}}]),t}();Object(l["a"])(tt,"distance",15);var et=function(t){g(n,t);var e=C(n);function n(t){var i;f(this,n);var r=t.nodeList,o=void 0===r?[]:r,a=t.linkList,s=void 0===a?[]:a,u=t.origin,c=t.beforeNodeCreate,l=t.onNodeCreated,d=t.beforeLinkCreate,h=t.onLinkCreated;return i=e.call(this),i.nodeList=[],i.linkList=[],i.origin=u,i.mouseonLink=null,i.mouseonNode=null,i.graphSelected=!1,i.maskBoundingClientRect={},i.beforeNodeCreate=c,i.onNodeCreated=l,i.beforeLinkCreate=d,i.onLinkCreated=h,i.initNode(o),i.initLink(s),i}return v(n,[{key:"pointMap",value:function(){var t={};return this.nodeList.forEach((function(e){t[e.id]=e})),t}},{key:"initNode",value:function(t){var e=this;return K(this.nodeList,t.map((function(t){return e.createNode(t)}))),this.nodeList}},{key:"initLink",value:function(t){var e=this,n=[];return t.forEach((function(t){var i=t.startId,r=void 0===i?"":i,o=t.endId,a=void 0===o?"":o,s=t.startAt,u=void 0===s?[0,0]:s,c=t.endAt,l=void 0===c?[0,0]:c,d=t.meta,h=void 0===d?null:d,f=e.pointMap(),p=f[r],m=f[a];p&&m&&n.push(e.createLink({start:p,end:m,meta:h,startAt:u,endAt:l}))})),K(this.linkList,n),this.linkList}},{key:"createNode",value:function(t){return new X(t,this)}},{key:"createLink",value:function(t){return new tt(t,this)}},{key:"addNode",value:function(t){var e=t.constructor===X?t:this.createNode(t);return e=this.beforeNodeCreate(e,this)||e,this.nodeList.push(e),this.onNodeCreated(e,this),e}},{key:"addLink",value:function(t){var e=t.constructor===tt?t:this.createLink(t),n=this.linkList.find((function(t){return t.start===e.start&&t.end===e.end}));return n?(n.startAt=e.startAt,n.endAt=e.endAt):e.start&&e.end&&(e=this.beforeLinkCreate(e,this)||e,this.linkList.push(e),this.onLinkCreated(e,this)),e}},{key:"removeNode",value:function(t){var e=this,n=this.nodeList.indexOf(t);return this.linkList.filter((function(e){return e.start===t||e.end===t})).forEach((function(t){e.removeLink(t)})),this.nodeList.splice(n,1),t}},{key:"removeLink",value:function(t){var e=this.linkList.indexOf(t);return this.linkList.splice(e,1),this.mouseonLink===t&&(this.mouseonLink=null),t}},{key:"toLastNode",value:function(t){var e=this.nodeList;e.splice.apply(e,[e.length-1,0].concat(Object(c["a"])(e.splice(t,1))))}},{key:"toLastLink",value:function(t){var e=this.linkList;e.splice.apply(e,[e.length-1,0].concat(Object(c["a"])(e.splice(t,1))))}},{key:"toJSON",value:function(){return{origin:this.origin,nodeList:this.nodeList.map((function(t){return t.toJSON()})),linkList:this.linkList.map((function(t){return t.toJSON()}))}}},{key:"selectAll",value:function(){var t=this.nodeList,e=20;this.maskBoundingClientRect={top:Math.min.apply(Math,Object(c["a"])(t.map((function(t){return t.center[1]-t.height/2}))))-e,right:Math.max.apply(Math,Object(c["a"])(t.map((function(t){return t.center[0]+t.width/2}))))+e,bottom:Math.max.apply(Math,Object(c["a"])(t.map((function(t){return t.center[1]+t.height/2}))))+e,left:Math.min.apply(Math,Object(c["a"])(t.map((function(t){return t.center[0]-t.width/2}))))-e},this.graphSelected=!0}}]),n}(L),nt=et,it=function(){var t=this,e=t._self._c;return e("div",{staticClass:"super-flow__menu-container"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"flow__menu-mask",on:{mousemove:function(t){t.stopPropagation(),t.preventDefault()},mousedown:t.close}}),t._v(" "),e("ul",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"super-flow__menu",style:t.style,attrs:{tabindex:"-1"},on:{mousemove:function(t){t.stopPropagation(),t.preventDefault()},contextmenu:function(t){t.preventDefault(),t.stopPropagation()},blur:t.close}},[t._l(t.list,(function(n){return[t._l(n,(function(n){return n.hidden&&t.isHidden(n)?t._e():e("li",{staticClass:"super-flow__menu-item",class:{"is-disabled":n.disable},on:{click:function(e){return t.select(n)}}},[t._t("default",(function(){return[e("span",{staticClass:"super-flow__menu-item-icon"},[n.icon?e("i",{staticClass:"fa fa-fw",class:n.icon}):t._e()]),t._v(" "),e("span",{staticClass:"super-flow__menu-item-content"},[t._v("\n            "+t._s(n.label)+"\n          ")])]}),{item:n})],2)})),t._v(" "),e("li",{staticClass:"super-flow__menu-line"})]}))],2)])},rt=[],ot={props:{graph:Object,visible:{type:Boolean,default:!1},list:{type:Array,default:function(){return[]}},position:{type:Array,default:function(){return[0,0]}},source:{type:Object,default:function(){return{}}}},computed:{style:function(){return{left:this.position[0]+"px",top:this.position[1]+"px"}}},methods:{isHidden:function(t){return!0===t.hidden||t.hidden(this.source)},select:function(t){t.disable||(this.$emit("update:visible",!1),t.selected(this.source,E(this.position).minus(this.graph.origin).end))},close:function(t){this.$emit("update:visible",!1)}},watch:{visible:function(){var t=this;this.visible&&this.$nextTick((function(){return t.$el.focus()}))}}},at=ot,st=(n("b19d"),n("2877")),ut=Object(st["a"])(at,it,rt,!1,null,null,null),ct=ut.exports,lt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"super-flow__node",class:{"can-move":t.nodeDrop},style:t.style,attrs:{tabindex:"-1"},on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.nodeMousedown.apply(null,arguments)},mouseenter:t.nodeMouseenter,mouseleave:t.nodeMouseleave,mouseup:t.nodeMouseup,contextmenu:function(e){return e.preventDefault(),e.stopPropagation(),t.nodeContextmenu.apply(null,arguments)}}},[t._t("default",null,{meta:t.node.meta}),t._v(" "),t._l(t.direction,(function(n,i){return e("div",{directives:[{name:"show",rawName:"v-show",value:t.output&&t.lineDrop,expression:"output && lineDrop"}],class:"node-side node-side-".concat(i),on:{contextmenu:function(t){t.stopPropagation(),t.preventDefault()},mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:(e.preventDefault(),e.stopPropagation(),function(e){return t.sideMousedown(e,n)}.apply(null,arguments))}}})}))],2)},dt=[],ht={props:{graph:Object,node:Object,index:Number,isMove:Boolean,isTemEdge:Boolean,nodeIntercept:Function,lineDrop:Boolean,nodeDrop:Boolean},data:function(){return{direction:J,output:this.nodeIntercept()}},computed:{style:function(){var t=this.node,e=t.position,n=t.width,i=t.height;return{width:n+"px",height:i+"px",top:e[1]+"px",left:e[0]+"px"}}},methods:{nodeMousedown:function(t){this.graph.toLastNode(this.index),this.$emit("node-mousedown",this.node,M(t))},nodeMouseenter:function(t){this.output=this.nodeIntercept(),this.graph.mouseonNode=this.node,this.isTemEdge&&this.$emit("node-mouseenter",t,this.node,M(t,this.$el))},nodeMouseleave:function(){this.graph.mouseonNode=null,this.isTemEdge&&this.$emit("node-mouseleave")},nodeMouseup:function(){this.isTemEdge&&this.$emit("node-mouseup")},nodeContextmenu:function(t){this.$emit("node-contextmenu",t,this.node)},sideMousedown:function(t){this.$emit("side-mousedown",t,this.node,M(t,this.$el))}}},ft=ht,pt=(n("73dc"),Object(st["a"])(ft,lt,dt,!1,null,null,null)),mt=pt.exports,vt=function(){var t=this,e=t._self._c;return e("canvas",{staticClass:"super-flow__line"})},bt=[],gt=(n("ac1f"),n("466d"),n("cb29"),{props:{padding:{type:Number,default:50},linkDesc:[Function,null],linkStyle:[Function,null],linkBaseStyle:Object,index:Number,graph:Object,link:Object},data:function(){return{top:0,right:0,bottom:0,left:0,currentPointList:[],currentPathPointList:null}},mounted:function(){var t=this;this.ctx=this.$el.getContext("2d"),this.draw(),this.graph.add("mousemove",this.rootMousemove),this.$once("hook:beforeDestroy",(function(){t.graph.remove("mousemove",t.rootMousemove)}))},computed:{styles:function(){return Object.assign({hover:"#FF0000",color:"#666666",textColor:"#FF6600",textHover:"#FF0000",font:"14px Arial",dotted:!1,lineDash:[4,4],background:"rgba(255,255,255,0.5)"},this.linkBaseStyle)},inPath:{get:function(){return this.graph.mouseonLink===this.link},set:function(t){t&&!this.graph.mouseonNode?(this.graph.mouseonLink=this.link,this.$el.style.zIndex="1",this.graph.toLastLink(this.index)):this.inPath&&(this.graph.mouseonLink=null,this.$el.style.zIndex="0")}}},methods:{draw:function(){var t=this,e=this.currentPathPointList=this.link.pathPointList,n=e.pointList,i=e.minX,r=e.minY,o=e.maxX,a=e.maxY;this.top=r-this.padding,this.right=o+this.padding,this.bottom=a+this.padding,this.left=i-this.padding,this.currentPointList=n.map((function(e){return[Math.floor(e[0]-t.left),Math.floor(e[1]-t.top)]})),this.changeStyle(),this.initLine()},changeStyle:function(){this.$el.width=this.right-this.left,this.$el.height=this.bottom-this.top,this.$el.style.top=this.top+"px",this.$el.style.left=this.left+"px"},initLine:function(){if(this.ctx.clearRect(0,0,this.$el.width,this.$el.height),this.linkStyle){var t=this.linkStyle(this.link);z(t)&&Object.assign(this.styles,t)}if(this.inPath){var e=this.styles.hover,n=this.styles.textHover;this.drawLine(e),this.drawDesc(n),this.drawArrow(e)}else{var i=this.styles.color,r=this.styles.textColor;this.drawLine(i),this.drawDesc(r),this.drawArrow(i)}},drawLine:function(t){var e=2,n=this.ctx;n.lineJoin="round",n.beginPath(),this.styles.dotted&&n.setLineDash(this.styles.lineDash),n.lineWidth=e,n.strokeStyle=t,this.currentPointList.forEach((function(t,e){0===e?n.moveTo.apply(n,Object(c["a"])(t)):(n.lineTo.apply(n,Object(c["a"])(t)),n.stroke())})),n.save()},drawDesc:function(t){var e,n=this.ctx;if(V(this.linkDesc)&&(e=this.linkDesc(this.link)),R(e)){var i=this.styles,r=i.font,o=i.background;this.ctx.font=r,this.ctx.textAlign="center",this.ctx.textBaseline="middle";var a=this.descIntercept(e),s=a.text,u=a.width;u>0&&(u+=6);var l=parseInt(r.match(/(\d+px)/g)[0])+6,d=this.descPosition(),h=E(d).minus([u/2,l/2]).end;this.ctx.fillStyle=o,n.fillRect(h[0],h[1],u,l),this.ctx.fillStyle=t,n.fillText.apply(n,[s].concat(Object(c["a"])(d)))}},descPosition:function(){var t=0,e=0,n=null;return this.currentPointList.reduce((function(e,n){var i=E(e).minus(n).end;return t+=Math.abs(i[0])+Math.abs(i[1]),n})),this.currentPointList.reduce((function(i,r){var o=E(i).minus(r).end,a=Math.abs(o[0])+Math.abs(o[1]),s=e,u=t/2;return e+=a,e>=t/2&&null===n&&(n=i,n=i[0]===r[0]?i[1]<r[1]?E(i).add([0,u-s]).end:E(i).add([0,-(u-s)]).end:i[0]<r[0]?E(i).add([u-s,0]).end:E(i).add([-(u-s),0]).end),r})),n},descIntercept:function(t){var e=this.ctx,n=e.measureText(t).width,i=2*this.padding-10,r="...",o=e.measureText(r).width;if(n<=i||i<=o)return{text:t,width:n};var a=t.length;while(n>=i-o&&a-- >0)t=t.slice(0,a),n=e.measureText(t).width;return{text:t+r,width:i+o}},drawArrow:function(t){var e=6,n=this.currentPointList.length;if(!(n<2)){var i=this.currentPointList[n-2],r=this.currentPointList[n-1],o=this.ctx;o.translate.apply(o,Object(c["a"])(r));var a=Math.atan((r[0]-i[0])/(r[1]-i[1]));o.beginPath(),r[1]-i[1]>=0?o.rotate(-a):o.rotate(Math.PI-a),o.fillStyle=t,o.lineTo(-e,2*-e),o.lineTo(e,2*-e),o.lineTo(0,0),o.closePath(),o.fill(),o.restore()}},getCoordinates:function(t){var e=t.clientX,n=t.clientY,i=this.$el.getBoundingClientRect(),r=i.top,o=i.left;return[e-o,n-r]},isPointInStroke:function(t){var e=this.getCoordinates(t),n=Q(e,2),i=n[0],r=n[1];return this.link.isPointInLink([this.left+i,this.top+r],this.currentPathPointList)},rootMousemove:function(t){var e=t.evt;return this.inPath=this.isPointInStroke(e),this.inPath}},watch:{"link.pathPointList":function(){this.draw()},inPath:function(){this.initLine()},"link.meta":{deep:!0,handler:function(){this.draw()}},linkBaseStyle:{deep:!0,handler:function(){this.draw()}}}}),yt=gt,kt=(n("0212"),Object(st["a"])(yt,vt,bt,!1,null,null,null)),wt=kt.exports,_t=function(){var t=this,e=t._self._c;return e("canvas",{ref:"markLine",staticClass:"super-flow__mark-line"})},xt=[],Ct={props:{width:{type:Number,default:0},height:{type:Number,default:0},markLine:Array,markColor:String},mounted:function(){this.$refs.markLine.height=this.height,this.$refs.markLine.width=this.width,this.draw()},methods:{draw:function(){var t=this.$el.getContext("2d");t.clearRect(0,0,this.width,this.height),t.strokeStyle=this.markColor,t.lineWidth=1,t.setLineDash([4,2]),this.markLine.forEach((function(e){var n=Q(e,2),i=n[0],r=n[1];t.beginPath(),t.moveTo.apply(t,Object(c["a"])(i)),t.lineTo.apply(t,Object(c["a"])(r)),t.stroke()}))}},watch:{markLine:function(){this.draw()}}},Ot=Ct,Lt=(n("8abe"),Object(st["a"])(Ot,_t,xt,!1,null,null,null)),Mt=Lt.exports,At={name:"super-flow",props:{draggable:{type:Boolean,default:!0},linkAddable:{type:Boolean,default:!0},linkEditable:{type:Boolean,default:!0},hasMarkLine:{type:Boolean,default:!0},linkDesc:{type:[Function,null],default:null},linkStyle:{type:[Function,null],default:null},linkBaseStyle:{type:Object,default:function(){return{}}},markLineColor:{type:String,default:"#ff6600"},origin:{type:Array,default:function(){return[0,0]}},nodeList:{type:Array,default:function(){return[]}},linkList:{type:Array,default:function(){return[]}},graphMenu:{type:Array,default:function(){return[]}},nodeMenu:{type:Array,default:function(){return[]}},linkMenu:{type:Array,default:function(){return[]}},linkPadding:{type:Number,default:50},enterIntercept:{type:Function,default:function(){return!0}},outputIntercept:{type:Function,default:function(){return!0}},beforeNodeCreate:{type:Function,default:function(){return null}},onNodeCreated:{type:Function,default:function(){return null}},beforeLinkCreate:{type:Function,default:function(){return null}},onLinkCreated:{type:Function,default:function(){return null}}},data:function(){return{graph:new nt({width:this.width,height:this.height,origin:this.origin,beforeNodeCreate:this.beforeNodeCreate,onNodeCreated:this.onNodeCreated,beforeLinkCreate:this.beforeLinkCreate,onLinkCreated:this.onLinkCreated}),menuConf:{visible:!1,position:[0,0],source:null,list:[]},moveNodeConf:{isMove:!1,node:null,offset:null,verticalList:[],horizontalList:[],markLine:[]},moveAllConf:{isMove:!1,downPosition:[0,0]},temEdgeConf:{visible:!1,link:null},loaded:!1,clientWidth:0,clientHeight:0}},components:{GraphMenu:ct,GraphNode:mt,GraphLine:wt,MarkLine:Mt},computed:{maskStyle:function(){var t=this.graph.maskBoundingClientRect,e=t.top,n=t.right,i=t.bottom,r=t.left;return{width:"".concat(n-r,"px"),height:"".concat(i-e,"px"),top:"".concat(e+this.graph.origin[1],"px"),left:"".concat(r+this.graph.origin[0],"px")}}},mounted:function(){var t=this;document.addEventListener("mouseup",this.docMouseup),document.addEventListener("mousemove",this.docMousemove),this.$once("hook:beforeDestroy",(function(){document.removeEventListener("mouseup",t.docMouseup),document.removeEventListener("mousemove",t.docMousemove)})),this.$nextTick((function(){t.graph.initNode(t.nodeList),t.graph.initLink(t.linkList)}))},methods:{initMenu:function(t,e){return t.map((function(t){return t.map((function(t){var n,i;return n=V(t.disable)?t.disable(e):G(t.disable)?t.disable:Boolean(t.disable),i=V(t.hidden)?t.hidden(e):G(t.hidden)?t.hidden:Boolean(t.hidden),h(h({},t),{},{disable:n,hidden:i})})).filter((function(t){return!t.hidden}))})).filter((function(t){return t.length}))},showContextMenu:function(t,e,n){e.length&&(this.$set(this.menuConf,"position",t),this.$set(this.menuConf,"list",e),this.$set(this.menuConf,"source",n),this.menuConf.visible=!0)},docMouseup:function(t){this.moveNodeConf.isMove&&(t.stopPropagation(),t.preventDefault()),this.moveNodeConf.isMove=!1,this.moveNodeConf.node=null,this.moveNodeConf.offset=null,K(this.moveNodeConf.markLine,[]),this.temEdgeConf.visible=!1,this.temEdgeConf.link=null,this.moveAllConf.isMove=!1},docMousemove:function(t){this.moveNodeConf.isMove?this.moveNode(t):this.temEdgeConf.visible?this.moveTemEdge(t):this.graph.graphSelected?this.moveWhole(t):this.linkEditable&&this.graph.dispatch({type:"mousemove",evt:t},!0)},moveNode:function(t){var e=this,n=10,i=this.moveNodeConf,r=this.graph.origin,o=E(i.offset).differ(M(t,this.$el)).minus(r).add([i.node.width/2,i.node.height/2]).end;if(this.hasMarkLine){var a=[];i.verticalList.some((function(t){var i=o[0],s=t-n<i&&t+n>i;return s&&(o[0]=t,t=Math.floor(t),t+=r[0],t+=t%1===0?.5:0,a.push([[t,0],[t,e.clientHeight]])),s})),i.horizontalList.some((function(t){var i=o[1],s=t-n<i&&t+n>i;return s&&(o[1]=t,t=Math.floor(t),t+=r[1],t+=t%1===0?.5:0,a.push([[0,t],[e.clientWidth,t]])),s})),K(i.markLine,a)}i.node.center=o},moveTemEdge:function(t){this.temEdgeConf.link.movePosition=M(t,this.$el)},moveWhole:function(t){if(this.moveAllConf.isMove){var e=E(this.moveAllConf.downPosition).differ([t.clientX,t.clientY]).end;K(this.graph.origin,E(this.moveAllConf.origin).add(e).end)}},contextmenu:function(t){var e,n,i=this.graph.mouseonLink,r=M(t);i&&i.isPointInLink(r)?(e=this.initMenu(this.linkMenu,i),n=i):(i&&(this.graph.mouseonLink=null),e=this.initMenu(this.graphMenu,this.graph),n=this.graph),this.showContextMenu(r,e,n)},nodeMousedown:function(t,e){if(this.draggable){this.clientWidth=this.$el.clientWidth,this.clientHeight=this.$el.clientHeight;var n=this.moveNodeConf.verticalList,i=this.moveNodeConf.horizontalList,r=this.graph.nodeList.filter((function(e){return e!==t})).map((function(t){return t.center}));K(n,Object(c["a"])(new Set(r.map((function(t){return t[0]})))).sort((function(t,e){return t-e}))),K(i,Object(c["a"])(new Set(r.map((function(t){return t[1]})))).sort((function(t,e){return t-e}))),this.moveNodeConf.isMove=!0,this.moveNodeConf.node=t,this.moveNodeConf.offset=e}},nodeMouseenter:function(t,e,n){var i=this.temEdgeConf.link;this.enterIntercept(i.start,e,this.graph)&&(i.end=e,i.endAt=n)},nodeMouseleave:function(){this.temEdgeConf.link.end=null},nodeMouseup:function(){this.graph.addLink(this.temEdgeConf.link)},nodeContextmenu:function(t,e){var n=this.initMenu(this.nodeMenu,e);n.length&&(this.$set(this.menuConf,"position",M(t,this.$el)),this.$set(this.menuConf,"list",n),this.$set(this.menuConf,"source",e),this.menuConf.visible=!0)},sideMousedown:function(t,e,n){if(this.linkAddable){var i=this.graph.createLink({start:e,startAt:n});i.movePosition=M(t,this.$el),this.$set(this.temEdgeConf,"link",i),this.temEdgeConf.visible=!0}},nodeIntercept:function(t){var e=this;return function(){return e.outputIntercept(t,e.graph)}},menuItemSelect:function(){this.menuConf.visible=!1},selectAllMaskMouseDown:function(t){this.moveAllConf.isMove=!0,this.moveAllConf.origin=Object(c["a"])(this.graph.origin),this.moveAllConf.downPosition=[t.clientX,t.clientY]},selectedAll:function(){this.graph.selectAll()},toJSON:function(){return this.graph.toJSON()},getMouseCoordinate:function(t,e){var n=M({clientX:t,clientY:e},this.$el);return E(n).minus(this.graph.origin).end},addNode:function(t){return this.graph.addNode(t)}},watch:{"graph.graphSelected":function(){var t=this;this.graph.graphSelected&&this.$nextTick((function(){t.$refs.selectAllMask.focus()}))},"graph.mouseonLink":function(){this.graph.mouseonLink?document.body.style.cursor="pointer":document.body.style.cursor=""},origin:function(){this.graph.origin=this.origin||[]},nodeList:function(){this.graph.initNode(this.nodeList)},linkList:function(){this.graph.initLink(this.linkList)}},install:function(t){t.component(this.name,this)}},jt=At,Pt=(n("969e"),Object(st["a"])(jt,s,u,!1,null,null,null)),St=Pt.exports,$t=(n("498a"),n("56d7")),It=function(t){return $t["default"]?$t["default"].$t(t):t};function Nt(t,e){var n={start:["kwargs","globalVars"],end:[],code:["title","code"],branch:["title","code"]};return!!(n[t]&&n[t].indexOf(e)>=0)}function Dt(t,e){var n=t.find((function(t){return"start"===t.meta.type})),i=e.find((function(t){return t.startId===n.id})),r=[];r.push("'''"),r.push("This Script is auto generated by the Blueprint Mode"),r.push("You can change the code by your self,"),r.push("but all your changes will lose after you deployed the Blueprint again."),r.push("'''"),n.meta.globalVars&&(r.push("# Global Variables\n"),n.meta.globalVars.forEach((function(t){r.push("".concat(t," = None"))})));var o="",a="",s=n.meta.kwargs||[];s.length>0&&(o=s.map((function(t){return"".concat(t,"=None")})).join(", "),a=s.map((function(t){return"".concat(t,"=").concat(t)})).join(", ")),r.push(""),r.push("# Blueprint entry/exit\n"),r.push("def start(".concat(o,"):")),r.push("    # Entry of blueprint"),r.push("    next_node = '".concat(i.endId,"'")),r.push("    prev_res = dict(".concat(a,")")),r.push(""),r.push("    for i in range(1000):"),r.push("        # Func call depth limit"),r.push("        next_func = _FUNC_MAP[next_node]"),r.push("        func_res = next_func(prev_res)"),r.push(""),r.push("        if next_node == 'end':"),r.push("            break"),r.push("        else:"),r.push("            next_node, prev_res = func_res"),r.push(""),r.push("    return prev_res"),r.push(""),r.push("def end(prev_res):"),r.push("    # Exit of blueprint"),r.push("    return prev_res");var u=r.join("\n");return u=u.trim(),u}function Bt(t,e){var n=[];return n.push("# Node funcs\n"),t.forEach((function(t){if(Nt(t.meta.type,"code")){n.push("def ".concat(t.meta.id,"(prev_res):")),t.meta.title&&(n.push("    '''"),n.push("    ".concat(t.meta.title)),n.push("    '''")),(t.meta.code||Ft()).split("\n").forEach((function(t){n.push("    "+t)})),n.push("");var i=e.filter((function(e){return e.startId===t.id}));if("branch"===t.meta.type){var r=i.find((function(t){return"nextOnTrue"===t.meta.type}));if(!r)throw Error(It("Missing branch for True"));var o=i.find((function(t){return"nextOnFalse"===t.meta.type}));if(!o)throw Error(It("Missing branch for False"));n.push("    return '".concat(r.endId,"' if entry_func(prev_res) else '").concat(o.endId,"', prev_res"))}else{var a=i[0];if(!a)throw Error(It("Incomplete processing flow"));n.push("    return '".concat(i[0].endId,"', entry_func(prev_res)"))}n.push("")}})),n.join("\n")}function Tt(t){var e=[];return e.push("# Link map\n"),e.push("_FUNC_MAP = {"),t.forEach((function(t){e.push("    '".concat(t.id,"': ").concat(t.id,","))})),e.push("}"),e.join("\n")}function Et(t,e){if(!t||t.length<=0)return"";if(!e||e.length<=0)return"";t.sort((function(t,e){return t.id<e.id?-1:t.id>e.id?1:0}));var n=Dt(t,e),i=Bt(t,e),r=Tt(t,e),o=[n,i,r].join("\n\n");return o}function Ft(){var t=[];return t.push("def entry_func(prev_res):"),t.push("    return prev_res"),t.join("\n")}var Vt={name:"Blueprint",components:{SuperFlow:St},watch:{$route:{immediate:!0,handler:function(t,e){var n=this;return Object(a["a"])(Object(o["a"])().mark((function t(){return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.loadData();case 2:case"end":return t.stop()}}),t)})))()}},"$store.state.uiLocale":function(){var t=this;setImmediate((function(){t.$refs.superFlow.graph.linkList.forEach((function(t){t.meta.updateTime=(new Date).toISOString()}))}))},codeMirrorTheme:function(t){this.codeMirror.setOption("theme",t)}},methods:{_getGraph:function(){return this.$refs.superFlow?this.$refs.superFlow.graph:null},_dumpGraph:function(){return JSON.stringify(JSON.stringify(this._getGraph().toJSON()))},loadData:function(t){var e=this;return Object(a["a"])(Object(o["a"])().mark((function n(){var i;return Object(o["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.T.callAPI_getAll("/api/v1/blueprints/do/list");case 2:if(i=n.sent,i&&i.ok){n.next=5;break}return n.abrupt("return");case 5:e.blueprints=i.data,t?e.data=e.blueprints.find((function(e){return e.id===t})):e.blueprints.length>0?e.data=e.blueprints[0]:e.data={},e.$store.commit("updateLoadStatus",!0);case 8:case"end":return n.stop()}}),n)})))()},goToStartFunc:function(t){var e="".concat(t,"__blueprint"),n="".concat(e,".start");this.$store.commit("updateEditor_selectedItemId",n),this.$router.push({name:"code-viewer",params:{id:e}})},openAddBlueprint:function(){this.blueprintPanelMode="add",this.T.jsonClear(this.form),this.showBlueprintPanel=!0},openRenameBlueprint:function(){var t=this;this.blueprintPanelMode="rename",this.T.jsonClear(this.form);var e={};Object.keys(this.form).forEach((function(n){return e[n]=t.data[n]})),this.form=e,this.showBlueprintPanel=!0},submitBlueprint:function(){var t=this;return Object(a["a"])(Object(o["a"])().mark((function e(){var n,i;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=null,i=null,e.t0=t.blueprintPanelMode,e.next="add"===e.t0?5:"rename"===e.t0?12:19;break;case 5:return e.next=7,t.T.callAPI("post","/api/v1/blueprints/do/add",{body:{data:{id:t.form.id,title:t.form.title,canvasJSON:t.genInitCanvasJSON()}},alert:{okMessage:t.$t("Blueprint created")}});case 7:if(n=e.sent,n&&n.ok){e.next=10;break}return e.abrupt("return");case 10:return i=n.data.id,e.abrupt("break",19);case 12:return e.next=14,t.T.callAPI("post","/api/v1/blueprints/:id/do/modify",{params:{id:t.data.id},body:{data:{title:t.form.title}},alert:{okMessage:t.$t("Blueprint saved")}});case 14:if(n=e.sent,n&&n.ok){e.next=17;break}return e.abrupt("return");case 17:return i=t.data.id,e.abrupt("break",19);case 19:t.loadData(i),t.showBlueprintPanel=!1;case 21:case"end":return e.stop()}}),e)})))()},deployBlueprintCanvas:function(){var t=this;return Object(a["a"])(Object(o["a"])().mark((function e(){var n,i,r,a,s;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.saveBlueprintCanvas();case 2:return n=e.sent,i=Et(n.nodeList,n.linkList),r=t.data.id,a="".concat(r,"__blueprint"),e.next=8,t.T.callAPI_getOne("/api/v1/script-sets/do/list",r);case 8:if(s=e.sent,s&&s.ok){e.next=11;break}return e.abrupt("return");case 11:if(s.data){e.next=17;break}return e.next=14,t.T.callAPI("post","/api/v1/script-sets/do/add",{body:{data:{id:r,title:t.data.title||null}}});case 14:if(s=e.sent,s&&s.ok){e.next=17;break}return e.abrupt("return");case 17:return e.next=19,t.T.callAPI_getOne("/api/v1/scripts/do/list",a);case 19:if(s=e.sent,s&&s.ok){e.next=22;break}return e.abrupt("return");case 22:if(s.data){e.next=30;break}return e.next=25,t.T.callAPI("post","/api/v1/scripts/do/add",{body:{data:{id:a,title:"Blueprint",codeDraft:i}}});case 25:if(s=e.sent,s&&s.ok){e.next=28;break}return e.abrupt("return");case 28:e.next=35;break;case 30:return e.next=32,t.T.callAPI("post","/api/v1/scripts/:id/do/modify",{params:{id:a},body:{data:{codeDraft:i}}});case 32:if(s=e.sent,s&&s.ok){e.next=35;break}return e.abrupt("return");case 35:return e.next=37,t.T.callAPI("post","/api/v1/scripts/:id/do/publish",{params:{id:a},body:{force:!0,wait:!0}});case 37:if(s=e.sent,s&&s.ok){e.next=40;break}return e.abrupt("return");case 40:return e.next=42,t.T.callAPI("post","/api/v1/blueprints/:id/do/modify",{params:{id:t.data.id},body:{data:{isDeployed:!0}},alert:{okMessage:t.$t("Blueprint deployed")}});case 42:if(s=e.sent,s&&s.ok){e.next=45;break}return e.abrupt("return");case 45:t.goToStartFunc(t.data.id);case 46:case"end":return e.stop()}}),e)})))()},saveBlueprintCanvas:function(){var t=this;return Object(a["a"])(Object(o["a"])().mark((function e(){var n;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t._getGraph().toJSON(),e.next=3,t.T.callAPI("post","/api/v1/blueprints/:id/do/modify",{params:{id:t.data.id},body:{data:{canvasJSON:n,isDeployed:!1}},alert:{okMessage:t.$t("Blueprint saved")}});case 3:return e.sent,t.loadData(t.data.id),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})))()},deleteBlueprintCanvas:function(){var t=this;return Object(a["a"])(Object(o["a"])().mark((function e(){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.T.confirm(t.$t("Are you sure you want to delete the Blueprint?"));case 2:if(e.sent){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,t.T.callAPI("/api/v1/blueprints/:id/do/delete",{params:{id:t.data.id},alert:{okMessage:t.$t("Blueprint deleted")}});case 6:e.sent,t.loadData();case 8:case"end":return e.stop()}}),e)})))()},genInitCanvasJSON:function(){return{linkList:[{id:"link-001",meta:{type:"next"},endId:"code_step_1",endAt:[0,25],startId:"start",startAt:[60,30]},{id:"link-002",meta:{type:"next"},endId:"end",endAt:[0,30],startId:"code_step_1",startAt:[200,25]}],nodeList:[{id:"start",meta:{id:"start",type:"start"},width:60,height:60,coordinate:[76,53]},{id:"end",meta:{id:"end",type:"end"},width:60,height:60,coordinate:[558,53]},{id:"code_step_1",meta:{id:"code_step_1",type:"code"},width:200,height:50,coordinate:[253,58]}]}},createNodeData:function(t,e){e=e||{};var n=null;switch(t){case"start":case"end":n=t;break;case"code":case"branch":n="".concat(t,"_step_1");var i=this.$refs.superFlow.graph.nodeList.filter((function(e){return e.meta.type===t})).map((function(t){return parseInt(t.id.split("_").pop())})).sort().pop();n=i?"".concat(t,"_step_").concat(i+1):"".concat(t,"_step_1");break}var r={id:n,coordinate:e.coordinate||[30,30],meta:{id:n,type:t,title:e.title||null,updateTime:(new Date).toISOString()}};switch(r.meta.type){case"start":case"end":r.width=60,r.height=60;break;case"code":case"branch":r.width=200,r.height=50;break}return r},createLinkMeta:function(t,e){e=e||{};var n={type:t,title:e.title,updateTime:(new Date).toISOString()};switch(t){case"next":break;case"nextOnTrue":break;case"nextOnFalse":break}return n},updateItemMeta:function(){this.currentItem.meta=this.T.jsonCopy(this.itemMetaConfigForm),this.currentItem.meta.updateTime=(new Date).toISOString(),this.codeMirror&&this.hasConfig(this.currentItem.meta.type,"code")&&(this.currentItem.meta.code=this.codeMirror.getValue()),this.showItemConfigPanel=!1},enterIntercept:function(t,e,n){return("start"!==t.meta.type||"end"!==e.meta.type)&&"start"!==e.meta.type},outputIntercept:function(t,e){switch(t.meta.type){case"start":return e.linkList.filter((function(e){return e.start.id===t.id})).length<=0;case"end":return!1;case"code":return e.linkList.filter((function(e){return e.start.id===t.id})).length<=0;case"branch":return e.linkList.filter((function(e){return e.start.id===t.id})).length<=1;default:return!0}},linkDesc:function(t){return this.getTitle(t.meta)},hasConfig:function(t,e){return Nt(t,e)},getTitle:function(t){if(!t)return"";if(t.title)return t.title;switch(t.type){case"code":return this.$t("Process Step");case"branch":return this.$t("Branch Step");case"nextOnTrue":return this.$t("True");case"nextOnFalse":return this.$t("False");default:return""}},beforeNodeCreate:function(t,e){},onNodeCreated:function(t,e){return Object(a["a"])(Object(o["a"])().mark((function t(){return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})))()},beforeLinkCreate:function(t,e){var n=e.nodeList.find((function(e){return e.id===t.start.id}));return"branch"===n.meta.type?0===e.linkList.filter((function(t){return t.start.id===n.id&&"nextOnTrue"===t.meta.type})).length?t.meta=this.createLinkMeta("nextOnTrue"):t.meta=this.createLinkMeta("nextOnFalse"):t.meta=this.createLinkMeta("next"),t},onLinkCreated:function(t,e){return Object(a["a"])(Object(o["a"])().mark((function t(){return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})))()},removeKwargs:function(t){this.itemMetaConfigForm.kwargs.splice(this.itemMetaConfigForm.kwargs.indexOf(t),1)},openAddKwargsInput:function(){var t=this;this.showAddKwargs=!0,this.$nextTick((function(e){t.$refs.newKwargs.$refs.input.focus()}))},addKwargs:function(){var t=this.newKwargs;t&&(Array.isArray(this.itemMetaConfigForm.kwargs)||this.$set(this.itemMetaConfigForm,"kwargs",[]),this.itemMetaConfigForm.kwargs.push(t)),this.showAddKwargs=!1,this.newKwargs=""},removeGlobalVar:function(t){this.itemMetaConfigForm.globalVars.splice(this.itemMetaConfigForm.globalVars.indexOf(t),1)},openAddGlobalVarInput:function(){var t=this;this.showAddGlobalVar=!0,this.$nextTick((function(e){t.$refs.newGlobalVar.$refs.input.focus()}))},addGlobalVar:function(){var t=this.newGlobalVar;t&&(Array.isArray(this.itemMetaConfigForm.globalVars)||this.$set(this.itemMetaConfigForm,"globalVars",[]),this.itemMetaConfigForm.globalVars.push(t)),this.showAddGlobalVar=!1,this.newGlobalVar=""}},computed:{formRules:function(){var t=this;return{id:[{trigger:"change",message:this.$t("Please input ID"),required:!0},{trigger:"change",message:this.$t("Only alphabets, numbers and underscore are allowed"),pattern:/^[a-zA-Z0-9_]*$/g},{trigger:"change",message:this.$t("Cannot not starts with a number"),pattern:/^[^0-9]/g},{trigger:"change",validator:function(e,n,i){if(n.indexOf("__")>=0){var r=t.$t('ID cannot contains double underscore "__"');return i(new Error(r))}return i()}}]}},graphMenu:function(){var t=this;return[[{icon:"fa-file-code-o",label:this.$t("Add Process Step"),selected:function(e,n){e.addNode(t.createNodeData("code",{coordinate:n}))}},{icon:"fa-code-fork",label:this.$t("Add Branch Step"),selected:function(e,n){e.addNode(t.createNodeData("branch",{coordinate:n}))}}],[{icon:"fa-mouse-pointer",label:this.$t("Select all"),selected:function(t,e){t.selectAll()}}]]},nodeMenu:function(){var t=this;return[[{icon:"fa-edit",label:this.$t("Setup"),disable:!1,hidden:function(t){return"end"===t.meta.type},selected:function(e,n){var i=t.T.jsonCopy(e.meta);t.currentItem=e,t.currentItem.meta=i,t.$set(t,"itemMetaConfigForm",i),t.showItemConfigPanel=!0,t.hasConfig(e.meta.type,"code")&&setImmediate((function(){document.querySelector("#codeStage_Blueprint + .CodeMirror")||(t.codeMirror=t.T.initCodeMirror("codeStage_Blueprint"),t.codeMirror.setOption("theme",t.codeMirrorTheme)),t.codeMirror.setValue(i.code||Ft()),t.codeMirror.refresh()}))}},{icon:"fa-times",label:this.$t("Delete"),disable:!1,hidden:function(t){return["start","end"].indexOf(t.meta.type)>=0},selected:function(t,e){t.remove()}}]]},linkMenu:function(){return[[{icon:"fa-times",label:this.$t("Delete"),disable:!1,selected:function(t,e){t.remove()}}]]},linkBaseStyle:function(){var t=this.$store.getters.uiColorSchema,e={background:"light"===t?"white":"#222222",font:"16px Iosevka"};return e},codeMirrorTheme:function(){return this.T.getCodeMirrorThemeName()}},props:{},data:function(){return{data:{},form:{id:null,title:null},blueprints:[],blueprintPanelMode:"",showBlueprintPanel:!1,showItemConfigPanel:!1,showAddKwargs:!1,newKwargs:"",showAddGlobalVar:!1,newGlobalVar:"",currentItem:null,itemMetaConfigForm:{title:null,code:null,kwargs:[],globalVars:[]},codeMirror:null}},created:function(){},mounted:function(){window._DFF_Blueprint=this},beforeDestroy:function(){this.T.destoryCodeMirror(this.codeMirror)}},Gt=Vt,Rt=(n("0f3d"),n("42ad")),zt=Object(st["a"])(Gt,i,r,!1,null,"34ae0857",null);"function"===typeof Rt["default"]&&Object(Rt["default"])(zt);e["default"]=zt.exports},d86b:function(t,e,n){var i=n("d039");t.exports=i((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}}))},dbb4:function(t,e,n){var i=n("23e7"),r=n("83ab"),o=n("56ef"),a=n("fc6a"),s=n("06cf"),u=n("8418");i({target:"Object",stat:!0,sham:!r},{getOwnPropertyDescriptors:function(t){var e,n,i=a(t),r=s.f,c=o(i),l={},d=0;while(c.length>d)n=r(i,e=c[d++]),void 0!==n&&u(l,e,n);return l}})},e439:function(t,e,n){var i=n("23e7"),r=n("d039"),o=n("fc6a"),a=n("06cf").f,s=n("83ab"),u=r((function(){a(1)})),c=!s||u;i({target:"Object",stat:!0,forced:c,sham:!s},{getOwnPropertyDescriptor:function(t,e){return a(o(t),e)}})},e57a:function(t,e,n){},f183:function(t,e,n){var i=n("23e7"),r=n("e330"),o=n("d012"),a=n("861d"),s=n("1a2d"),u=n("9bf2").f,c=n("241c"),l=n("057f"),d=n("4fad"),h=n("90e3"),f=n("bb2f"),p=!1,m=h("meta"),v=0,b=function(t){u(t,m,{value:{objectID:"O"+v++,weakData:{}}})},g=function(t,e){if(!a(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!s(t,m)){if(!d(t))return"F";if(!e)return"E";b(t)}return t[m].objectID},y=function(t,e){if(!s(t,m)){if(!d(t))return!0;if(!e)return!1;b(t)}return t[m].weakData},k=function(t){return f&&p&&d(t)&&!s(t,m)&&b(t),t},w=function(){_.enable=function(){},p=!0;var t=c.f,e=r([].splice),n={};n[m]=1,t(n).length&&(c.f=function(n){for(var i=t(n),r=0,o=i.length;r<o;r++)if(i[r]===m){e(i,r,1);break}return i},i({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:l.f}))},_=t.exports={enable:w,fastKey:g,getWeakData:y,onFreeze:k};o[m]=!0},f8c9:function(t,e,n){var i=n("23e7"),r=n("da84"),o=n("d44e");i({global:!0},{Reflect:{}}),o(r.Reflect,"Reflect",!0)},fab5:function(t,e,n){}}]);