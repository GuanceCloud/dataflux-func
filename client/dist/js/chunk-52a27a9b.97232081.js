(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-52a27a9b"],{2706:function(e,t,a){"use strict";var r=a("cb4c"),n=a.n(r);t["default"]=n.a},2939:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"randomIDString":"bat-{Random ID}","parameterHint":"When a parameter is set to \\"INPUT_BY_CALLER\\" means the parameter can be specified by the caller"}}'),delete e.options._Ctor}},"59c5":function(e,t,a){"use strict";a("5a77")},"5a77":function(e,t,a){},"6a77":function(e,t,a){"use strict";var r=a("2939"),n=a.n(r);t["default"]=n.a},a434:function(e,t,a){"use strict";var r=a("23e7"),n=a("23cb"),s=a("a691"),o=a("50c4"),i=a("7b0b"),u=a("65f0"),c=a("8418"),l=a("1dde"),d=Math.max,f=Math.min,p=9007199254740991,m="Maximum allowed length exceeded";r({target:"Array",proto:!0,forced:!l("splice")},{splice:function(e,t){var a,r,l,h,g,b,v=i(this),w=o(v.length),_=n(e,w),I=arguments.length;if(0===I?a=r=0:1===I?(a=0,r=w-_):(a=I-2,r=f(d(s(t),0),w-_)),w+a-r>p)throw TypeError(m);for(l=u(v,r),h=0;h<r;h++)g=_+h,g in v&&c(l,h,v[g]);if(l.length=r,a<r){for(h=_;h<w-r;h++)g=h+r,b=h+a,g in v?v[b]=v[g]:delete v[b];for(h=w;h>w-r+a;h--)delete v[h-1]}else if(a>r)for(h=w-r;h>_;h--)g=h+r-1,b=h+a-1,g in v?v[b]=v[g]:delete v[b];for(h=0;h<a;h++)v[h+_]=arguments[h+2];return v.length=w-r+a,l}})},cb4c:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"zh-CN":{"randomIDString":"bat-{随机ID}","Add Batch":"添加批处理","Setup Batch":"修改批处理","Customize ID":"定制ID","Func":"执行函数","Arguments":"参数指定","Tags":"标签","Add Tag":"添加标签","Note":"备注","URL Preview":"URL预览","ID will be a part of the calling URL":"此ID用于生成调用时的URL","JSON formated arguments (**kwargs)":"JSON格式的参数（**kwargs）","The Func accepts extra arguments not listed above":"本函数允许传递额外的自定义函数参数","ID must starts with \\"{prefix}\\"":"ID必须以\\"{prefix}\\"开头","Only numbers, alphabets, dot(.), underscore(_) and hyphen(-) are allowed":"只能输入数字、英文、点（.）、下划线（_）以及连字符（-）","Please select Func":"请选择执行函数","Please input arguments, input \\"{}\\" when no argument":"请输入参数，无参数时填写 \\"{}\\"","Batch created":"批处理已创建","Batch saved":"批处理已保存","Batch deleted":"批处理已删除","Are you sure you want to delete the Batch?":"是否确认删除此批处理？","Invalid argument format":"参数格式不正确","parameterHint":"参数值指定为\\"INPUT_BY_CALLER\\"时表示允许调用时指定本参数"}}'),delete e.options._Ctor}},ff59:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"fade"}},[e.$store.state.isLoaded?a("el-container",{attrs:{direction:"vertical"}},[a("el-header",{attrs:{height:"60px"}},[a("h1",[e._v(e._s(e.pageTitle)+" "),a("code",{staticClass:"text-main"},[e._v(e._s(e.data.func_title))])])]),e._v(" "),a("el-main",[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:15}},[a("div",{staticClass:"common-form"},[a("el-form",{ref:"form",attrs:{"label-width":"120px",model:e.form,rules:e.formRules}},["add"===e.T.pageMode()?a("el-form-item",{attrs:{label:e.$t("Customize ID"),prop:"useCustomId"}},[a("el-switch",{model:{value:e.useCustomId,callback:function(t){e.useCustomId=t},expression:"useCustomId"}}),e._v(" "),a("span",{staticClass:"text-main float-right"},[e._v("\n                  "+e._s(e.$t("URL Preview"))+e._s(e.$t(":"))+"\n                  "),a("code",[e._v(e._s("/api/v1/bat/"+(e.useCustomId?e.form.id:e.$t("randomIDString"))))])])],1):e._e(),e._v(" "),"add"===e.T.pageMode()?a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.useCustomId,expression:"useCustomId"}],attrs:{label:"ID",prop:"id"}},[a("el-input",{attrs:{maxlength:"50","show-word-limit":""},model:{value:e.form.id,callback:function(t){e.$set(e.form,"id",t)},expression:"form.id"}}),e._v(" "),a("InfoBlock",{attrs:{title:e.$t("ID will be a part of the calling URL")}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:e.$t("Func"),prop:"funcId"}},[a("el-cascader",{ref:"funcCascader",staticClass:"func-cascader-input",attrs:{placeholder:"--",filterable:"",options:e.funcCascader,props:{expandTrigger:"hover",emitPath:!1,multiple:!1}},on:{change:e.autoFillFuncCallKwargsJSON},model:{value:e.form.funcId,callback:function(t){e.$set(e.form,"funcId",t)},expression:"form.funcId"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("Arguments"),prop:"funcCallKwargsJSON"}},[a("el-input",{attrs:{type:"textarea",resize:"none",autosize:!0},model:{value:e.form.funcCallKwargsJSON,callback:function(t){e.$set(e.form,"funcCallKwargsJSON",t)},expression:"form.funcCallKwargsJSON"}}),e._v(" "),a("InfoBlock",{attrs:{title:e.$t("JSON formated arguments (**kwargs)")}}),e._v(" "),a("InfoBlock",{attrs:{title:e.$t("parameterHint")}}),e._v(" "),e.apiCustomKwargsSupport?a("InfoBlock",{attrs:{type:"success",title:e.$t("The Func accepts extra arguments not listed above")}}):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("Tags"),prop:"tagsJSON"}},[e._l(e.form.tagsJSON,(function(t){return a("el-tag",{key:t,attrs:{type:"warning",size:"mini",closable:""},on:{close:function(a){return e.removeTag(t)}}},[e._v(e._s(t))])})),e._v(" "),e.showAddTag?a("el-input",{ref:"newTag",attrs:{size:"mini"},on:{blur:e.addTag},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addTag(t)}},model:{value:e.newTag,callback:function(t){e.newTag=t},expression:"newTag"}}):a("el-button",{attrs:{type:"text"},on:{click:e.openAddTagInput}},[e._v(e._s(e.$t("Add Tag")))])],2),e._v(" "),a("el-form-item",{attrs:{label:e.$t("API Auth"),prop:"apiAuthId"}},[a("el-select",{model:{value:e.form.apiAuthId,callback:function(t){e.$set(e.form,"apiAuthId",t)},expression:"form.apiAuthId"}},e._l(e.apiAuthOptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("Note")}},[a("el-input",{attrs:{placeholder:e.$t("Optional"),type:"textarea",resize:"none",autosize:{minRows:2},maxlength:"200","show-word-limit":""},model:{value:e.form.note,callback:function(t){e.$set(e.form,"note",t)},expression:"form.note"}})],1),e._v(" "),a("el-form-item",["setup"===e.T.pageMode()?a("el-button",{on:{click:e.deleteData}},[e._v(e._s(e.$t("Delete")))]):e._e(),e._v(" "),a("div",{staticClass:"setup-right"},[a("el-button",{attrs:{type:"primary"},on:{click:e.submitData}},[e._v(e._s(e.$t("Save")))])],1)],1)],1)],1)]),e._v(" "),a("el-col",{staticClass:"hidden-md-and-down",attrs:{span:9}})],1)],1)],1):e._e()],1)},n=[],s=a("1da1"),o=(a("159b"),a("b64b"),a("d81d"),a("99af"),a("d3b7"),a("25f0"),a("a434"),a("b0c0"),a("ac1f"),a("466d"),a("96cf"),{name:"BatchSetup",components:{},watch:{$route:{immediate:!0,handler:function(e,t){var a=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.loadData();case 2:e.t0=a.T.pageMode(),e.next="add"===e.t0?5:"setup"===e.t0?8:9;break;case 5:return a.T.jsonClear(a.form),a.data={},e.abrupt("break",9);case 8:return e.abrupt("break",9);case 9:case"end":return e.stop()}}),e)})))()}},useCustomId:function(e){this.form.id=e?"".concat(this.ID_PREFIX,"foobar"):null}},methods:{loadData:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("setup"!==e.T.pageMode()){t.next=12;break}return t.next=3,e.T.callAPI_getOne("/api/v1/batches/do/list",e.$route.params.id);case 3:if(a=t.sent,a.ok){t.next=6;break}return t.abrupt("return");case 6:e.data=a.data,r={},Object.keys(e.form).forEach((function(t){return r[t]=e.data[t]})),r.funcCallKwargsJSON=JSON.stringify(r.funcCallKwargsJSON,null,2),r.tagsJSON=r.tagsJSON||[],e.form=r;case 12:return t.next=14,e.common.getFuncList();case 14:return n=t.sent,e.funcMap=n.map,e.funcCascader=n.cascader,t.next=19,e.common.getAPIAuthList();case 19:s=t.sent,e.apiAuthList=s,e.$store.commit("updateLoadStatus",!0);case 22:case"end":return t.stop()}}),t)})))()},submitData:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$refs.form.validate();case 3:t.next=8;break;case 5:return t.prev=5,t.t0=t["catch"](0),t.abrupt("return",console.error(t.t0));case 8:t.t1=e.T.pageMode(),t.next="add"===t.t1?11:"setup"===t.t1?14:17;break;case 11:return t.next=13,e.addData();case 13:return t.abrupt("return",t.sent);case 14:return t.next=16,e.modifyData();case 16:return t.abrupt("return",t.sent);case 17:case"end":return t.stop()}}),t,null,[[0,5]])})))()},addData:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a={body:{data:e.T.jsonCopy(e.form)},alert:{okMessage:e.$t("Batch created")}},t.prev=1,a.body.data.funcCallKwargsJSON=JSON.parse(e.form.funcCallKwargsJSON),t.next=8;break;case 5:return t.prev=5,t.t0=t["catch"](1),t.abrupt("return",e.T.alert("".concat(e.$t("Invalid argument format"),"<br>").concat(t.t0.toString())));case 8:return t.next=10,e.T.callAPI("post","/api/v1/batches/do/add",a);case 10:if(r=t.sent,r.ok){t.next=13;break}return t.abrupt("return");case 13:e.$store.commit("updateBatchList_scrollY",null),e.$store.commit("updateHighlightedTableDataId",r.data.id),e.$router.push({name:"batch-list",query:e.T.getPrevQuery()});case 16:case"end":return t.stop()}}),t,null,[[1,5]])})))()},modifyData:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=e.T.jsonCopy(e.form),delete a.id,r={params:{id:e.$route.params.id},body:{data:a},alert:{okMessage:e.$t("Batch saved")}},t.prev=3,r.body.data.funcCallKwargsJSON=JSON.parse(e.form.funcCallKwargsJSON),t.next=10;break;case 7:return t.prev=7,t.t0=t["catch"](3),t.abrupt("return",e.T.alert("".concat(e.$t("Invalid argument format"),"<br>").concat(t.t0.toString())));case 10:return t.next=12,e.T.callAPI("post","/api/v1/batches/:id/do/modify",r);case 12:if(n=t.sent,n.ok){t.next=15;break}return t.abrupt("return");case 15:e.$store.commit("updateHighlightedTableDataId",n.data.id),e.$router.push({name:"batch-list",query:e.T.getPrevQuery()});case 17:case"end":return t.stop()}}),t,null,[[3,7]])})))()},deleteData:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.T.confirm("Are you sure you want to delete the Batch?");case 2:if(t.sent){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e.T.callAPI("/api/v1/batches/:id/do/delete",{params:{id:e.$route.params.id},alert:{okMessage:e.$t("Batch deleted")}});case 6:if(a=t.sent,a.ok){t.next=9;break}return t.abrupt("return");case 9:e.$router.push({name:"batch-list",query:e.T.getPrevQuery()});case 10:case"end":return t.stop()}}),t)})))()},autoFillFuncCallKwargsJSON:function(e){var t=this.funcMap[e].argsJSON||Object.keys(this.funcMap[e].kwargsJSON),a={};t.forEach((function(e){0===e.indexOf("**")||(a[e]="INPUT_BY_CALLER")})),this.form.funcCallKwargsJSON=JSON.stringify(a,null,2)},removeTag:function(e){this.form.tagsJSON.splice(this.form.tagsJSON.indexOf(e),1)},openAddTagInput:function(){var e=this;this.showAddTag=!0,this.$nextTick((function(t){e.$refs.newTag.$refs.input.focus()}))},addTag:function(){var e=this.newTag;e&&(Array.isArray(this.form.tagsJSON)||this.$set(this.form,"tagsJSON",[]),this.form.tagsJSON.push(e)),this.showAddTag=!1,this.newTag=""}},computed:{ID_PREFIX:function(){return"bat-"},pageTitle:function(){var e={setup:this.$t("Setup Batch"),add:this.$t("Add Batch")};return e[this.T.pageMode()]},apiCustomKwargsSupport:function(){var e=this.form.funcId;if(!e)return!1;for(var t in this.funcMap[e].kwargsJSON)if(0===t.indexOf("**"))return!0;return!1},apiAuthOptions:function(){var e=this;return this.apiAuthList.map((function(t){var a=e.C.API_AUTH_MAP.get(t.type).name;return t.label="[".concat(a,"] ").concat(t.name||""),t}))},datetimePickerOptions:function(){var e=(new Date).getTime(),t=[1,3,7,30,90,365],a=[];return t.forEach((function(t){var r=new Date;r.setTime(e+86400*t*1e3),a.push({text:"".concat(t,"天"),onClick:function(e){e.$emit("pick",r)}})})),{shortcuts:a}}},props:{},data:function(){var e=this;return{data:{},funcMap:{},funcCascader:[],apiAuthList:[],useCustomId:!1,showAddTag:!1,newTag:"",form:{id:null,funcId:null,funcCallKwargsJSON:null,tagsJSON:[],apiAuthId:null,note:null},formRules:{id:[{trigger:"change",validator:function(t,a,r){if(!e.T.isNothing(a)){if(0!==a.indexOf(e.ID_PREFIX)||a===e.ID_PREFIX)return r(new Error('ID必须以"'.concat(e.ID_PREFIX,'"开头')));if(!a.match(/^[0-9a-zA-Z\.\-\_]+$/g))return r(new Error(e.$t("Only numbers, alphabets, dot(.), underscore(_) and hyphen(-) are allowed")))}return r()}}],funcId:[{trigger:"change",message:"请选择执行函数",required:!0}],funcCallKwargsJSON:[{trigger:"change",message:"请输入调用参数，无参数的直接填写 {}",required:!0},{trigger:"change",message:"调用参数需要以 JSON 形式填写",validator:function(e,t,a){try{var r=JSON.parse(t);return Array.isArray(r)?a(new Error('调用参数需要以 JSON 形式填写，如 {"arg1": "value1"}')):a()}catch(n){return a(new Error("调用参数需要以 JSON 形式填写，无参数的直接填写 {}"))}}}]}}}}),i=o,u=(a("59c5"),a("2877")),c=a("6a77"),l=a("2706"),d=Object(u["a"])(i,r,n,!1,null,"2e075f59",null);"function"===typeof c["default"]&&Object(c["default"])(d),"function"===typeof l["default"]&&Object(l["default"])(d);t["default"]=d.exports}}]);