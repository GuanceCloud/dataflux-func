(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-45ba9e0c"],{4168:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition",{attrs:{name:"fade"}},[t.$store.state.isLoaded?a("el-container",{attrs:{direction:"vertical"}},[a("el-header",{attrs:{height:"60px"}},[a("h1",[t._v("\n        "+t._s(t.modeName)+"脚本包\n        "),a("div",{staticClass:"header-control"},[a("el-button",{attrs:{size:"small"},on:{click:t.goToHistory}},[a("i",{staticClass:"fa fa-fw fa-history"}),t._v("\n            脚本包导入历史\n          ")])],1)])]),t._v(" "),a("el-main",[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:15}},[a("div",{staticClass:"common-form"},[a("el-form",{ref:"form",attrs:{"label-width":"120px",model:t.form,rules:t.formRules}},[a("el-form-item",{attrs:{label:"导入脚本包",prop:"upload"}},[a("el-upload",{ref:"upload",class:t.uploadAreaBorderClass,attrs:{drag:"",limit:2,multiple:!1,"auto-upload":!1,"show-file-list":!1,"http-request":t.handleUpload,"on-change":t.onUploadFileChange,accept:t.$store.getters.CONFIG("_FUNC_PKG_EXPORT_EXT"),action:""}},[a("i",{staticClass:"fa",class:t.uploadAreaIconClass}),t._v(" "),a("div",{staticClass:"el-upload__text"},[a("span",{domProps:{innerHTML:t._s(t.uploadAreaIconText)}})])])],1),t._v(" "),a("el-form-item",{attrs:{label:"导入令牌",prop:"password"}},[a("el-input",{attrs:{resize:"none",maxlength:"64","show-word-limit":""},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}}),t._v(" "),a("InfoBlock",{attrs:{title:"填写导出时提示的密码，无密码则留空即可"}})],1),t._v(" "),a("el-form-item",[a("div",{staticClass:"setup-right"},[a("el-button",{attrs:{type:"primary",disabled:t.disableUpload},on:{click:t.submitData}},[t._v(t._s(t.modeName))])],1)])],1)],1)]),t._v(" "),a("el-col",{staticClass:"hidden-md-and-down",attrs:{span:9}})],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"即将导入脚本包",visible:t.showConfirm,"close-on-click-modal":!0,"close-on-press-escape":!0,"show-close":!0,width:"750px"},on:{"update:visible":function(e){t.showConfirm=e}}},[a("span",{staticClass:"import-token-dialog-content"},[t.checkResult&&t.checkResult.diff?[t.T.isNothing(t.checkResult.diff.add)?t._e():[a("span",{staticClass:"text-good"},[t._v("新增脚本集：")]),t._v(" "),t._l(t.checkResult.diff.add,(function(e){return a("el-tag",{key:e.id,attrs:{size:"medium",type:"success"}},[t._v(t._s(e.title||e.id))])})),t._v(" "),a("hr",{staticClass:"br"})],t._v(" "),t.T.isNothing(t.checkResult.diff.replace)?t._e():[a("span",{staticClass:"text-watch"},[t._v("替换脚本集：")]),t._v(" "),t._l(t.checkResult.diff.replace,(function(e){return a("el-tag",{key:e.id,attrs:{size:"medium",type:"warning"}},[t._v(t._s(e.title||e.id))])})),t._v(" "),a("InfoBlock",{attrs:{type:"warning",title:"被替换的脚本集下所有脚本文件会被完整替换为新版本，新版本中不存在的脚本文件会被删除"}}),t._v(" "),a("hr",{staticClass:"br"})]]:t._e(),t._v(" "),t.checkResult&&t.checkResult.summary&&t.checkResult.summary.note?[a("span",{staticClass:"text-info"},[t._v("备注：")]),t._v(" "),a("pre",{staticClass:"import-note"},[t._v(t._s(t.checkResult.summary.note))]),t._v(" "),a("hr",{staticClass:"br"})]:t._e()],2),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.showConfirm=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",loading:t.isImporting},on:{click:t.confirmImport}},[t._v("\n          确认导入\n        ")])],1)])],1):t._e()],1)},o=[],s=a("a6db"),n=(a("bd06"),a("8d65"),a("74f5"),a("e5ac"),a("672e"),{name:"ScriptSetImport",components:{},watch:{},methods:{submitData:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$refs.form.validate();case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e["catch"](0),e.abrupt("return",console.error(e.t0));case 8:e.t1=t.T.pageMode(),e.next="import"===e.t1?11:14;break;case 11:return e.next=13,t.$refs.upload.submit();case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e,null,[[0,5]])})))()},handleUpload:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,o,s,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:for(s in r=new FormData,o=e.T.jsonCopy(e.form),o)o.hasOwnProperty(s)&&(n=o[s],r.append(s,n));return r.append("checkOnly",!0),r.append("files",t.file),a.next=7,e.T.callAPI("post","/api/v1/script-sets/do/import",{body:r,alert:{muteError:!0}});case 7:if(i=a.sent,i.ok){a.next=10;break}return a.abrupt("return",e.alertOnError(i));case 10:e.showConfirm=!0,e.checkResult=i.data;case 12:case"end":return a.stop()}}),a)})))()},confirmImport:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.isImporting=!0,e.next=3,t.T.callAPI("post","/api/v1/script-sets/do/confirm-import",{body:{confirmId:t.checkResult.confirmId},alert:{okMessage:t.$t("Data imported")}});case 3:if(a=e.sent,t.isImporting=!1,a.ok){e.next=7;break}return e.abrupt("return",t.alertOnError(a));case 7:if(!t.T.isNothing(a.data.pkgs)){e.next=11;break}t.goToHistory(),e.next=20;break;case 11:return t.showConfirm=!1,e.next=14,t.T.confirm(t.$t("Imported Script Set requires 3rd party packages, do you want to open PIP tool now?"));case 14:if(e.sent){e.next=18;break}t.goToHistory(),e.next=20;break;case 18:r=a.data.pkgs.join(" "),t.$router.push({name:"pip-tool",query:{pkgs:t.T.getBase64(r)}});case 20:case"end":return e.stop()}}),e)})))()},alertOnError:function(t){var e=this;if(!t.ok){switch(t.reason){case"EBizCondition.InvalidPassword":this.T.alert("导入令牌错误<br>\n              请使用复制粘贴的方式填写导入令牌，避免错填容易混淆的字母数字");break;case"EBizCondition.ConfirmingImportTimeout":this.T.alert("脚本包导入确认超时<br>\n              脚本包导入后长时间未确认，请重新尝试导入");break;default:this.T.alert("脚本包导入时发生意外错误<br>\n              请尝试重新导入，如果问题一直出现，请联系脚本包发行方");break}this.form.password="",this.initFilePreview(),setImmediate((function(){e.$refs.form.clearValidate()}))}},initFilePreview:function(){this.$refs.upload.clearFiles(),this.uploadAreaBorderClass=[],this.uploadAreaIconClass=["fa-cloud-upload"],this.uploadAreaIconText="将文件拖到此处，或<em>点击上传</em>"},showFilePreview:function(t){this.uploadAreaBorderClass=["upload-area-active"],this.uploadAreaIconClass=["fa-cloud-upload","text-main"],this.uploadAreaIconText='<code class="text-main">'.concat(t,"</code>")},onUploadFileChange:function(t,e){e.length>1&&e.splice(0,1),this.disableUpload=e.length<=0,this.disableUpload?this.initFilePreview():this.showFilePreview(e[0].name)},goToHistory:function(){this.$router.push({name:"script-set-import-history-list"})}},computed:{modeName:function(){var t={import:"导入"};return t[this.T.pageMode()]}},props:{},data:function(){return{scriptSetMap:{},uploadAreaBorderClass:[],uploadAreaIconClass:["fa-cloud-upload"],uploadAreaIconText:"将文件拖到此处，或<em>点击上传</em>",disableUpload:!0,showConfirm:!1,isImporting:!1,checkResult:{},form:{password:""},formRules:{}}},created:function(){this.$store.commit("updateLoadStatus",!0)}}),i=n,c=(a("df7e"),a("a347"),a("0620")),l=a("fcf7"),u=Object(c["a"])(i,r,o,!1,null,"9cfac86a",null);"function"===typeof l["default"]&&Object(l["default"])(u);e["default"]=u.exports},"4a78":function(t,e,a){},"74f5":function(t,e,a){t.exports=a("7ab4")(1131)},a347:function(t,e,a){"use strict";a("4a78")},a78a:function(t,e){t.exports=function(t){t.options.__i18n=t.options.__i18n||[],t.options.__i18n.push('{"zh-CN":{"Data imported":"数据已导入","Imported Script Set requires 3rd party packages, do you want to open PIP tool now?":"导入的脚本集需要第三方包，是否现在前往PIP工具？"}}'),delete t.options._Ctor}},df7e:function(t,e,a){"use strict";a("e9ce")},e9ce:function(t,e,a){},fcf7:function(t,e,a){"use strict";var r=a("a78a"),o=a.n(r);e["default"]=o.a}}]);