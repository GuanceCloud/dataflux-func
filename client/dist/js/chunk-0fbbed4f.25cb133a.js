(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0fbbed4f"],{"014e":function(e,t,n){"use strict";var i=n("5cce4"),r=n.n(i);t["default"]=r.a},"06c5":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n("fb6a"),n("d3b7"),n("b0c0"),n("a630"),n("3ca3"),n("ac1f"),n("00b4");var i=n("6b75");function r(e,t){if(e){if("string"===typeof e)return Object(i["a"])(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Object(i["a"])(e,t):void 0}}},"0797":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"zh-CN":{"Download as text file":"作为文本文件下载"}}'),delete e.options._Ctor}},"20b6":function(e,t,n){"use strict";var i=n("48f0"),r=n.n(i);t["default"]=r.a},"21a6":function(e,t,n){(function(n){var i,r,o;(function(n,a){r=[],i=a,o="function"===typeof i?i.apply(t,r):i,void 0===o||(e.exports=o)})(0,(function(){"use strict";function t(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function i(e,t,n){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){s(i.response,t,n)},i.onerror=function(){console.error("could not download file")},i.send()}function r(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function o(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(i){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n&&n.global===n?n:void 0,s=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype?function(e,t,n){var s=a.URL||a.webkitURL,c=document.createElement("a");t=t||e.name||"download",c.download=t,c.rel="noopener","string"==typeof e?(c.href=e,c.origin===location.origin?o(c):r(c.href)?i(e,t,n):o(c,c.target="_blank")):(c.href=s.createObjectURL(e),setTimeout((function(){s.revokeObjectURL(c.href)}),4e4),setTimeout((function(){o(c)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,n,a){if(n=n||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,a),n);else if(r(e))i(e,n,a);else{var s=document.createElement("a");s.href=e,s.target="_blank",setTimeout((function(){o(s)}))}}:function(e,t,n,r){if(r=r||open("","_blank"),r&&(r.document.title=r.document.body.innerText="downloading..."),"string"==typeof e)return i(e,t,n);var o="application/octet-stream"===e.type,s=/constructor/i.test(a.HTMLElement)||a.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||o&&s)&&"object"==typeof FileReader){var l=new FileReader;l.onloadend=function(){var e=l.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=e:location=e,r=null},l.readAsDataURL(e)}else{var u=a.URL||a.webkitURL,d=u.createObjectURL(e);r?r.location=d:location.href=d,r=null,setTimeout((function(){u.revokeObjectURL(d)}),4e4)}});a.saveAs=s.saveAs=s,e.exports=s}))}).call(this,n("c8ba"))},2909:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n("6b75");function r(e){if(Array.isArray(e))return Object(i["a"])(e)}n("a4d3"),n("e01a"),n("d3b7"),n("d28b"),n("3ca3"),n("ddb0"),n("a630");function o(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var a=n("06c5");function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e){return r(e)||o(e)||Object(a["a"])(e)||s()}},"2d9c":function(e,t,n){},"48f0":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"addedLines":"Added {n} line | Added {n} lines","removedLines":", Removed {n} Line | , Removed {n} Lines","codeLines":"{n} line | {n} lines","codeLinesPrev":"previously {n} line | previously {n} lines","codeLinesCurr":", currently {n} line| , currently {n} lines","seconds":"{n} second | {n} seconds"}}'),delete e.options._Ctor}},"4df4":function(e,t,n){"use strict";var i=n("da84"),r=n("0366"),o=n("c65b"),a=n("7b0b"),s=n("9bdd"),c=n("e95a"),l=n("68ee"),u=n("07fa"),d=n("8418"),p=n("9a1f"),f=n("35a1"),h=i.Array;e.exports=function(e){var t=a(e),n=l(this),i=arguments.length,m=i>1?arguments[1]:void 0,g=void 0!==m;g&&(m=r(m,i>2?arguments[2]:void 0));var b,v,w,y,_,S,C=f(t),k=0;if(!C||this==h&&c(C))for(b=u(t),v=n?new this(b):h(b);b>k;k++)S=g?m(t[k],k):t[k],d(v,k,S);else for(y=p(t,C),_=y.next,v=n?new this:[];!(w=o(_,y)).done;k++)S=g?s(y,m,[w.value,k],!0):w.value,d(v,k,S);return v.length=k,v}},"5cce4":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"zh-CN":{"Script Setup":"脚本设置","Script is under editing mode in other browser tab, please wait...":"其他标签页或窗口正在编辑此脚本，请稍后...","Script is under editing mode in other client, please wait...":"其他客户端正在编辑此脚本，请稍后...","All top Func without a underscore prefix are avaliable":"可以指定任意顶层非下划线开头的函数","Select Func":"选择执行函数","Viewport are too narrow":"当前可视宽度太窄","Writing test cases to test your Func is recommended":"建议编写测试用例来测试您的函数","Args":"参数","Arguments should be inputed like {\\"arg\\": value}":"参数以 {\\"参数名\\": 参数值} 方式填写","Leave blank or {} when no argument":"没有参数的不用填写，或保留 {}","Arguments (JSON)":"参数（JSON格式）","Run selected Func":"执行指定的函数","Shortcut":"快捷键","Run":"执行","Save Script draft":"保存草稿","Show code diff":"查看差异","DIFF":"差异","Save and publish Script":"保存并发布","Publish":"发布","Recover code to latest published version":"恢复代码为上次发布的版本","End edit":"结束编辑","Setup Code Editor":"调整编辑器显示样式","This is a builtin Script, code will be reset when the system restarts":"这是一个内置脚本，代码会在系统重启后复位","This Script has been locked by other, editing is disabled":"当前脚本被其他用户锁定，无法修改","addedLines":"新增 {n} 行","removedLines":"，删除 {n} 行","codeLines":"共 {n} 行代码","codeLinesPrev":"修改前共 {n} 行代码","codeLinesCurr":"，修改后共 {n} 行代码","Script is modified but NOT published yet":"脚本已修改但尚未发布","Script is published":"脚本已发布","Diff between published and previously published":"发布前后差异","Clear highlighted":"清除高亮","Clear output":"清除输出","Output":"脚本输出","Func exection result or log message will be shown here":"函数执行结果与日志信息将显示在此处","Operating too frequently or Script is modified in other tab":"操作过于频繁，或脚本已经在其他窗口被修改。","Do you want to download current editing Script?":"是否下载当前正在编辑的脚本？","Saving Script failed":"保存脚本失败","Current editing Script has been downloaded":"当前正在编辑的脚本已经下载","Script saved successfully":"脚本保存成功","You can continue with other operations":"你可以继续进行其他操作","Published Code":"已发布的代码","Saved Draft Code":"已保存的草稿代码","Script will take effect after been published immediately,":"发布后新的脚本将立即生效，","Funcs with {html} decorator will be available to be accessed":"被{html}装饰的函数可被访问","Are you sure you want to publish the Script?":"是否确认发布此脚本？","Publish Script":"发布脚本","Script saved":"脚本已保存","Script published, new Script is in effect immediately":"脚本已发布，新脚本立即生效","Reset draft to the last published version, changes not published will lost":"复位脚本草稿到上次发布时的状态，未发布的草稿将丢失","Are you sure you want to reset the Script?":"是否确认复位此脚本？","Script has been reset to previous version":"脚本已经复位到上一个版本","Reset Script":"复位脚本","The parameter is not a valid JSON":"调用参数不是有效的JSON格式","Invalid argument format":"参数格式不正确","Check input":"输入检查","seconds":"{n}秒","Executed Func":"执行函数","This Script is not published, it will take effect after the Script is published":"当前脚本尚未发布，脚本只有发布后才会生效","Do you want to publish the Script now?":"是否现在发布？","Script not published":"脚本未发布","Publish Now":"立即发布","Skip Publishing":"跳过发布","Run Time":"耗时","It took too much time for running, may not be suitable for synchronous calling scenario":"耗时较长，可能不适合需要响应速度较高的场景","Func Return Value":"函数返回值","Stack":"错误堆栈","Publish Failed":"发布失败","Script Error":"脚本错误","Waiting Timeout":"等待超时","Duplicated Func names":"函数名重复","Script publishing failed. Please check your code":"脚本发布失败，请检查代码是否存在错误","Script executing failed. Please check your code":"脚本执行失败，请检查代码是否存在错误","Script publishing failed. Script executing module may crashed, please contact the administrator to report this issue":"脚本发布时发生故障，后端脚本执行模块可能存在问题，请联系管理员排查问题","Script executing failed. Script executing module may crashed, please contact the administrator to report this issue":"脚本执行时发生故障，后端脚本执行模块可能存在问题，请联系管理员排查问题","Detail information is shown in the output box bellow":"详细信息可在下方输出窗口中查看","Script publishing timeout, please make sure that no time-consuming code in global scope":"脚本发布预检查超时，请注意不要再全局范围内编写耗时代码","If this issue persists, please contact the administrator to report this issue":"如果问题持续出现，请联系管理员排查问题","Waiting Func response timeout":"等待函数响应超时","There is a {seconds} time limit when calling Funcs in Code Editor":"在编辑器中运行函数时，最多允许执行{seconds}，超时会自动中断执行","It is not recommended for synchronous calling Funcs that response slowly":"正式使用时应注意响应过慢的函数不适合同步方式调用","Can not parse return value":"函数返回值无法解析","Func returned a value that can not been parsed as JSON. Please check your code":"函数返回了无法使用 JSON 表示的数据，请检查代码","In general, common used types are safe (e.g. list, dict, int, float, str, bool, None).":"一般来说，Python 常用基本类型都能正常解析，如 list、dict、int、float、str、bool、None 等。","Some math lib may return complicated values, like numpy.NaN. These values should be converted to common used types before returning":"但一些数学库可能返回复杂的数字对象，如 numpy.NaN。这些数字对象需要在函数返回前处理成 Python 的基本类型","Duplicated names of Funcs decorated by @DFF.API(...)":"被@DFF.API(...)装饰的函数存在重名","Please check the code and try again":"请检查代码，修改后再试一次","Publishing Script, it will be finished in a few seconds. If the page is not responding for a long time, please try refreshing.":"脚本发布中，正常几秒就能完成。如长时间无响应请尝试刷新页面","Func is running. If it is not responding for a long time, please try refreshing.":"函数执行中，长时间无响应后再尝试刷新页面","Func is running. It will wait at most {seconds} for the result. If it is not responding for a long time, please try refreshing.":"函数执行中，执行最多等待 {seconds}，长时间无响应后再尝试刷新页面","Do NOT use monkey patch":"请勿使用猴子补丁","For performance reasons, the script does not run in a sandbox or isolated environment.":"出于性能考虑，脚本并非运行在沙盒或隔离环境中。","Using monkey patches may cause problems to the entire system.":"使用猴子补丁可能导致系统整体出现问题。","Therefore, please avoid using monkey patches in scripts.":"因此，请避免在脚本中使用猴子补丁。"}}'),delete e.options._Ctor}},"6b75":function(e,t,n){"use strict";function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}n.d(t,"a",(function(){return i}))},"7b0b4":function(e,t,n){"use strict";var i=n("0797"),r=n.n(i);t["default"]=r.a},"82a6":function(e,t,n){},"86d1":function(e,t,n){"use strict";n("2d9c")},"99cd":function(e,t,n){e.exports=n.p+"img/monkey-patch-notice.f5a68380.png"},"9bdd":function(e,t,n){var i=n("825a"),r=n("2a62");e.exports=function(e,t,n,o){try{return o?t(i(n)[0],n[1]):t(n)}catch(a){r(e,"throw",a)}}},a1f0:function(e,t,n){"use strict";var i=n("23e7"),r=n("da84"),o=n("c65b"),a=n("e330"),s=n("9ed3"),c=n("1d80"),l=n("50c4"),u=n("577e"),d=n("825a"),p=n("c6b6"),f=n("3a9b"),h=n("44e7"),m=n("ad6d"),g=n("dc4a"),b=n("6eeb"),v=n("d039"),w=n("b622"),y=n("4840"),_=n("8aa5"),S=n("14c3"),C=n("69f3"),k=n("c430"),x=w("matchAll"),T="RegExp String",L=T+" Iterator",I=C.set,$=C.getterFor(L),M=RegExp.prototype,P=r.TypeError,E=a(m),D=a("".indexOf),O=a("".matchAll),F=!!O&&!v((function(){O("a",/./)})),N=s((function(e,t,n,i){I(this,{type:L,regexp:e,string:t,global:n,unicode:i,done:!1})}),T,(function(){var e=$(this);if(e.done)return{value:void 0,done:!0};var t=e.regexp,n=e.string,i=S(t,n);return null===i?{value:void 0,done:e.done=!0}:e.global?(""===u(i[0])&&(t.lastIndex=_(n,l(t.lastIndex),e.unicode)),{value:i,done:!1}):(e.done=!0,{value:i,done:!1})})),R=function(e){var t,n,i,r,o,a,s=d(this),c=u(e);return t=y(s,RegExp),n=s.flags,void 0===n&&f(M,s)&&!("flags"in M)&&(n=E(s)),i=void 0===n?"":u(n),r=new t(t===RegExp?s.source:s,i),o=!!~D(i,"g"),a=!!~D(i,"u"),r.lastIndex=l(s.lastIndex),new N(r,c,o,a)};i({target:"String",proto:!0,forced:F},{matchAll:function(e){var t,n,i,r,a=c(this);if(null!=e){if(h(e)&&(t=u(c("flags"in M?e.flags:E(e))),!~D(t,"g")))throw P("`.matchAll` does not allow non-global regexes");if(F)return O(a,e);if(i=g(e,x),void 0===i&&k&&"RegExp"==p(e)&&(i=R),i)return o(i,e,a)}else if(F)return O(a,e);return n=u(a),r=new RegExp(e,"g"),k?o(R,r,n):r[x](n)}}),k||x in M||b(M,x,R)},a630:function(e,t,n){var i=n("23e7"),r=n("4df4"),o=n("1c7e"),a=!o((function(e){Array.from(e)}));i({target:"Array",stat:!0,forced:a},{from:r})},a7e8:function(e,t,n){"use strict";n("b217")},b217:function(e,t,n){},b76c:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{id:"LongTextDialog",visible:e.show,width:"70%"},on:{"update:visible":function(t){e.show=t}}},[n("template",{slot:"title"},[e.showDownload&&e.fileName&&e.content?n("el-link",{attrs:{type:"primary"},on:{click:e.download}},[e._v("\n      "+e._s(e.$t("Download as text file"))+"\n      "),n("i",{staticClass:"fa fa-fw fa-download"})]):e._e()],1),e._v(" "),n("div",[n("p",[e._v(e._s(e.title))]),e._v(" "),n("textarea",{attrs:{id:"longTextDialogContent"}})])],2)},r=[],o=(n("130f"),n("21a6")),a=n.n(o),s={name:"LongTextDialog",components:{},watch:{},methods:{update:function(e,t){var n=this;this.codeMirror&&this.codeMirror.setValue(""),this.content=e,this.fileName=(t||"dump")+".txt",this.show=!0,setImmediate((function(){n.codeMirror||(n.codeMirror=n.T.initCodeMirror("longTextDialogContent",n.mode||"text"),n.codeMirror.setOption("theme",n.T.getCodeMirrorThemeName()),n.T.setCodeMirrorReadOnly(n.codeMirror,!0)),n.codeMirror.setValue(n.content||""),n.codeMirror.refresh()}))},download:function(){var e=new Blob([this.content],{type:"text/plain"}),t=this.fileName;a.a.saveAs(e,t)}},computed:{},props:{title:String,mode:Boolean,showDownload:Boolean},data:function(){return{show:!1,fileName:null,content:null,codeMirror:null}},beforeDestroy:function(){this.T.destoryCodeMirror(this.codeMirror)}},c=s,l=(n("a7e8"),n("2877")),u=n("7b0b4"),d=Object(l["a"])(c,i,r,!1,null,"ece94f2e",null);"function"===typeof u["default"]&&Object(u["default"])(d);t["a"]=d.exports},c64d:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("transition",{attrs:{name:"fade"}},[n("split-pane",{directives:[{name:"show",rawName:"v-show",value:e.$store.state.isLoaded,expression:"$store.state.isLoaded"}],ref:"vueSplitPane",attrs:{"min-percent":0,"default-percent":100,split:"horizontal"},on:{resize:e.resizeVueSplitPane}},[n("template",{slot:"paneL"},[n("el-container",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullScreenLoading,expression:"fullScreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{"element-loading-spinner":"el-icon-loading","element-loading-text":e.workerRunningTipTitle}},[n("el-header",{staticClass:"code-editor",staticStyle:{height:"unset !important"}},[n("div",{staticClass:"code-editor-action-left"},[n("code",{staticClass:"code-editor-action-title"},[n("i",{staticClass:"fa fa-file-code-o"}),e._v("\n              "+e._s(e.data.id)+"\n              "),n("el-tooltip",{attrs:{content:e.$t("Script Setup"),placement:"bottom",enterable:!1}},[n("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.$router.push({name:"script-setup",params:{id:e.data.id}})}}},[e.isLockedByOther?n("i",{staticClass:"fa fa-fw fa-search"}):n("i",{staticClass:"fa fa-fw fa-wrench"})])],1)],1)]),e._v(" "),n("div",{staticClass:"code-editor-action-breaker hidden-lg-and-up"}),e._v(" "),n("div",{staticClass:"code-editor-action-right"},[n("el-form",{attrs:{inline:!0}},[n("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.conflictStatus,expression:"conflictStatus"}]},["otherTab"===e.conflictStatus?n("span",{staticClass:"text-bad"},[e._v(e._s(e.$t("Script is under editing mode in other browser tab, please wait...")))]):"otherClient"===e.conflictStatus?n("span",{staticClass:"text-bad"},[e._v(e._s(e.$t("Script is under editing mode in other client, please wait...")))]):e._e()]),e._v(" "),n("el-form-item",[n("el-tooltip",{attrs:{content:e.$t("All top Func without a underscore prefix are avaliable"),placement:"left",enterable:!1}},[n("el-select",{staticStyle:{width:"150px"},attrs:{size:"mini",filterable:"",placeholder:e.$t("Select Func")},model:{value:e.selectedFuncId,callback:function(t){e.selectedFuncId=t},expression:"selectedFuncId"}},e._l(e.draftFuncs,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),e._v(" "),e.conflictStatus?e._e():[n("el-form-item",{staticClass:"hidden-lg-and-up"},[n("el-tooltip",{attrs:{placement:"bottom",enterable:!1}},[n("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                      "+e._s(e.$t("Viewport are too narrow"))),n("br"),e._v("\n                      "+e._s(e.$t("Writing test cases to test your Func is recommended"))+"\n                    ")]),e._v(" "),n("el-tag",{staticStyle:{height:"29px"},attrs:{type:"info",size:"medium"}},[e._v(e._s(e.$t("Args")))])],1)],1),e._v(" "),n("el-form-item",{staticClass:"hidden-md-and-down"},[n("el-tooltip",{attrs:{placement:"bottom",enterable:!1}},[n("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                      "+e._s(e.$t("Writing test cases to test your Func is recommended"))),n("br"),e._v("\n                      "+e._s(e.$t('Arguments should be inputed like {"arg": value}'))),n("br"),e._v("\n                      "+e._s(e.$t("Leave blank or {} when no argument"))+"\n                    ")]),e._v(" "),n("el-input",{staticClass:"code-editor-call-func-kwargs-json",staticStyle:{width:"150px"},attrs:{size:"mini",placeholder:e.$t("Arguments (JSON)")},model:{value:e.funcCallKwargsJSON,callback:function(t){e.funcCallKwargsJSON=t},expression:"funcCallKwargsJSON"}})],1)],1),e._v(" "),n("el-form-item",[n("el-tooltip",{attrs:{placement:"bottom",enterable:!1}},[n("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                      "+e._s(e.$t("Run selected Func"))),n("br"),e._v("\n                      "+e._s(e.$t("Shortcut"))+e._s(e.$t(":"))+" "),n("code",[e._v(e._s(e.T.getSuperKeyName())+" + B")])]),e._v(" "),n("el-button",{attrs:{type:"primary",plain:"",size:"mini",disabled:!e.selectedFuncId&&!e.workerRunning},on:{click:e.callFuncDraft}},[n("i",{staticClass:"fa fa-fw fa-play"}),e._v(" "+e._s(e.$t("Run"))+"\n                    ")])],1)],1),e._v(" "),e.isLockedByOther?e._e():n("el-form-item",[n("el-button-group",[n("el-tooltip",{attrs:{placement:"bottom",enterable:!1}},[n("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                        "+e._s(e.$t("Save Script draft"))),n("br"),e._v("\n                        "+e._s(e.$t("Shortcut"))+e._s(e.$t(":"))+" "),n("code",[e._v(e._s(e.T.getSuperKeyName())+" + S")])]),e._v(" "),n("el-button",{attrs:{disalbed:!e.workerRunning,plain:"",size:"mini"},on:{click:function(t){return e.saveScript()}}},[n("i",{staticClass:"fa fa-fw fa-save"}),e._v(" "),n("span",{staticClass:"hidden-lg-and-down"},[e._v(e._s(e.$t("Save")))])])],1),e._v(" "),n("el-tooltip",{attrs:{placement:"bottom",enterable:!1}},[n("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                        "+e._s(e.$t("Show code diff"))+"\n                      ")]),e._v(" "),n("el-button",{attrs:{disalbed:!e.workerRunning,plain:"",size:"mini"},on:{click:function(t){return e.showDiff()}}},[n("i",{staticClass:"fa fa-fw fa-code"}),e._v(" "),n("span",{staticClass:"hidden-lg-and-down"},[e._v(e._s(e.$t("DIFF")))])])],1),e._v(" "),n("el-tooltip",{attrs:{placement:"bottom",enterable:!1}},[n("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                        "+e._s(e.$t("Save and publish Script"))),n("br")]),e._v(" "),n("el-button",{attrs:{disalbed:!e.workerRunning,plain:"",size:"mini"},on:{click:e.publishScript}},[n("i",{staticClass:"fa fa-fw fa-coffee"}),e._v(" "+e._s(e.$t("Publish"))+"\n                      ")])],1)],1)],1)],e._v(" "),n("el-form-item",[n("el-button-group",[e.conflictStatus||e.isLockedByOther?e._e():[n("el-tooltip",{attrs:{content:e.$t("Recover code to latest published version"),placement:"bottom",enterable:!1}},[n("el-button",{attrs:{disalbed:!e.workerRunning,plain:"",size:"mini"},on:{click:e.resetScript}},[n("i",{staticClass:"fa fa-fw fa-history"})])],1)],e._v(" "),n("el-tooltip",{attrs:{content:e.$t("End edit"),placement:"bottom",enterable:!1}},[n("el-button",{attrs:{disalbed:!e.workerRunning,plain:"",size:"mini"},on:{click:e.endEdit}},[n("i",{staticClass:"fa fa-fw fa-sign-out"})])],1)],2)],1)],2)],1),e._v(" "),e.scriptSet.isBuiltin?n("InfoBlock",{attrs:{type:"warning",title:e.$t("This is a builtin Script, code will be reset when the system restarts")}}):e.isLockedByOther?n("InfoBlock",{attrs:{type:"error",title:e.$t("This Script has been locked by other, editing is disabled")}}):e._e()],1),e._v(" "),n("el-main",{style:e.$store.getters.codeMirrorSetting.style,attrs:{id:"editorContainer_CodeEditor"}},[n("textarea",{attrs:{id:"editor_CodeEditor"}})]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.$store.state.isLoaded,expression:"$store.state.isLoaded"}],staticClass:"code-editor-status-bar"},[n("el-tooltip",{attrs:{content:""+e.$t("DIFF")+e.$t(":")+" "+e.$tc("addedLines",e.diffAddedCount)+e.$tc("removedLines",e.diffRemovedCount),placement:"top-end"}},[n("span",[n("span",{staticClass:"text-good"},[e._v("+"+e._s(e.diffAddedCount))]),e._v("/"),n("span",{staticClass:"text-bad"},[e._v("-"+e._s(e.diffRemovedCount))])])]),e._v("\n          ,\n          "),e.codeLines===e.codeDraftLines?[n("el-tooltip",{attrs:{content:e.$tc("codeLines",e.codeLines),placement:"top-end"}},[n("span",[e._v(e._s(e.codeLines))])])]:[n("el-tooltip",{attrs:{content:""+e.$tc("codeLinesPrev",e.codeLines)+e.$tc("codeLinesCurr",e.codeDraftLines),placement:"top-end"}},[n("span",[e._v(e._s(e.codeLines)),n("i",{staticClass:"fa fa-long-arrow-right"}),n("span",{staticClass:"text-main"},[e._v(e._s(e.codeDraftLines))])])])],e._v("\n          ,\n          "),e.data.codeMD5!==e.data.codeDraftMD5?[n("el-tooltip",{attrs:{content:e.$t("Script is modified but NOT published yet"),placement:"top-end"}},[n("span",{staticClass:"text-main"},[e._v("MODIFIED")])])]:[n("el-tooltip",{attrs:{content:e.$t("Script is published"),placement:"top-end"}},[n("span",{staticClass:"text-good"},[e._v("CLEAR")])])]],2),e._v(" "),n("LongTextDialog",{ref:"longTextDialog",attrs:{title:e.$t("Diff between published and previously published"),mode:"diff"}}),e._v(" "),n("el-dialog",{attrs:{visible:e.showMonkeyPatchNotice,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"650px"},on:{"update:visible":function(t){e.showMonkeyPatchNotice=t}}},[n("div",{staticClass:"monkey-patch-notice-container"},[n("el-image",{attrs:{src:e.img_monkeyPatchNotice}}),e._v(" "),n("el-card",{staticClass:"monkey-patch-notice-content"},[n("i",{staticClass:"fa fa-fw fa-warning monkey-patch-notice-icon"}),e._v(" "),n("p",[e._v("\n                "+e._s(e.$t("For performance reasons, the script does not run in a sandbox or isolated environment."))+"\n                "+e._s(e.$t("Using monkey patches may cause problems to the entire system."))+"\n              ")]),e._v(" "),n("p",[e._v("\n                "+e._s(e.$t("Therefore, please avoid using monkey patches in scripts."))+"\n              ")])])],1),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[n("div",{staticClass:"monkey-patch-notice-title text-bad"},[n("i",{staticClass:"fa fa-fw fa-warning"}),e._v("\n              "+e._s(e.$t("Do NOT use monkey patch"))+"\n            ")])]),e._v(" "),n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"text"},on:{click:function(t){return e.closeMonkeyPatchNotice(!0)}}},[e._v(e._s(e.$t("Don't prompt again")))]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.closeMonkeyPatchNotice()}}},[e._v(e._s(e.$t("OK")))])],1)])],1)],1),e._v(" "),n("template",{slot:"paneR"},[n("div",{staticClass:"code-editor-output"},[n("div",{staticClass:"code-editor-output-close"},[n("el-link",{attrs:{type:"info"},on:{click:function(t){return t.stopPropagation(),e.clearHighlight()}}},[n("i",{staticClass:"fa fa-eraser"}),e._v(" "+e._s(e.$t("Clear highlighted")))]),e._v("\n          　\n          "),n("el-link",{attrs:{type:"info"},on:{click:function(t){return t.stopPropagation(),e.clearScriptOutput()}}},[n("i",{staticClass:"fa fa-trash-o"}),e._v(" "+e._s(e.$t("Clear output")))])],1),e._v(" "),n("el-tabs",{attrs:{"tab-position":"left",type:"border-card"}},[n("el-tab-pane",{ref:"codeEditorTextOutput",attrs:{label:e.$t("Output")+" "+(e.funcCallSeq>0?"#"+e.funcCallSeq:"")}},[n("pre",{domProps:{innerHTML:e._s(this.scriptOutputText||e.$t("Func exection result or log message will be shown here"))}})])],1)],1)])],2)],1)},r=[],o=n("2909"),a=n("1da1"),s=(n("99af"),n("d81d"),n("ac1f"),n("1276"),n("498a"),n("a15b"),n("130f"),n("d3b7"),n("25f0"),n("e9c4"),n("b680"),n("466d"),n("fb6a"),n("4de4"),n("a1f0"),n("a630"),n("3ca3"),n("5319"),n("159b"),n("38cf"),n("b0c0"),n("eee7"),n("96cf"),n("b76c")),c=n("bf68"),l=n("21a6"),u=n.n(l);const{replace:d}="",p=/[&<>'"]/g,f={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},h=e=>f[e],m=e=>d.call(e,p,h);var g=n("99cd"),b=n.n(g),v={name:"CodeEditor",components:{LongTextDialog:s["a"]},watch:{$route:{immediate:!0,handler:function(e,t){var n=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n.isNewLoaded=!0,e.next=3,n.loadData();case 3:case"end":return e.stop()}}),e)})))()}},isConflict:{immediate:!0,handler:function(e){this.T.setCodeMirrorReadOnly(this.codeMirror,e)}},selectedFuncId:function(e){this.$store.commit("updateEditor_highlightedFuncId",e),this.highlightFunc(e),this.autoFillFuncCallKwargsJSON(e)},highlightedFuncId:function(e){this.selectedFuncId=e},splitPanePercent:function(e){this.resizeVueSplitPane(e)},codeMirrorTheme:function(e){this.codeMirror.setOption("theme",e)},"$store.state.shortcutAction":function(e){switch(e.action){case"codeEditor.save":this.saveScript();break;case"codeEditor.run":this.callFuncDraft();break}}},methods:{_refreshAside:function(){this.updateFuncList(),this.$store.commit("updateScriptListSyncTime")},_downloadEditingCodeDraft:function(e){var t=new Blob([e],{type:"text/plain"}),n="".concat(this.scriptId,".").concat(this.M().format("YYYYMMDD_HHmmss"),".py.DRAFT");return u.a.saveAs(t,n),n},_saveCodeDraft:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.isSavingCodeDraft){n.next=5;break}return n.next=3,t.T.sleep(1e3);case 3:n.next=0;break;case 5:return t.isSavingCodeDraft=!0,null,n.prev=7,n.next=10,t._saveCodeDraftImpl(e);case 10:return n.abrupt("return",n.sent);case 13:n.prev=13,n.t0=n["catch"](7);case 15:return n.prev=15,t.isSavingCodeDraft=!1,n.finish(15);case 18:case"end":return n.stop()}}),n,null,[[7,13,15,18]])})))()},_saveCodeDraftImpl:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var i,r,o,a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e=e||{},!t.isLockedByOther){n.next=3;break}return n.abrupt("return");case 3:if(t.codeMirror){n.next=5;break}return n.abrupt("return");case 5:return i=t.prevCodeDraftMD5,r=t.codeMirror.getValue(),o=r.split("\n").map((function(e){return""===e.trim()?"":e})),r=o.join("\n"),n.next=11,t.T.callAPI("post","/api/v1/scripts/:id/do/modify",{params:{id:t.scriptId},body:{data:{codeDraft:r},prevCodeDraftMD5:i},alert:{okMessage:e.mute?null:t.$t("Script saved"),muteError:!0}});case 11:if(a=n.sent,a.ok){n.next=27;break}n.t0=a.reason,n.next="EBizRequestConflict.scriptDraftAlreadyChanged"===n.t0?16:22;break;case 16:return n.next=18,t.T.confirm("".concat(t.$t("Operating too frequently or Script is modified in other tab"),'\n                <br><span class="text-main">').concat(t.$t("Do you want to download current editing Script?"),"</span>"),"error");case 18:if(!n.sent){n.next=20;break}t._downloadEditingCodeDraft(r);case 20:return t.endEdit(),n.abrupt("break",25);case 22:return t.T.alert("".concat(t.$t("Saving Script failed"),'</span>\n                <br><span class="text-good">').concat(t.$t("Current editing Script has been downloaded"),"</span>")),t._downloadEditingCodeDraft(r),n.abrupt("break",25);case 25:n.next=33;break;case 27:t.data.codeDraft=r,t.prevCodeDraftMD5=a.data.codeDraftMD5,t._refreshAside(),s=t.T.getDiffInfo(t.data.code,r),t.diffAddedCount=s.addedCount,t.diffRemovedCount=s.removedCount;case 33:return n.abrupt("return",a);case 34:case"end":return n.stop()}}),n)})))()},loadData:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var i,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e=e||{},e.codeField=e.codeField||"codeDraft",n.next=4,t.T.callAPI_get("/api/v1/scripts/:id/do/get",{params:{id:t.scriptId}});case 4:if(i=n.sent,i.ok){n.next=8;break}return t.$router.push({name:"intro"}),n.abrupt("return");case 8:return t.data=i.data,t.prevCodeDraftMD5=i.data.codeDraftMD5,r=t.T.getDiffInfo(t.data.code,t.data.codeDraft),t.diffAddedCount=r.addedCount,t.diffRemovedCount=r.removedCount,n.next=16,t.T.callAPI_getOne("/api/v1/script-sets/do/list",t.scriptSetId);case 16:if(i=n.sent,i.ok){n.next=19;break}return n.abrupt("return");case 19:t.scriptSet=i.data,t.$store.commit("updateLoadStatus",!0),setImmediate((function(){t.codeMirror&&(t.codeMirror.setValue(""),t.codeMirror.setValue(t.data[e.codeField]||""),t.codeMirror.refresh(),t.codeMirror.focus()),t.updateFuncList(),t.selectedFuncId=t.highlightedFuncId,t.autoFillFuncCallKwargsJSON(t.selectedFuncId),(t.isConflict||t.isLockedByOther)&&t.T.setCodeMirrorReadOnly(t.codeMirror,!0),t.$store.commit("updateCodeEditor_isCodeLoaded",!0)})),t.closeVueSplitPane();case 23:case"end":return n.stop()}}),n)})))()},saveScript:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isLockedByOther){t.next=2;break}return t.abrupt("return");case 2:if(e.codeMirror){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e._saveCodeDraft();case 6:case"end":return t.stop()}}),t)})))()},showDiff:function(){var e=this.data.title?" (".concat(this.data.title,")"):"",t="".concat(this.scriptId).concat(e),n=this.data.code||"",i=this.data.codeDraft||"",r=this.$t("Published Code"),o=this.$t("Saved Draft Code"),a=Object(c["createPatch"])(t,n,i,r,o),s=this.M().utcOffset(8).format("YYYYMMDD_HHmmss"),l="".concat(this.data.id,".diff.").concat(s);this.$refs.longTextDialog.update(a,l)},publishScript:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isLockedByOther){t.next=2;break}return t.abrupt("return");case 2:if(e.codeMirror){t.next=4;break}return t.abrupt("return");case 4:return e.updateHighlightLineConfig("selectedFuncLine",null),e.updateHighlightLineConfig("errorLine",null),t.next=8,e.T.confirm(e.$t("Are you sure you want to publish the Script?"));case 8:if(t.sent){t.next=10;break}return t.abrupt("return");case 10:return t.next=12,e._saveCodeDraft({mute:!0});case 12:if(n=t.sent,n&&n.ok){t.next=15;break}return t.abrupt("return");case 15:return e.workerRunning=!0,e.workerRunningTipTitle=e.$t("Publishing Script, it will be finished in a few seconds. If the page is not responding for a long time, please try refreshing."),i=setTimeout((function(){e.fullScreenLoading=!0}),200),t.next=20,e.T.callAPI("post","/api/v1/scripts/:id/do/publish",{params:{id:e.scriptId},body:{force:!0,data:{note:"Published by Code Editor"}},alert:{okMessage:e.$t("Script published, new Script is in effect immediately"),muteError:!0}});case 20:if(n=t.sent,clearTimeout(i),e.fullScreenLoading=!1,e.workerRunning=!1,n.ok){t.next=28;break}return e.outputResult("publish",e.scriptId,n),e.alertOnEScript(n,!0),t.abrupt("return");case 28:e._refreshAside();case 29:case"end":return t.stop()}}),t)})))()},resetScript:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isLockedByOther){t.next=2;break}return t.abrupt("return");case 2:if(e.codeMirror){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e.T.confirm(e.$t("Are you sure you want to reset the Script?"));case 6:if(t.sent){t.next=8;break}return t.abrupt("return");case 8:return e.updateHighlightLineConfig("errorLine",null),t.next=11,e.loadData({codeField:"code"});case 11:e.T.notify(e.$t("Script has been reset to previous version"));case 12:case"end":return t.stop()}}),t)})))()},callFuncDraft:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,i,r,o,a,s,c,l,u,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.codeMirror){t.next=2;break}return t.abrupt("return");case 2:if(e.updateHighlightLineConfig("selectedFuncLine",null),e.updateHighlightLineConfig("errorLine",null),e.isLockedByOther){t.next=10;break}return t.next=7,e._saveCodeDraft({mute:!0});case 7:if(n=t.sent,n&&n.ok){t.next=10;break}return t.abrupt("return");case 10:i=null,t.prev=11,i=JSON.parse(e.funcCallKwargsJSON||"{}"),t.next=18;break;case 15:return t.prev=15,t.t0=t["catch"](11),t.abrupt("return",e.T.alert("".concat(e.$t("Invalid argument format"),"<br>").concat(t.t0.toString())));case 18:return r=function(t){var n=e.$t("Func is running. If it is not responding for a long time, please try refreshing.");t>0&&(n=e.$t("Func is running. It will wait at most {seconds} for the result. If it is not responding for a long time, please try refreshing.",{seconds:e.$tc("seconds",t)})),e.workerRunningTipTitle=n},e.workerRunning=!0,e.countDownTimer&&(clearInterval(e.countDownTimer),e.countDownTimer=null),o=e.$store.getters.CONFIG("_FUNC_TASK_DEBUG_TIMEOUT"),r(o),e.countDownTimer=setInterval((function(){o--,(o<=0||!e.workerRunning)&&clearInterval(e.countDownTimer),r(o)}),1e3),a=setTimeout((function(){e.fullScreenLoading=!0}),500),s=null,t.prev=26,t.next=29,e.T.callAPI("post","/api/v1/func-draft/:funcId",{params:{funcId:e.selectedFuncId},body:{kwargs:i},alert:{muteError:!0},extraOptions:{noCountProcessing:!0}});case 29:s=t.sent,t.next=35;break;case 32:return t.prev=32,t.t1=t["catch"](26),t.abrupt("return",console.error(t.t1));case 35:return t.prev=35,clearTimeout(a),e.fullScreenLoading=!1,e.workerRunning=!1,t.finish(35);case 40:for(l in c=[],i)i.hasOwnProperty(l)&&(u=i[l],u=null===u?"None":!0===u?"True":!1===u?"False":JSON.stringify(u),c.push("".concat(l,"=").concat(u)));d=c.join(", "),e.outputResult("execute","".concat(e.selectedFuncId,"(").concat(d,")"),s),s.ok&&setImmediate((function(){e.highlightFunc(e.selectedFuncId)})),s.ok||"EScriptPreCheck"===s.reason||e.alertOnEScript(s);case 46:case"end":return t.stop()}}),t,null,[[11,15],[26,32,35,40]])})))()},clearHighlight:function(){this.updateHighlightLineConfig("selectedFuncLine",null),this.updateHighlightLineConfig("errorLine",null)},clearScriptOutput:function(){this.scriptOutput=[],this.clearHighlight(),this.resizeVueSplitPane(100)},outputResult:function(e,t,n){var i=this;if(n.ok||"EScriptPreCheck"===n.reason){this.funcCallSeq++;var r=null,a=null,s=null,c=null;if(n.data&&(n.ok&&(r=n.data.cost.toFixed(3)),a=n.data.result.logMessages,Array.isArray(a)&&(a=a.map((function(e){var t=e.match(/^\[\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\]/);if(t){var n=e.slice(t[0].length);return i.T.strf('<span class="text-main">{0}</span>{1}',t[0],m(n))}return m(e)})),a=a.join("\n")||null),n.ok))try{s=n.data.result.funcResult.repr||null,s=m(s)}catch(d){}if(n.detail){var l=n.detail.einfoTEXT.split("\n").reduce((function(e,t){return t.trim()?(e.push('<span class="code-editor-output-error-stack">'.concat(m(t),"</span>")),e):e}),[]);c=l.join("\n")}var u={seq:this.funcCallSeq,type:e,name:t,cost:r,logMessages:a,funcOutput:s,stackInfo:c};this.scriptOutput.push(u),this.openVueSplitPane(),setImmediate((function(){var e=document.getElementsByClassName("code-editor-output-seq"),t=e[e.length-1],n=i.$refs.codeEditorTextOutput.$el.parentElement,r=n.parentElement;n.scrollTo({left:0,top:t.offsetTop-r.scrollHeight+35}),n.scrollTo({left:0,top:n.scrollHeight,behavior:"smooth"})})),n.ok||setImmediate((function(){var e="".concat(i.scriptId),t=n.detail.traceInfo.stack,r=t.filter((function(t){if(t.isInScript&&t.filename===e)return!0})),a=r[r.length-1],s=Object(o["a"])(n.detail.traceInfo.exceptionDump.matchAll(/^File \"(\w+)\", line (\d+)$/gm)).pop(),c=a?a.lineNumber-1:parseInt(s[2])-1,l="";try{l=n.detail.traceInfo.exceptionDump.split("\n").pop().split(":")[0].trim()}catch(d){return console.error(d)}var u='\n              <span class="error-info">\n                <i class="fa fa-fw fa-times-circle"></i>\n                <span>'.concat(l,"</span>\n              </span> ");i.updateHighlightLineConfig("errorLine",{line:c,scroll:1,marginType:"prev",textClass:"highlight-text",backgroundClass:"error-line-background highlight-code-line-blink",lineWidgetConfig:{type:"errorLine",innerHTML:u}})}))}},autoFillFuncCallKwargsJSON:function(e){if(this.draftFuncs.length<=0)this.funcCallKwargsJSON="";else for(var t=0;t<this.draftFuncs.length;t++)if(this.draftFuncs[t].id===e)return void(this.funcCallKwargsJSON=JSON.stringify(this.draftFuncs[t].kwargs))},endEdit:function(e){e=e||{};var t={name:"code-viewer",params:{id:this.scriptId}};this.$router.push(t)},resizeVueSplitPane:function(e){e>=this.SPLIT_PANE_CLOSE_PERCENT?this.$refs.vueSplitPane.percent=e:(e>this.SPLIT_PANE_MAX_PERCENT?e=this.SPLIT_PANE_MAX_PERCENT:e<this.SPLIT_PANE_MIN_PERCENT&&(e=this.SPLIT_PANE_MIN_PERCENT),this.$refs.vueSplitPane.percent=e,this.debouncedUpdatePanePercent(this.$store,e))},updateFuncList:function(){var e=this;if(this.data.codeDraft){var t=/^def ([a-zA-Z][a-zA-Z0-9_]+)\((.*)\)\:/gm,n=Array.from(this.data.codeDraft.matchAll(t),(function(t){var n=t[1],i="".concat(e.scriptId,".").concat(n),r=t[2].replace(/\n/g," ").split(",").reduce((function(e,t){var n=t.trim().split("=")[0];return n&&(e[n]="".concat(n.toUpperCase())),e}),{});return{id:i,name:n,kwargs:r}})),i=[],r={};n.forEach((function(e){r[e.id]||(i.push(e),r[e.id]=!0)})),this.draftFuncs=i}},openVueSplitPane:function(){this.$refs.vueSplitPane.percent=this.splitPanePercent},closeVueSplitPane:function(){this.$refs.vueSplitPane.percent=this.SPLIT_PANE_CLOSE_PERCENT},alertOnEScript:function(e,t){switch(e.reason){case"EScriptPreCheck":t?this.T.alert("".concat(this.$t("Script publishing failed. Please check your code"),"\n                <br>").concat(this.$t("Detail information is shown in the output box bellow"))):this.T.alert("".concat(this.$t("Script executing failed. Please check your code"),"\n                <br>").concat(this.$t("Detail information is shown in the output box bellow")));break;case"EAPITimeout":case"EFuncTimeout":t?this.T.alert("".concat(this.$t("Script publishing timeout, please make sure that no time-consuming code in global scope"),"\n                <br>").concat(this.$t("If this issue persists, please contact the administrator to report this issue"))):this.T.alert("".concat(this.$t("Waiting Func response timeout"),'\n                <span class="text-main">\n                  <br>').concat(this.$t("There is a {seconds} time limit when calling Funcs in Code Editor",{seconds:this.$tc("seconds",this.$store.getters.CONFIG("_FUNC_TASK_DEBUG_TIMEOUT"))}),"\n                  <br>").concat(this.$t("It is not recommended for synchronous calling Funcs that response slowly"),"</small>\n                </span>"));break;case"EFuncFailed":t?this.T.alert("".concat(this.$t("Script publishing failed. Script executing module may crashed, please contact the administrator to report this issue"),"\n                <br>").concat(this.$t("Detail information is shown in the output box bellow"))):this.T.alert("".concat(this.$t("Script executing failed. Script executing module may crashed, please contact the administrator to report this issue"),"\n                <br>").concat(this.$t("Detail information is shown in the output box bellow")));break;case"EFuncResultParsingFailed":this.T.alert("".concat(this.$t("Func returned a value that can not been parsed as JSON. Please check your code"),"\n                <br>").concat(this.$t("In general, common used types are safe (e.g. list, dict, int, float, str, bool, None)."),"\n                <br>").concat(this.$t("Some math lib may return complicated values, like numpy.NaN. These values should be converted to common used types before returning")));break;case"EClientDuplicated":this.T.alert("".concat(this.$t("Duplicated names of Funcs decorated by @DFF.API(...)"),"\n                <br>").concat(this.$t("Please check the code and try again")));break}this.scriptOutput.length>0&&this.openVueSplitPane()},_clearLineHighlight:function(e){try{this.codeMirror.removeLineClass(e,"text"),this.codeMirror.removeLineClass(e,"background"),this.codeMirror.removeLineClass(e,"wrap");var t=this.codeMirror.lineInfo(e).widgets;Array.isArray(t)&&t.forEach((function(e){e.clear()}))}catch(n){}},_setLineHighlight:function(e){if(!this.codeMirror)return null;e=e||{};var t=e.line+(e.scroll||0);if(t=Math.min(Math.max(t,0),this.codeMirror.lineCount()-1),"next"===e.marginType?(this.codeMirror.setCursor({line:this.codeMirror.lineCount()-1}),this.codeMirror.setCursor({line:t})):"prev"===e.marginType&&(this.codeMirror.setCursor({line:0}),this.codeMirror.setCursor({line:t})),this.codeMirror.setCursor({line:e.line}),e.textClass&&this.codeMirror.addLineClass(e.line,"text",e.textClass),e.backgroundClass&&this.codeMirror.addLineClass(e.line,"background",e.backgroundClass),e.wrapClass&&this.codeMirror.addLineClass(e.line,"wrap",e.wrapClass),e.lineWidgetConfig){var n=e.lineWidgetConfig,i=null;switch(n.type){case"errorLine":i=document.createElement("div"),i.classList.add("error-line-text"),i.classList.add("highlight-text");var r=this.$store.getters.codeMirrorSetting.style;i.style.top="-".concat(parseInt(r.fontSize)*r.lineHeight,"px"),i.style.fontSize="".concat(r.fontSize),i.style.lineHeight=r.lineHeight,i.innerHTML=n.innerHTML;break}i&&this.codeMirror.addLineWidget(e.line,i)}return this.codeMirror.lineInfo(e.line)},updateHighlightLineConfig:function(e,t){var n=this.T.jsonCopy(this.$store.state.codeEditor_highlightedLineConfigMap)||{};if(null===t?n[this.scriptId]&&delete n[this.scriptId][e]:(n[this.scriptId]||(n[this.scriptId]={}),n[this.scriptId][e]=t),this.codeMirror){for(var i in this.highlightedLineInfoMap)if(this.highlightedLineInfoMap.hasOwnProperty(i)){var r=this.highlightedLineInfoMap[i];for(var o in r)if(r.hasOwnProperty(o)){var a=r[o];this._clearLineHighlight(a.handle.lineNo())}}var s={},c=n[this.scriptId]||{};for(var l in c)if(c.hasOwnProperty(l)){var u=c[l],d=this._setLineHighlight(u);d&&(s[this.scriptId]||(s[this.scriptId]={}),s[this.scriptId][l]=d)}this.highlightedLineInfoMap=s,this.$store.commit("updateCodeEditor_highlightedLineConfigMap",n)}},highlightFunc:function(e){if(this.codeMirror&&e){var t=e.split(".")[1];this.updateHighlightLineConfig("selectedFuncLine",null);var n="def ".concat(t,"("),i=this.codeMirror.getSearchCursor(n);if(i.findNext()){var r=i.from().line;this.updateHighlightLineConfig("selectedFuncLine",{line:r,marginType:"next",scroll:-1,textClass:"highlight-text",backgroundClass:"current-func-background highlight-code-line-blink"})}}},closeMonkeyPatchNotice:function(e){this.showMonkeyPatchNotice=!1,this.$store.commit("dismissMonkeyPatchNotice"),e&&this.$store.commit("disableMonkeyPatchNotice")}},computed:{SPLIT_PANE_MAX_PERCENT:function(){return 80},SPLIT_PANE_MIN_PERCENT:function(){return 30},SPLIT_PANE_CLOSE_PERCENT:function(){return 100},TEXT_OUTPUT_LIMIT:function(){return 500},codeMirrorTheme:function(){return this.T.getCodeMirrorThemeName()},scriptId:function(){return this.$route.params.id},scriptSetId:function(){return this.scriptId.split("__")[0]},conflictStatus:function(){return this.$store.getters.getConflictStatus(this.$route)},isLockedByOther:function(){return this.data.lockedByUserId&&this.data.lockedByUserId!==this.$store.getters.userId||this.scriptSet.lockedByUserId&&this.scriptSet.lockedByUserId!==this.$store.getters.userId},highlightedFuncId:function(){return this.$store.state.Editor_highlightedFuncId},splitPanePercent:function(){return this.$store.state.codeEditor_splitPanePercent||this.$store.getters.DEFAULT_STATE.codeEditor_splitPanePercent},codeLines:function(){return(this.data.code||"").split("\n").length},codeDraftLines:function(){return(this.data.codeDraft||"").split("\n").length},scriptOutputText:function(){var e=this,t=[];this.scriptOutput.forEach((function(n){var i='<span class="code-editor-output-info">#<span class="code-editor-output-seq">'.concat(n.seq,"</span> ").concat("-".repeat(20),"</span>"),r="";switch(n.type){case"publish":r=e.$t("Publish Script")+e.$t(":");break;case"execute":r=e.$t("Executed Func")+e.$t(":");break}var o='<span class="code-editor-output-info">'.concat(r," ").concat(n.name,"</span>"),a="";n.cost&&(a='<span class="code-editor-output-info">'.concat(e.$t("Run Time")).concat(e.$t(":")," ").concat(e.$tc("seconds",n.cost),"</span>"),n.cost>3&&(a+='<br><span class="text-watch">'.concat(e.$t("It took too much time for running, may not be suitable for synchronous calling scenario"),"</span>")));var s=n.logMessages,c=n.funcOutput,l=null;c&&(l='<span class="code-editor-output-info">'.concat(e.$t("Func Return Value")).concat(e.$t(":"),"</span>"));var u=n.stackInfo,d=null;u&&(d='<span class="code-editor-output-info">'.concat(e.$t("Stack")).concat(e.$t(":"),"</span>"));var p=[i,o];a&&p.push("",a),s&&p.push("",s),l&&p.push("",l,c),d&&p.push("",d,u),p=p.filter((function(e){return"string"===typeof e})).join("\n").trimStart(),t.push(p)}));var n=t.join("\n\n"),i=n.split("\n");return i.length>this.TEXT_OUTPUT_LIMIT&&(n=i.slice(-1*this.TEXT_OUTPUT_LIMIT).join("\n")),n}},props:{},data:function(){return{isNewLoaded:!0,codeMirror:null,highlightedLineInfoMap:{},currentErrorLineInfo:null,data:{},scriptSet:{},draftFuncs:[],selectedFuncId:"",funcCallKwargsJSON:"",funcCallSeq:0,countDownTimer:null,fullScreenLoading:!1,workerRunning:!1,workerRunningTipTitle:"",scriptOutput:[],prevCodeDraftMD5:null,isSavingCodeDraft:!1,diffAddedCount:0,diffRemovedCount:0,img_monkeyPatchNotice:b.a,showMonkeyPatchNotice:!1}},created:function(){this.debouncedUpdatePanePercent=this.T.debounce((function(e,t){e.commit("updateCodeEditor_splitPanePercent",t)}),100)},mounted:function(){var e=this;setImmediate((function(){if(e.codeMirror=e.T.initCodeMirror("editor_CodeEditor"),e.codeMirror.setOption("theme",e.codeMirrorTheme),!e.isLockedByOther){var t=function(t){return e.T.debounce((function(n,i){if(t===e.scriptId&&!e.isLockedByOther&&e.codeMirror)if(e.isNewLoaded)e.isNewLoaded=!1;else{var r=e.codeMirror.getValue();if(r.trim()){var o=e.T.getDiffInfo(e.data.codeDraft,r),a=Math.max(o.addedCount,o.removedCount);a>30||a/o.srcTotalCount>.3||e._saveCodeDraft({mute:!0})}}}),1e3)};e.codeMirror.on("change",t(e.scriptId))}e.$store.getters.showMonkeyPatchNotice&&(e.showMonkeyPatchNotice=!0)}))},beforeDestroy:function(){this.T.destoryCodeMirror(this.codeMirror)},beforeRouteLeave:function(e,t,n){var i=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i.updateHighlightLineConfig("selectedFuncLine",null),i.updateHighlightLineConfig("errorLine",null),!i.isLockedByOther){e.next=4;break}return e.abrupt("return",n());case 4:if(i.codeMirror){e.next=6;break}return e.abrupt("return",n());case 6:if(i.$store.getters.isSignedIn){e.next=8;break}return e.abrupt("return",n());case 8:return e.next=10,i._saveCodeDraft({mute:!0});case 10:if(t=e.sent,!t||!t.ok){e.next=13;break}return e.abrupt("return",n());case 13:case"end":return e.stop()}}),e)})))()}},w=v,y=(n("86d1"),n("ee03"),n("2877")),_=n("20b6"),S=n("014e"),C=Object(y["a"])(w,i,r,!1,null,"0400aab4",null);"function"===typeof _["default"]&&Object(_["default"])(C),"function"===typeof S["default"]&&Object(S["default"])(C);t["default"]=C.exports},ee03:function(e,t,n){"use strict";n("82a6")},eee7:function(e,t,n){"use strict";var i=n("23e7"),r=n("58a8").start,o=n("c8d2"),a=o("trimStart"),s=a?function(){return r(this)}:"".trimStart;i({target:"String",proto:!0,name:"trimStart",forced:a},{trimStart:s,trimLeft:s})}}]);