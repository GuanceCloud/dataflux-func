(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-21cf5930"],{4168:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("transition",{attrs:{name:"fade"}},[r("el-container",{directives:[{name:"show",rawName:"v-show",value:e.$store.state.isLoaded,expression:"$store.state.isLoaded"}],attrs:{direction:"vertical"}},[r("el-header",{attrs:{height:"60px"}},[r("div",{staticClass:"page-header"},[r("span",[e._v(e._s(e.modeName)+"脚本包")]),e._v(" "),r("div",{staticClass:"header-control"},[r("el-button",{attrs:{size:"small"},on:{click:e.goToHistory}},[r("i",{staticClass:"fa fa-fw fa-history"}),e._v("\n            脚本包导入历史\n          ")])],1)])]),e._v(" "),r("el-main",[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:15}},[r("div",{staticClass:"common-form"},[r("el-form",{ref:"form",attrs:{"label-width":"120px",model:e.form,rules:e.formRules}},[r("el-form-item",{attrs:{label:"导入脚本包",prop:"upload"}},[r("el-upload",{ref:"upload",class:e.uploadAreaBorderClass,attrs:{drag:"",limit:2,multiple:!1,"auto-upload":!1,"show-file-list":!1,"http-request":e.handleUpload,"on-change":e.onUploadFileChange,accept:e.$store.getters.CONFIG("_FUNC_PKG_EXPORT_EXT"),action:""}},[r("i",{staticClass:"fa",class:e.uploadAreaIconClass}),e._v(" "),r("div",{staticClass:"el-upload__text"},[r("span",{domProps:{innerHTML:e._s(e.uploadAreaIconText)}})])])],1),e._v(" "),r("el-form-item",{attrs:{label:"导入令牌",prop:"password"}},[r("el-input",{attrs:{resize:"none",maxlength:"64","show-word-limit":""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}}),e._v(" "),r("InfoBlock",{attrs:{title:"填写导出时提示的密码，无密码则留空即可"}}),e._v(" "),r("InfoBlock",{attrs:{type:"warning",title:"脚本包附带导入的数据源，密码等敏感信息需要重新输入"}})],1),e._v(" "),r("el-form-item",[r("div",{staticClass:"setup-right"},[r("el-button",{attrs:{type:"primary",disabled:e.disableUpload},on:{click:e.submitData}},[e._v(e._s(e.modeName))])],1)])],1)],1)]),e._v(" "),r("el-col",{staticClass:"hidden-md-and-down",attrs:{span:9}})],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"即将导入脚本包",visible:e.showConfirm,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!0,width:"750px"},on:{"update:visible":function(t){e.showConfirm=t}}},[r("span",{staticClass:"import-token-dialog-content"},[e.checkResult&&e.checkResult.diff?[e.T.isNothing(e.checkResult.diff.add)?e._e():[r("span",{staticClass:"text-good"},[e._v("新增脚本集：")]),e._v(" "),e._l(e.checkResult.diff.add,(function(t){return r("el-tag",{key:t.id,attrs:{size:"medium",type:"success"}},[e._v(e._s(t.title||t.id))])})),e._v(" "),r("hr",{staticClass:"br"})],e._v(" "),e.T.isNothing(e.checkResult.diff.replace)?e._e():[r("span",{staticClass:"text-watch"},[e._v("替换脚本集：")]),e._v(" "),e._l(e.checkResult.diff.replace,(function(t){return r("el-tag",{key:t.id,attrs:{size:"medium",type:"warning"}},[e._v(e._s(t.title||t.id))])})),e._v(" "),r("InfoBlock",{attrs:{type:"warning",title:"被替换的脚本集下所有脚本文件会被完整替换为新版本，新版本中不存在的脚本文件会被删除"}}),e._v(" "),r("hr",{staticClass:"br"})]]:e._e(),e._v(" "),e.checkResult&&e.checkResult.summary&&e.checkResult.summary.note?[r("span",{staticClass:"text-info"},[e._v("备注：")]),e._v(" "),r("pre",{staticClass:"import-note"},[e._v(e._s(e.checkResult.summary.note))]),e._v(" "),r("hr",{staticClass:"br"})]:e._e()],2),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showConfirm=!1}}},[e._v("取消")]),e._v(" "),r("el-button",{directives:[{name:"prevent-re-click",rawName:"v-prevent-re-click"}],attrs:{type:"primary",loading:e.isImporting},on:{click:e.confirmImport}},[e._v("\n          确认导入\n        ")])],1)])],1)],1)},s=[],o=r("1da1"),i=(r("a15b"),r("130f"),r("a434"),r("b0c0"),r("96cf"),{name:"ScriptSetImport",components:{},watch:{showConfirm:function(e){!1===e&&this.initFilePreview()}},methods:{submitData:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$refs.form.validate();case 3:t.next=8;break;case 5:return t.prev=5,t.t0=t["catch"](0),t.abrupt("return",console.error(t.t0));case 8:t.t1=e.T.setupPageMode(),t.next="import"===t.t1?11:14;break;case 11:return t.next=13,e.$refs.upload.submit();case 13:return t.abrupt("return",t.sent);case 14:case"end":return t.stop()}}),t,null,[[0,5]])})))()},handleUpload:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var a,s,o,i,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:for(o in a=new FormData,s=t.T.jsonCopy(t.form),s)s.hasOwnProperty(o)&&(i=s[o],a.append(o,i));return a.append("checkOnly",!0),a.append("files",e.file),r.next=7,t.T.callAPI("post","/api/v1/script-sets/do/import",{body:a,alert:{muteError:!0}});case 7:if(n=r.sent,n.ok){r.next=10;break}return r.abrupt("return",t.alertOnError(n));case 10:t.showConfirm=!0,t.checkResult=n.data;case 12:case"end":return r.stop()}}),r)})))()},confirmImport:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isImporting=!0,t.next=3,e.T.callAPI("post","/api/v1/script-sets/do/confirm-import",{body:{confirmId:e.checkResult.confirmId},alert:{okMessage:e.$t("Data imported")}});case 3:if(r=t.sent,e.isImporting=!1,r.ok){t.next=7;break}return t.abrupt("return",e.alertOnError(r));case 7:if(!e.T.isNothing(r.data.pkgs)){t.next=11;break}e.goToHistory(),t.next=20;break;case 11:return e.showConfirm=!1,t.next=14,e.T.confirm(e.$t("Imported Script Set requires 3rd party packages, do you want to open PIP tool now?"));case 14:if(t.sent){t.next=18;break}e.goToHistory(),t.next=20;break;case 18:a=r.data.pkgs.join(" "),e.$router.push({name:"pip-tool",query:{pkgs:e.T.getBase64(a)}});case 20:case"end":return t.stop()}}),t)})))()},alertOnError:function(e){var t=this;if(!e.ok){switch(e.reason){case"EBizCondition.InvalidPassword":this.T.alert("导入令牌错误<br>\n              请使用复制粘贴的方式填写导入令牌，避免错填容易混淆的字母数字");break;case"EBizCondition.ConfirmingImportTimeout":this.T.alert("脚本包导入确认超时<br>\n              脚本包导入后长时间未确认，请重新尝试导入");break;default:this.T.alert("脚本包导入时发生意外错误<br>\n              请尝试重新导入，如果问题一直出现，请联系脚本包发行方");break}this.form.password="",this.initFilePreview(),setImmediate((function(){t.$refs.form.clearValidate()}))}},initFilePreview:function(){this.$refs.upload.clearFiles(),this.uploadAreaBorderClass=[],this.uploadAreaIconClass=["fa-cloud-upload"],this.uploadAreaIconText="将文件拖到此处，或 <em>点击上传</em>"},showFilePreview:function(e){this.uploadAreaBorderClass=["upload-area-active"],this.uploadAreaIconClass=["fa-cloud-upload","text-main"],this.uploadAreaIconText='<code class="text-main">'.concat(e,"</code>")},onUploadFileChange:function(e,t){t.length>1&&t.splice(0,1),this.disableUpload=t.length<=0,this.disableUpload?this.initFilePreview():this.showFilePreview(t[0].name)},goToHistory:function(){this.$router.push({name:"script-set-import-history-list"})}},computed:{modeName:function(){var e={import:"导入"};return e[this.T.setupPageMode()]}},props:{},data:function(){return{scriptSetMap:{},uploadAreaBorderClass:[],uploadAreaIconClass:["fa-cloud-upload"],uploadAreaIconText:"将文件拖到此处，或 <em>点击上传</em>",disableUpload:!0,showConfirm:!1,isImporting:!1,checkResult:{},form:{password:""},formRules:{}}},created:function(){this.$store.commit("updateLoadStatus",!0)}}),n=i,l=(r("df7e"),r("c045"),r("2877")),c=r("fcf7"),d=Object(l["a"])(n,a,s,!1,null,"7a3d5c53",null);"function"===typeof c["default"]&&Object(c["default"])(d);t["default"]=d.exports},a434:function(e,t,r){"use strict";var a=r("23e7"),s=r("da84"),o=r("23cb"),i=r("5926"),n=r("07fa"),l=r("7b0b"),c=r("65f0"),d=r("8418"),u=r("1dde"),p=u("splice"),f=s.TypeError,m=Math.max,h=Math.min,v=9007199254740991,w="Maximum allowed length exceeded";a({target:"Array",proto:!0,forced:!p},{splice:function(e,t){var r,a,s,u,p,_,b=l(this),g=n(b),k=o(e,g),C=arguments.length;if(0===C?r=a=0:1===C?(r=0,a=g-k):(r=C-2,a=h(m(i(t),0),g-k)),g+r-a>v)throw f(w);for(s=c(b,a),u=0;u<a;u++)p=k+u,p in b&&d(s,u,b[p]);if(s.length=a,r<a){for(u=k;u<g-a;u++)p=u+a,_=u+r,p in b?b[_]=b[p]:delete b[_];for(u=g;u>g-a+r;u--)delete b[u-1]}else if(r>a)for(u=g-a;u>k;u--)p=u+a-1,_=u+r-1,p in b?b[_]=b[p]:delete b[_];for(u=0;u<r;u++)b[u+k]=arguments[u+2];return b.length=g-a+r,s}})},a97e:function(e,t,r){},c045:function(e,t,r){"use strict";r("a97e")},c5f3:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"zh-CN":{"Data imported":"数据已导入","Imported Script Set requires 3rd party packages, do you want to open PIP tool now?":"导入的脚本集需要第三方包，是否现在前往PIP工具？"}}'),delete e.options._Ctor}},ddb7:function(e,t,r){},df7e:function(e,t,r){"use strict";r("ddb7")},fcf7:function(e,t,r){"use strict";var a=r("c5f3"),s=r.n(a);t["default"]=s.a}}]);