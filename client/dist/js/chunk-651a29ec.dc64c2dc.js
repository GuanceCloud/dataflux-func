(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-651a29ec"],{"06c5":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));r("fb6a"),r("d3b7"),r("b0c0"),r("a630"),r("3ca3"),r("ac1f"),r("00b4");var a=r("6b75");function s(e,t){if(e){if("string"===typeof e)return Object(a["a"])(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Object(a["a"])(e,t):void 0}}},"11fe6":function(e,t,r){"use strict";r("670f")},"21a6":function(e,t,r){e.exports=r("7ab4")(1561)},3835:function(e,t,r){"use strict";function a(e){if(Array.isArray(e))return e}r.d(t,"a",(function(){return i}));r("a4d3"),r("e01a"),r("d3b7"),r("d28b"),r("3ca3"),r("ddb0");function s(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,s,n=[],o=!0,i=!1;try{for(r=r.call(e);!(o=(a=r.next()).done);o=!0)if(n.push(a.value),t&&n.length===t)break}catch(l){i=!0,s=l}finally{try{o||null==r["return"]||r["return"]()}finally{if(i)throw s}}return n}}var n=r("06c5");function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){return a(e)||s(e,t)||Object(n["a"])(e,t)||o()}},"670f":function(e,t,r){},"6b75":function(e,t,r){"use strict";function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}r.d(t,"a",(function(){return a}))},a630:function(e,t,r){e.exports=r("b456")(1165)},ba92:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("transition",{attrs:{name:"fade"}},[r("el-container",{directives:[{name:"show",rawName:"v-show",value:e.$store.state.isLoaded,expression:"$store.state.isLoaded"}],attrs:{direction:"vertical"}},[r("el-header",{attrs:{height:"60px"}},[r("h1",[e._v("\n        "+e._s(e.modeName)+"脚本包\n        "),r("div",{staticClass:"header-control"},[r("el-button",{attrs:{size:"small"},on:{click:e.goToHistory}},[r("i",{staticClass:"fa fa-fw fa-history"}),e._v("\n            脚本包导出历史\n          ")])],1)])]),e._v(" "),r("el-main",[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:15}},[r("div",{staticClass:"export-form"},[r("el-form",{ref:"form",attrs:{"label-width":"120px",model:e.form,rules:e.formRules}},[r("el-form-item",{attrs:{label:"脚本集",prop:"scriptSetIds"}},[r("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.form.scriptSetIds,callback:function(t){e.$set(e.form,"scriptSetIds",t)},expression:"form.scriptSetIds"}},e._l(e.scriptSets,(function(t){return r("el-option",{key:t.id,attrs:{label:t.title||t.id,value:t.id}},[r("span",{staticClass:"select-item-name"},[e._v(e._s(t.title||t.id))]),e._v(" "),r("code",{staticClass:"select-item-id"},[e._v("ID: "+e._s(t.id))])])})),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"脚本集关联数据"}},[r("el-checkbox",{attrs:{size:"medium",border:"",label:"授权链接"},model:{value:e.form.includeAuthLinks,callback:function(t){e.$set(e.form,"includeAuthLinks",t)},expression:"form.includeAuthLinks"}}),e._v(" "),r("el-checkbox",{attrs:{size:"medium",border:"",label:"自动触发配置"},model:{value:e.form.includeCrontabConfigs,callback:function(t){e.$set(e.form,"includeCrontabConfigs",t)},expression:"form.includeCrontabConfigs"}}),e._v(" "),r("el-checkbox",{attrs:{size:"medium",border:"",label:"批处理"},model:{value:e.form.includeBatches,callback:function(t){e.$set(e.form,"includeBatches",t)},expression:"form.includeBatches"}}),e._v(" "),r("InfoBlock",{attrs:{title:"系统会自动查找导出脚本集相关的数据，并在导入时替换脚本集关联的所有数据"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"数据源",prop:"dataSourceIds"}},[r("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.form.dataSourceIds,callback:function(t){e.$set(e.form,"dataSourceIds",t)},expression:"form.dataSourceIds"}},e._l(e.dataSources,(function(t){return r("el-option",{key:t.id,attrs:{label:t.title||t.id,value:t.id}},[r("span",{staticClass:"select-item-name"},[e._v(e._s(t.title||t.id))]),e._v(" "),r("code",{staticClass:"select-item-id"},[e._v("ID: "+e._s(t.id))])])})),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"环境变量",prop:"envVariableIds"}},[r("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.form.envVariableIds,callback:function(t){e.$set(e.form,"envVariableIds",t)},expression:"form.envVariableIds"}},e._l(e.envVariables,(function(t){return r("el-option",{key:t.id,attrs:{label:t.title||t.id,value:t.id}},[r("span",{staticClass:"select-item-name"},[e._v(e._s(t.title||t.id))]),e._v(" "),r("code",{staticClass:"select-item-id"},[e._v("ID: "+e._s(t.id))])])})),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"启用密码"}},[r("el-switch",{attrs:{"active-value":!0,"inactive-value":!1},model:{value:e.isPasswordEnabled,callback:function(t){e.isPasswordEnabled=t},expression:"isPasswordEnabled"}}),e._v(" "),e.isPasswordEnabled?r("span",{staticClass:"text-main"},[e._v("　密码由系统自动生成，请注意做好记录")]):e._e()],1),e._v(" "),r("el-form-item",{attrs:{label:"备注",prop:"note"}},[r("el-input",{attrs:{type:"textarea",resize:"none",autosize:{minRows:2},maxlength:"200","show-word-limit":""},model:{value:e.form.note,callback:function(t){e.$set(e.form,"note",t)},expression:"form.note"}}),e._v(" "),r("InfoBlock",{attrs:{title:"有意义的备注可以为将来提供可靠的参考"}})],1),e._v(" "),r("el-form-item",[r("div",{staticClass:"setup-right"},[r("el-button",{attrs:{type:"primary"},on:{click:e.submitData}},[e._v(e._s(e.modeName))])],1)])],1)],1)]),e._v(" "),r("el-col",{staticClass:"hidden-md-and-down",attrs:{span:9}})],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"脚本包已下载",visible:e.showPassword,"close-on-press-escape":!1,width:"750px"},on:{"update:visible":function(t){e.showPassword=t}}},[r("span",{staticClass:"import-token-dialog-content"},[e.password?[r("span",{staticClass:"text-bad"},[e._v("请牢记以下密码")]),e._v(" "),r("br"),r("span",{staticClass:"text-bad"},[e._v("导入脚本包时需要使用此密码才能正常导入")]),e._v(" "),r("br"),r("code",{staticClass:"import-token"},[e._v(e._s(e.password))]),e._v(" "),r("br"),r("CopyButton",{attrs:{title:"复制导入令牌",content:e.password}})]:[r("span",{staticClass:"text-good"},[e._v("导出的脚本包无需密码")]),e._v(" "),r("br"),r("span",{staticClass:"text-good"},[e._v("在后续导入本脚本包时，密码栏留空即可")])]],2),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.goToHistory}},[e._v("\n          "+e._s(e.$t("Very good"))+"\n        ")])],1)])],1)],1)},s=[],n=r("3835"),o=r("1da1"),i=(r("4e82"),r("a15b"),r("96cf"),r("21a6")),l=r.n(i),c={name:"ScriptSetExport",components:{},watch:{$route:{immediate:!0,handler:function(e,t){var r=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r.loadData();case 2:e.t0=r.T.setupPageMode(),e.next="export"===e.t0?5:6;break;case 5:return e.abrupt("break",6);case 6:case"end":return e.stop()}}),e)})))()}}},methods:{loadData:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r={query:{fields:["id","title"]}},t.next=3,e.T.callAPI_getAll("/api/v1/script-sets/do/list",r);case 3:if(a=t.sent,a.ok){t.next=6;break}return t.abrupt("return");case 6:return e.scriptSets=a.data,t.next=9,e.T.callAPI_getAll("/api/v1/data-sources/do/list",r);case 9:if(a=t.sent,a.ok){t.next=12;break}return t.abrupt("return");case 12:return e.dataSources=a.data,t.next=15,e.T.callAPI_getAll("/api/v1/env-variables/do/list",r);case 15:if(a=t.sent,a.ok){t.next=18;break}return t.abrupt("return");case 18:e.envVariables=a.data,e.$store.commit("updateLoadStatus",!0);case 20:case"end":return t.stop()}}),t)})))()},submitData:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$refs.form.validate();case 3:t.next=8;break;case 5:return t.prev=5,t.t0=t["catch"](0),t.abrupt("return",console.error(t.t0));case 8:t.t1=e.T.setupPageMode(),t.next="export"===t.t1?11:14;break;case 11:return t.next=13,e.exportData();case 13:return t.abrupt("return",t.sent);case 14:case"end":return t.stop()}}),t,null,[[0,5]])})))()},exportData:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,a,s,o,i,c,u,d,p,f,m,b;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r={respType:"blob",packResp:!0,body:e.T.jsonCopy(e.form),alert:{okMessage:e.$t("Data exported")}},a=null,!0===e.isPasswordEnabled&&(s=e.$store.getters.CONFIG("_FUNC_PKG_PASSWORD_LENGTH_RANGE_LIST"),o=parseInt(s[0]),i=parseInt(s[1]),c=[o,i].sort(),u=Object(n["a"])(c,2),o=u[0],i=u[1],d=o+parseInt(Math.random()*(i-o)),a=e.T.genRandString(d)),r.body.password=a,t.next=6,e.T.callAPI("post","/api/v1/script-sets/do/export",r);case 6:if(p=t.sent,p.ok){t.next=9;break}return t.abrupt("return");case 9:f=new Blob([p.data],{type:p.extra.contentType}),m=[e.$store.getters.CONFIG("_FUNC_PKG_EXPORT_FILENAME"),e.M().utcOffset("+08:00").format("YYYYMMDD_HHmmss")],b=m.join("-")+e.$store.getters.CONFIG("_FUNC_PKG_EXPORT_EXT"),l.a.saveAs(f,b),e.password=a,e.showPassword=!0;case 15:case"end":return t.stop()}}),t)})))()},goToHistory:function(){this.$router.push({name:"script-set-export-history-list"})}},computed:{modeName:function(){var e={export:"导出"};return e[this.T.setupPageMode()]}},props:{},data:function(){return{scriptSets:[],dataSources:[],envVariables:[],showPassword:!1,password:null,isPasswordEnabled:!1,form:{note:"",scriptSetIds:[],includeAuthLinks:!1,includeCrontabConfigs:!1,includeBatches:!1,dataSourceIds:[],envVariableIds:[]},formRules:{scriptSetIds:[{trigger:"change",message:"请选择导出脚本包",required:!0,type:"array",min:1}],note:[{trigger:"change",message:"请填写备注",required:!0,min:1}]}}}},u=c,d=(r("11fe6"),r("2877")),p=r("c856"),f=Object(d["a"])(u,a,s,!1,null,"94cc7c58",null);"function"===typeof p["default"]&&Object(p["default"])(f);t["default"]=f.exports},c856:function(e,t,r){"use strict";var a=r("d61f"),s=r.n(a);t["default"]=s.a},d61f:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"zh-CN":{"Data exported":"数据已导出"}}'),delete e.options._Ctor}}}]);