(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b148fb26"],{"06c5":function(t,e,r){"use strict";r.d(e,"a",(function(){return a}));r("fb6a"),r("d3b7"),r("b0c0"),r("a630"),r("3ca3"),r("ac1f"),r("00b4");var n=r("6b75");function a(t,e){if(t){if("string"===typeof t)return Object(n["a"])(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Object(n["a"])(t,e):void 0}}},"13df":function(t,e,r){},"21a6":function(t,e,r){(function(r){var n,a,o;(function(r,s){a=[],n=s,o="function"===typeof n?n.apply(e,a):n,void 0===o||(t.exports=o)})(0,(function(){"use strict";function e(t,e){return"undefined"==typeof e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}function n(t,e,r){var n=new XMLHttpRequest;n.open("GET",t),n.responseType="blob",n.onload=function(){c(n.response,e,r)},n.onerror=function(){console.error("could not download file")},n.send()}function a(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function o(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(n){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var s="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof r&&r.global===r?r:void 0,i=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=s.saveAs||("object"!=typeof window||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!i?function(t,e,r){var i=s.URL||s.webkitURL,c=document.createElement("a");e=e||t.name||"download",c.download=e,c.rel="noopener","string"==typeof t?(c.href=t,c.origin===location.origin?o(c):a(c.href)?n(t,e,r):o(c,c.target="_blank")):(c.href=i.createObjectURL(t),setTimeout((function(){i.revokeObjectURL(c.href)}),4e4),setTimeout((function(){o(c)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,r,s){if(r=r||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(e(t,s),r);else if(a(t))n(t,r,s);else{var i=document.createElement("a");i.href=t,i.target="_blank",setTimeout((function(){o(i)}))}}:function(t,e,r,a){if(a=a||open("","_blank"),a&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof t)return n(t,e,r);var o="application/octet-stream"===t.type,c=/constructor/i.test(s.HTMLElement)||s.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||o&&c||i)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var t=u.result;t=l?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=t:location=t,a=null},u.readAsDataURL(t)}else{var d=s.URL||s.webkitURL,f=d.createObjectURL(t);a?a.location=f:location.href=f,a=null,setTimeout((function(){d.revokeObjectURL(f)}),4e4)}});s.saveAs=c.saveAs=c,t.exports=c}))}).call(this,r("c8ba"))},3835:function(t,e,r){"use strict";function n(t){if(Array.isArray(t))return t}r.d(e,"a",(function(){return i}));r("a4d3"),r("e01a"),r("d3b7"),r("d28b"),r("3ca3"),r("ddb0");function a(t,e){var r=null==t?null:"undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,a,o=[],s=!0,i=!1;try{for(r=r.call(t);!(s=(n=r.next()).done);s=!0)if(o.push(n.value),e&&o.length===e)break}catch(c){i=!0,a=c}finally{try{s||null==r["return"]||r["return"]()}finally{if(i)throw a}}return o}}var o=r("06c5");r("d9e2");function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(t,e){return n(t)||a(t,e)||Object(o["a"])(t,e)||s()}},"4df4":function(t,e,r){"use strict";var n=r("0366"),a=r("c65b"),o=r("7b0b"),s=r("9bdd"),i=r("e95a"),c=r("68ee"),l=r("07fa"),u=r("8418"),d=r("9a1f"),f=r("35a1"),p=Array;t.exports=function(t){var e=o(t),r=c(this),b=arguments.length,m=b>1?arguments[1]:void 0,v=void 0!==m;v&&(m=n(m,b>2?arguments[2]:void 0));var h,w,_,g,x,y,k=f(e),O=0;if(!k||this===p&&i(k))for(h=l(e),w=r?new this(h):p(h);h>O;O++)y=v?m(e[O],O):e[O],u(w,O,y);else for(g=d(e,k),x=g.next,w=r?new this:[];!(_=a(x,g)).done;O++)y=v?s(g,m,[_.value,O],!0):_.value,u(w,O,y);return w.length=O,w}},"6b75":function(t,e,r){"use strict";function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}r.d(e,"a",(function(){return n}))},"9bdd":function(t,e,r){var n=r("825a"),a=r("2a62");t.exports=function(t,e,r,o){try{return o?e(n(r)[0],r[1]):e(r)}catch(s){a(t,"throw",s)}}},a630:function(t,e,r){var n=r("23e7"),a=r("4df4"),o=r("1c7e"),s=!o((function(t){Array.from(t)}));n({target:"Array",stat:!0,forced:s},{from:a})},ba92:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"fade"}},[e("el-container",{directives:[{name:"show",rawName:"v-show",value:t.$store.state.isLoaded,expression:"$store.state.isLoaded"}],attrs:{direction:"vertical"}},[e("el-header",{attrs:{height:"60px"}},[e("div",{staticClass:"page-header"},[e("span",[t._v(t._s(t.modeName)+"脚本包")]),t._v(" "),e("div",{staticClass:"header-control"},[e("el-button",{attrs:{size:"small"},on:{click:t.goToHistory}},[e("i",{staticClass:"fa fa-fw fa-history"}),t._v("\n            脚本包导出历史\n          ")])],1)])]),t._v(" "),e("el-main",[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:15}},[e("div",{staticClass:"export-form"},[e("el-form",{ref:"form",attrs:{"label-width":"120px",model:t.form,rules:t.formRules}},[e("el-form-item",{attrs:{label:"脚本集",prop:"scriptSetIds"}},[e("el-select",{attrs:{multiple:"",filterable:"","filter-method":t.doScriptSetFilter,placeholder:"请选择"},model:{value:t.form.scriptSetIds,callback:function(e){t.$set(t.form,"scriptSetIds",e)},expression:"form.scriptSetIds"}},t._l(t.selectScriptSetOptions,(function(r){return e("el-option",{key:r.id,attrs:{label:r.title||r.id,value:r.id}},[e("span",{staticClass:"select-item-name"},[t._v(t._s(r.title||r.id))]),t._v(" "),e("code",{staticClass:"select-item-id"},[t._v("ID: "+t._s(r.id))])])})),1)],1),t._v(" "),e("el-form-item",{attrs:{label:"脚本集关联数据"}},[e("el-checkbox",{attrs:{size:"medium",border:"",label:"授权链接"},model:{value:t.form.includeAuthLinks,callback:function(e){t.$set(t.form,"includeAuthLinks",e)},expression:"form.includeAuthLinks"}}),t._v(" "),e("el-checkbox",{attrs:{size:"medium",border:"",label:"自动触发配置"},model:{value:t.form.includeCrontabConfigs,callback:function(e){t.$set(t.form,"includeCrontabConfigs",e)},expression:"form.includeCrontabConfigs"}}),t._v(" "),e("el-checkbox",{attrs:{size:"medium",border:"",label:"批处理"},model:{value:t.form.includeBatches,callback:function(e){t.$set(t.form,"includeBatches",e)},expression:"form.includeBatches"}}),t._v(" "),e("InfoBlock",{attrs:{title:"系统会自动查找导出脚本集相关的数据，并在导入时替换脚本集关联的所有数据"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"连接器",prop:"connectorIds"}},[e("el-select",{attrs:{multiple:"",filterable:"","filter-method":t.doConnectorFilter,placeholder:"请选择"},model:{value:t.form.connectorIds,callback:function(e){t.$set(t.form,"connectorIds",e)},expression:"form.connectorIds"}},t._l(t.selectConnectorOptions,(function(r){return e("el-option",{key:r.id,attrs:{label:r.title||r.id,value:r.id}},[e("span",{staticClass:"select-item-name"},[t._v(t._s(r.title||r.id))]),t._v(" "),e("code",{staticClass:"select-item-id"},[t._v("ID: "+t._s(r.id))])])})),1),t._v(" "),t.T.isNothing(t.form.connectorIds)?t._e():e("InfoBlock",{attrs:{type:"warning",title:"导出的连接器不包含密码等敏感信息，导入后需要重新输入这些内容"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"环境变量",prop:"envVariableIds"}},[e("el-select",{attrs:{multiple:"",filterable:"","filter-method":t.doEnvVariableFilter,placeholder:"请选择"},model:{value:t.form.envVariableIds,callback:function(e){t.$set(t.form,"envVariableIds",e)},expression:"form.envVariableIds"}},t._l(t.selectEnvVariableOptions,(function(r){return e("el-option",{key:r.id,attrs:{label:r.title||r.id,value:r.id}},[e("span",{staticClass:"select-item-name"},[t._v(t._s(r.title||r.id))]),t._v(" "),e("code",{staticClass:"select-item-id"},[t._v("ID: "+t._s(r.id))])])})),1)],1),t._v(" "),e("el-form-item",{attrs:{label:"启用密码"}},[e("el-switch",{attrs:{"active-value":!0,"inactive-value":!1},model:{value:t.isPasswordEnabled,callback:function(e){t.isPasswordEnabled=e},expression:"isPasswordEnabled"}}),t._v(" "),t.isPasswordEnabled?e("span",{staticClass:"text-main"},[t._v("　密码由系统自动生成，请注意做好记录")]):t._e()],1),t._v(" "),e("el-form-item",{attrs:{label:"备注",prop:"note"}},[e("el-input",{attrs:{type:"textarea",resize:"none",autosize:{minRows:2},maxlength:"200","show-word-limit":""},model:{value:t.form.note,callback:function(e){t.$set(t.form,"note",e)},expression:"form.note"}}),t._v(" "),e("InfoBlock",{attrs:{title:"有意义的备注可以为将来提供可靠的参考"}})],1),t._v(" "),e("el-form-item",[e("div",{staticClass:"setup-right"},[e("el-button",{directives:[{name:"prevent-re-click",rawName:"v-prevent-re-click"}],attrs:{type:"primary"},on:{click:t.submitData}},[t._v(t._s(t.modeName))])],1)])],1)],1)]),t._v(" "),e("el-col",{staticClass:"hidden-md-and-down",attrs:{span:9}})],1)],1),t._v(" "),e("el-dialog",{attrs:{title:"脚本包已下载",visible:t.showPassword,"close-on-press-escape":!1,"close-on-click-modal":!1,width:"750px"},on:{"update:visible":function(e){t.showPassword=e}}},[e("span",{staticClass:"import-token-dialog-content"},[t.password?[e("span",{staticClass:"text-bad"},[t._v("请牢记以下密码")]),t._v(" "),e("br"),e("span",{staticClass:"text-bad"},[t._v("导入脚本包时需要使用此密码才能正常导入")]),t._v(" "),e("br"),e("code",{staticClass:"import-token"},[t._v(t._s(t.password))]),t._v(" "),e("br"),e("CopyButton",{attrs:{title:"复制导入令牌",content:t.password}})]:[e("span",{staticClass:"text-good"},[t._v("导出的脚本包无需密码")]),t._v(" "),e("br"),e("span",{staticClass:"text-good"},[t._v("在后续导入本脚本包时，密码栏留空即可")])]],2),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.goToHistory}},[t._v("\n          "+t._s(t.$t("Very good"))+"\n        ")])],1)])],1)],1)},a=[],o=r("3835"),s=r("c7eb"),i=r("1da1"),c=(r("d3b7"),r("159b"),r("4e82"),r("a15b"),r("498a"),r("4de4"),r("21a6")),l=r.n(c),u={name:"ScriptSetExport",components:{},watch:{$route:{immediate:!0,handler:function(t,e){var r=this;return Object(i["a"])(Object(s["a"])().mark((function t(){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,r.loadData();case 2:t.t0=r.T.setupPageMode(),t.next="export"===t.t0?5:6;break;case 5:return t.abrupt("break",6);case 6:case"end":return t.stop()}}),t)})))()}}},methods:{loadData:function(){var t=this;return Object(i["a"])(Object(s["a"])().mark((function e(){var r,n,a,o,i;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={query:{fields:["id","title"]}},e.next=3,t.T.callAPI_getAll("/api/v1/script-sets/do/list",r);case 3:if(n=e.sent,n.ok){e.next=6;break}return e.abrupt("return");case 6:return a=n.data,a.forEach((function(e){e.searchTEXT=t.T.getSearchTEXT(e,["id","title"])})),t.scriptSets=a,t.selectScriptSetOptions=a,e.next=12,t.T.callAPI_getAll("/api/v1/connectors/do/list",r);case 12:if(n=e.sent,n.ok){e.next=15;break}return e.abrupt("return");case 15:return o=n.data,o.forEach((function(e){e.searchTEXT=t.T.getSearchTEXT(e,["id","title"])})),t.connectors=o,t.selectConnectorOptions=o,e.next=21,t.T.callAPI_getAll("/api/v1/env-variables/do/list",r);case 21:if(n=e.sent,n.ok){e.next=24;break}return e.abrupt("return");case 24:i=n.data,i.forEach((function(e){e.searchTEXT=t.T.getSearchTEXT(e,["id","title"])})),t.envVariables=i,t.selectEnvVariableOptions=i,t.$store.commit("updateLoadStatus",!0);case 29:case"end":return e.stop()}}),e)})))()},submitData:function(){var t=this;return Object(i["a"])(Object(s["a"])().mark((function e(){return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$refs.form.validate();case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e["catch"](0),e.abrupt("return",console.error(e.t0));case 8:e.t1=t.T.setupPageMode(),e.next="export"===e.t1?11:14;break;case 11:return e.next=13,t.exportData();case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e,null,[[0,5]])})))()},exportData:function(){var t=this;return Object(i["a"])(Object(s["a"])().mark((function e(){var r,n,a,i,c,u,d,f,p,b,m,v;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={respType:"blob",packResp:!0,body:t.T.jsonCopy(t.form),alert:{okMessage:t.$t("Data exported")}},n=null,!0===t.isPasswordEnabled&&(a=t.$store.getters.CONFIG("_FUNC_PKG_PASSWORD_LENGTH_RANGE_LIST"),i=parseInt(a[0]),c=parseInt(a[1]),u=[i,c].sort(),d=Object(o["a"])(u,2),i=d[0],c=d[1],f=i+parseInt(Math.random()*(c-i)),n=t.T.genRandString(f)),r.body.password=n,e.next=6,t.T.callAPI("post","/api/v1/script-sets/do/export",r);case 6:if(p=e.sent,p.ok){e.next=9;break}return e.abrupt("return");case 9:b=new Blob([p.data],{type:p.extra.contentType}),m=[t.$store.getters.CONFIG("_FUNC_PKG_EXPORT_FILENAME"),t.M().utcOffset("+08:00").format("YYYYMMDD_HHmmss")],v=m.join("-")+t.$store.getters.CONFIG("_FUNC_PKG_EXPORT_EXT"),l.a.saveAs(b,v),t.password=n,t.showPassword=!0;case 15:case"end":return e.stop()}}),e)})))()},goToHistory:function(){this.$router.push({name:"script-set-export-history-list"})},doScriptSetFilter:function(t){t=(t||"").toLowerCase().trim(),this.selectScriptSetOptions=t?this.scriptSets.filter((function(e){return e.searchTEXT.indexOf(t)>=0})):this.scriptSets},doConnectorFilter:function(t){t=(t||"").toLowerCase().trim(),this.selectConnectorOptions=t?this.connectors.filter((function(e){return e.searchTEXT.indexOf(t)>=0})):this.connectors},doEnvVariableFilter:function(t){t=(t||"").toLowerCase().trim(),this.selectEnvVariableOptions=t?this.envVariables.filter((function(e){return e.searchTEXT.indexOf(t)>=0})):this.envVariables}},computed:{modeName:function(){var t={export:"导出"};return t[this.T.setupPageMode()]}},props:{},data:function(){return{scriptSets:[],connectors:[],envVariables:[],selectScriptSetOptions:[],selectConnectorOptions:[],selectEnvVariableOptions:[],showPassword:!1,password:null,isPasswordEnabled:!1,form:{note:"",scriptSetIds:[],includeAuthLinks:!1,includeCrontabConfigs:!1,includeBatches:!1,connectorIds:[],envVariableIds:[]},formRules:{scriptSetIds:[{trigger:"change",message:"请选择导出脚本包",required:!0,type:"array",min:1}],note:[{trigger:"change",message:"请填写备注",required:!0,min:1}]}}}},d=u,f=(r("cd0a"),r("2877")),p=r("c856"),b=Object(f["a"])(d,n,a,!1,null,"c0a73514",null);"function"===typeof p["default"]&&Object(p["default"])(b);e["default"]=b.exports},c856:function(t,e,r){"use strict";var n=r("d61f"),a=r.n(n);e["default"]=a.a},cd0a:function(t,e,r){"use strict";r("13df")},d61f:function(t,e){t.exports=function(t){t.options.__i18n=t.options.__i18n||[],t.options.__i18n.push('{"zh-CN":{"Data exported":"数据已导出"}}'),delete t.options._Ctor}}}]);