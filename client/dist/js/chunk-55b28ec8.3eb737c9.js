(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-55b28ec8"],{"06a7":function(e,t,a){},"146c":function(e,t,a){},"16d6":function(e,t,a){},"1d9a":function(e,t,a){"use strict";a("af92")},"238f":function(e,t,a){"use strict";a("c4dd")},"23e9":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"zh-CN":{"Query Data Source":"查询数据源","Browse Data Source":"浏览数据源"}}'),delete e.options._Ctor}},"27b7":function(e,t,a){},"2df5":function(e,t,a){e.exports=a("5a8e")(1708)},"316f":function(e,t,a){"use strict";a("453c")},"33b0":function(e,t,a){"use strict";a("e621")},4209:function(e,t,a){"use strict";a("27b7")},"453c":function(e,t,a){},"49d7":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("split-pane",{ref:"vueSplitPane",attrs:{"min-percent":0,"default-percent":20,split:"vertical"},on:{resize:e.resizeVueSplitPane}},[a("template",{slot:"paneL"},[a("div",{staticClass:"aside"},[a("div",{staticClass:"aside-content"},[a("i",{staticClass:"icon-bg",class:e.currentTabIcon}),e._v(" "),a("el-tabs",{attrs:{stretch:"",type:"border-card"},model:{value:e.currentTab,callback:function(t){e.currentTab=t},expression:"currentTab"}},[a("el-tab-pane",{attrs:{label:e.$t("Script Lib"),name:"aside-script"}},[a("AsideScript",{ref:"asideScript"})],1),e._v(" "),a("el-tab-pane",{attrs:{label:e.$t("Data Source"),name:"aside-data-source"}},[a("AsideDataSource",{ref:"asideDataSource"})],1),e._v(" "),a("el-tab-pane",{attrs:{label:e.$t("ENV"),name:"aside-env-variable"}},[a("AsideEnvVariable",{ref:"asideEnvVariable"})],1)],1)],1)])]),e._v(" "),a("template",{slot:"paneR"},[a("router-view")],1)],2)},s=[],i=(a("e5ac"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-input",{attrs:{placeholder:e.$t("filter content"),size:"small",clearable:!0},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}},[a("el-button",{attrs:{slot:"prefix",type:"text"},slot:"prefix"})],1),e._v(" "),a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tree",attrs:{data:e.data,"filter-node-method":e.filterNode,"highlight-current":!0,"default-expand-all":!1,"default-expanded-keys":e.defaultExpandedNodeKeys,"auto-expand-parent":!1,"expand-on-click-node":!1,indent:10,"node-key":"id"},on:{"node-expand":e.onExpandNode,"node-collapse":e.onCollapseNode},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,s=t.data;return a("span",{staticClass:"aside-tree-node",attrs:{"entry-id":s.id},on:{click:function(t){return e.openEntity(r,s)}}},[a("span",["refresh"===s.type?a("el-link",{attrs:{type:"primary",underline:!1}},[a("i",{staticClass:"fa fa-fw fa-refresh"}),e._v(" "+e._s(e.$t("Refresh"))+"\n        ")]):"addScriptSet"===s.type?a("el-link",{attrs:{type:"primary",underline:!1}},[a("i",{staticClass:"fa fa-fw fa-plus"}),e._v(" "+e._s(e.$t("Add Script Set"))+"\n        ")]):a("div",["scriptSet"===s.type?a("i",{staticClass:"fa fa-fw",class:[r.expanded?"fa-folder-open-o":"fa-folder-o"]}):"script"===s.type?a("i",{staticClass:"fa fa-fw fa-file-code-o"}):"func"===s.type?a("el-tag",{attrs:{type:"info",size:"mini"}},[a("code",[e._v("def")])]):e._e(),e._v(" "),a("span",[s.isCodeEdited?a("el-tag",{attrs:{effect:"dark",type:"danger",size:"mini"}},[e._v(e._s(e.$t("Edited")))]):e._e(),e._v(" "),s.isBuiltin?a("el-tag",{attrs:{effect:"dark",type:"warning",size:"mini"}},[e._v(e._s(e.$t("Builtin")))]):e._e(),e._v(" "),a("span",{class:{"text-watch":s.isBuiltin}},[e._v(e._s(r.label))]),e._v(" "),s.childrenCount?a("span",{staticClass:"child-nodes-count"},[e._v(" ("+e._s(s.childrenCount)+")")]):e._e()],1)],1)],1),e._v(" "),a("div",[a("el-tooltip",{attrs:{effect:"dark",content:s.isLockedByOther?e.$t("Locked by someone else"):e.$t("Locked by you"),placement:"top",enterable:!1}},[s.isLocked?a("i",{staticClass:"fa fa-fw fa-lock",class:s.isLockedByOther?"text-bad":"text-good"}):e._e()]),e._v(" "),"scriptSet"===s.type?a("el-tooltip",{attrs:{effect:"dark",content:e.$t("Add Script"),placement:"top",enterable:!1}},[a("span",[a("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.openEntity(r,s,"add")}}},[a("i",{staticClass:"fa fa-fw fa-plus text-main"})])],1)]):e._e(),e._v(" "),a("el-tooltip",{attrs:{effect:"dark",content:e.$t("Quick View Panel"),placement:"top",enterable:!1}},[a("span",["script"===s.type?a("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.showQuickViewWindow(s.id)}}},[a("i",{staticClass:"fa fa-fw fa-window-restore text-info"})]):e._e()],1)]),e._v(" "),a("el-tooltip",{attrs:{effect:"dark",content:s.isLockedByOther?e.$t("View"):e.$t("Setup"),placement:"top",enterable:!1}},[a("span",["scriptSet"===s.type?a("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.openEntity(r,s,"setup")}}},[s.isLockedByOther?a("i",{staticClass:"fa fa-fw fa-search text-info"}):a("i",{staticClass:"fa fa-fw fa-wrench text-info"})]):e._e(),e._v(" "),"script"===s.type?a("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.openEntity(r,s,"setup")}}},[s.isLockedByOther?a("i",{staticClass:"fa fa-fw fa-search text-info"}):a("i",{staticClass:"fa fa-fw fa-wrench text-info"})]):e._e()],1)]),e._v(" "),s.id?a("el-popover",{attrs:{placement:"right-start",trigger:"click","popper-class":"aside-tip",value:e.showPopoverId===s.id}},[a("div",{staticClass:"aside-tree-node-description"},[s.title?a("code",[e._v(e._s(s.title)+" (ID: "+e._s(s.id)+")")]):a("code",[e._v(e._s(s.id))]),e._v(" "),s.description?a("pre",[e._v(e._s(s.description))]):e._e()]),e._v(" "),s.sampleCode?[a("div",{staticClass:"aside-tree-node-sample-code"},[e._v("\n              "+e._s(e.$t("Example"))+e._s(e.$t(":"))+"\n              "),a("pre",[e._v(e._s(s.sampleCode))])])]:e._e(),e._v(" "),a("br"),a("CopyButton",{attrs:{title:e.$t("Copy {name} ID",{name:e.C.ASIDE_ITEM_TYPE_MAP.get(s.type).name}),content:s.id}}),e._v(" "),a("br"),s.sampleCode?a("CopyButton",{attrs:{title:e.$t("Copy example"),content:s.sampleCode}}):e._e(),e._v(" "),a("br"),"script"===s.type?a("el-button",{staticClass:"aside-tree-node-quick-view",attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.showQuickViewWindow(s.id)}}},[a("i",{staticClass:"fa fa-fw fa-window-restore"}),e._v(" "+e._s(e.$t("Open Quick View Panel"))+"\n          ")]):e._e(),e._v(" "),s.isCodeEdited?[a("div",{staticClass:"code-edited-tip"},[a("span",{staticClass:"text-bad"},[e._v(e._s(e.$t("Code edited but not published yet"))),a("br"),e._v(e._s(e.$t("Import/Calling will run the published version")))])])]:e._e(),e._v(" "),a("el-button",{attrs:{slot:"reference",type:"text"},on:{click:function(t){return t.stopPropagation(),e.showPopover(s.id)}},slot:"reference"},[a("i",{staticClass:"fa fa-fw fa-question-circle"})])],2):e._e()],1)])}}])}),e._v(" "),a("QuickViewWindow",{ref:"quickViewWindow"})],1)}),n=[],o=a("a6db"),d=(a("672e"),a("ff7f"),a("e756"),a("3062"),a("ba98"),a("fbe6"),a("bd06"),a("d44b"),a("60da"),a("977b"),a("7a8b"),a("bbe9"),a("8d65"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"show",rawName:"v-show",value:e.show&&e.script,expression:"show && script"}],staticClass:"quick-view-window",class:{"quick-view-window-no-scoll":e.isDragging},style:{top:e.showPosition.top+"px",left:e.showPosition.left+"px"},attrs:{id:"quickViewWindow"}},[a("div",{staticClass:"quick-view-header",on:{mousedown:e.startDrag}},[a("span",{staticClass:"quick-view-title"},[a("span",[e._v(e._s(e.script.title||e.script.id))])]),e._v(" "),a("el-link",{staticClass:"quick-view-close",on:{click:function(t){return t.stopPropagation(),e.hideWindow()}},nativeOn:{mousedown:function(e){e.stopPropagation()}}},[a("i",{staticClass:"fa fa-times"}),e._v(" "+e._s(e.$t("Close")))])],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.isDragging,expression:"isDragging"}],staticClass:"quick-view-dragging-cover"},[a("span",{staticClass:"quick-view-dragging-cover-tip"},[e._v(e._s(e.$t("Drag to place")))])]),e._v(" "),a("el-tabs",{attrs:{"tab-position":"bottom",type:"border-card"},model:{value:e.selectedTab,callback:function(t){e.selectedTab=t},expression:"selectedTab"}},[a("el-tab-pane",{attrs:{label:e.$t("Published"),name:"code"}},[a("div",{staticClass:"quick-view-code"},[a("textarea",{attrs:{id:"quickView_code"}})])]),e._v(" "),a("el-tab-pane",{attrs:{label:e.$t("Draft"),name:"codeDraft"}},[a("div",{staticClass:"quick-view-code"},[a("textarea",{attrs:{id:"quickView_codeDraft"}})])])],1)],1)}),c=[],l={name:"QuickViewWindow",components:{},watch:{selectedTab:function(e){var t=this;setImmediate((function(){switch(e){case"code":t.codeMirror_code.refresh();break;case"codeDraft":t.codeMirror_codeDraft.refresh();break}}))}},methods:{showWindow:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.T.callAPI_get("/api/v1/scripts/:id/do/get",{params:{id:e}});case 2:if(r=a.sent,r.ok){a.next=5;break}return a.abrupt("return");case 5:t.show||t.$message({type:"warning",duration:3e3,message:"快速查看窗口仅在脚本侧边栏激活时显示，拖拽标题栏可以移动位置"}),t.script=r.data,t.show=!0,t.selectedTab="code",setImmediate((function(){t.fixShowPosition(),t.codeMirror_code||(t.codeMirror_code=t.T.initCodeMirror("quickView_code"),t.codeMirror_code.setOption("theme",t.T.getCodeMirrorThemeName()),t.T.setCodeMirrorReadOnly(t.codeMirror_code,!0)),t.codeMirror_codeDraft||(t.codeMirror_codeDraft=t.T.initCodeMirror("quickView_codeDraft"),t.codeMirror_codeDraft.setOption("theme",t.T.getCodeMirrorThemeName()),t.T.setCodeMirrorReadOnly(t.codeMirror_codeDraft,!0)),t.codeMirror_code.setValue(""),t.codeMirror_code.setValue(t.script.code||""),t.T.setCodeMirror(t.codeMirror_code,"python"),t.codeMirror_code.refresh(),t.codeMirror_codeDraft.setValue(""),t.codeMirror_codeDraft.setValue(t.script.codeDraft||""),t.T.setCodeMirror(t.codeMirror_codeDraft,"python"),t.codeMirror_codeDraft.refresh()}));case 10:case"end":return a.stop()}}),a)})))()},hideWindow:function(){this.show=!1},startDrag:function(e){var t=this,a=document.getElementById("quickViewWindow"),r=e.screenX-a.offsetLeft,s=e.screenY-a.offsetTop;this.isDragging=!0,document.onmousemove=function(i){var n=(i||e).screenX-r,o=(i||e).screenY-s,d=window.innerWidth-a.offsetWidth-10,c=window.innerHeight-a.offsetHeight-10;n<0&&(n=0),o<0&&(o=0),n>d&&(n=d),o>c&&(o=c);var l={left:n,top:o};t.dragPosition=l,t.$store.commit("updateAsideScript_quickViewWindowPosition",t.dragPosition),t.fixShowPosition()},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null,t.isDragging=!1}},fixShowPosition:function(){var e={top:this.dragPosition.top,left:this.dragPosition.left},t=document.getElementById("quickViewWindow");if(t){var a=window.innerWidth-t.offsetWidth-10,r=window.innerHeight-t.offsetHeight-10;e.left<0&&(e.left=0),e.top<0&&(e.top=0),e.left>a&&(e.left=a),e.top>r&&(e.top=r),this.showPosition=e}}},computed:{},props:{},data:function(){var e=this.$store.state.asideScript_quickViewWindowPosition||{left:10,top:10};return{show:!1,selectedTab:"code",showPosition:this.T.jsonCopy(e),dragPosition:this.T.jsonCopy(e),isDragging:!1,script:{},codeMirror_code:null,codeMirror_codeDraft:null}},mounted:function(){window.addEventListener("resize",this.fixShowPosition,!1)},destroyed:function(){window.removeEventListener("resize",this.fixShowPosition,!1)}},u=l,p=(a("33b0"),a("aa16"),a("0620")),f=a("ce37"),b=Object(p["a"])(u,d,c,!1,null,"1409a782",null);"function"===typeof f["default"]&&Object(f["default"])(b);var m=b.exports,h={name:"AsideScript",components:{QuickViewWindow:m},watch:{$route:function(){this.showPopoverId=null},filterText:function(e){this.$refs.tree.filter(e)},"$store.state.scriptListSyncTime":function(){this.loadData()},expandedNodeMap:function(e){this.$store.commit("updateAsideScript_expandedNodeMap",e)},highlightedFuncId:function(e){this.$refs.tree.setCurrentKey(e)}},methods:{filterNode:function(e,t){if(!e)return!0;if(["addScriptSet","refresh"].indexOf(t.type)>=0)return!0;var a=(""+e).toLowerCase(),r=(""+t.searchTEXT).toLowerCase();return"+"===a?t.isCodeEdited:r.indexOf(a)>=0},onExpandNode:function(e,t){this.$set(this.expandedNodeMap,e.id,!0)},onCollapseNode:function(e,t){this.$delete(this.expandedNodeMap,e.id)},loadData:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,r,s,i,n,o,d,c,l,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.T.isNothing(e.data)&&(e.loading=!0),a={},r={},s={},i={},{},{},t.next=9,e.T.callAPI_getAll("/api/v1/script-sets/do/list",{query:{fields:["id","title","description","isLocked","lockedByUserId","isBuiltin"]}});case 9:if(n=t.sent,n.ok){t.next=12;break}return t.abrupt("return");case 12:return n.data.forEach((function(t){a[t.id]="scriptSet",t.description=e.T.limitLines(t.description,10);var s=t.lockedByUserId&&t.lockedByUserId!==e.$store.getters.userId;r[t.id]={id:t.id,label:t.title||t.id,type:"scriptSet",isLocked:t.isLocked,isLockedByOther:s,isBuiltin:t.isBuiltin,searchTEXT:"".concat(t.title," ").concat(t.id),title:t.title,description:t.description,children:[]}})),t.next=15,e.T.callAPI_getAll("/api/v1/scripts/do/list",{query:{fields:["id","title","description","scriptSetId","codeMD5","codeDraftMD5","isLocked","lockedByUserId","sset_lockedByUserId"]}});case 15:if(n=t.sent,n.ok){t.next=18;break}return t.abrupt("return");case 18:return window._DFF_scriptIds=[],n.data.forEach((function(t){window._DFF_scriptIds.push(t.id),a[t.id]="script",t.description=e.T.limitLines(t.description,10);var i=t.codeMD5!==t.codeDraftMD5,n=t.lockedByUserId&&t.lockedByUserId!==e.$store.getters.userId||t.sset_lockedByUserId&&t.sset_lockedByUserId!==e.$store.getters.userId,o=t.id.split("__").slice(1).join("__"),d="import ".concat(t.id," as ").concat(o);s[t.id]={id:t.id,scriptSetId:t.scriptSetId,label:t.title||t.id,type:"script",isLocked:t.isLocked,isCodeEdited:i,isLockedByOther:n,searchTEXT:"".concat(t.title," ").concat(t.id),title:t.title,description:t.description,sampleCode:d,children:[]},r[t.scriptSetId]&&r[t.scriptSetId].children.push(s[t.id])})),t.next=22,e.T.callAPI_getAll("/api/v1/funcs/do/list",{query:{fields:["id","title","description","definition","scriptSetId","scriptId","sset_type","integration","extraConfigJSON"]}});case 22:if(n=t.sent,n.ok){t.next=25;break}return t.abrupt("return");case 25:for(c in window._DFF_funcIds=[],n.data.forEach((function(t){window._DFF_funcIds.push(t.id),a[t.id]="func",t.description=e.T.limitLines(t.description,10);var r=t.scriptId.split("__").slice(1).join("__"),n="import ".concat(t.scriptId," as ").concat(r,"\n").concat(r,".").concat(t.definition);i[t.id]={id:t.id,scriptSetId:t.scriptSetId,scriptId:t.scriptId,label:t.title||t.id,type:"func",definition:t.definition,searchTEXT:"".concat(t.title," ").concat(t.id),title:t.title,description:t.description,sampleCode:n,disabled:!e.$store.state.codeEditor_isCodeLoaded,integration:t.integration,extraConfigJSON:t.extraConfigJSON},s[t.scriptId]&&s[t.scriptId].children.push(i[t.id])})),o=Object.values(r),o.forEach((function(t){e.T.isNothing(t.children)||(t.childrenCount=t.children.filter((function(e){return"script"===e.type})).length),t.children.sort(e.T.asideItemSorter),t.children.forEach((function(t){e.T.isNothing(t.children)||(t.childrenCount=t.children.filter((function(e){return"func"===e.type})).length)}))})),o.sort(e.T.asideItemSorter),o.unshift({type:"addScriptSet"}),o.unshift({type:"refresh"}),d=e.T.jsonCopy(e.$store.state.asideScript_expandedNodeMap),d)a[c]||delete d[c];for(l in e.$store.commit("updateAsideScript_expandedNodeMap",d),d=e.T.jsonCopy(e.$store.state.codeEditor_highlightedLineConfigMap),d)s[l]&&!e.T.isNothing(d[l])||delete d[l];for(u in e.$store.commit("updateCodeEditor_highlightedLineConfigMap",d),d=e.T.jsonCopy(e.$store.state.codeViewer_highlightedLineConfigMap),d)s[u]&&!e.T.isNothing(d[u])||delete d[u];e.$store.commit("updateCodeViewer_highlightedLineConfigMap",d),e.loading=!1,e.data=o,e.expandedNodeMap=e.$store.state.asideScript_expandedNodeMap||{},e.defaultExpandedNodeKeys=Object.keys(e.expandedNodeMap),setImmediate((function(){e.$refs.tree&&e.$refs.tree.setCurrentKey(e.$store.state.asideScript_currentNodeKey||null)})),setTimeout((function(){if(e.$refs.tree){var t=e.$refs.tree.getCurrentKey();if(t){var a=document.getElementById("pane-aside-script").parentElement,r=document.querySelector('[entry-id="'.concat(t,'"]')),s=r.offsetTop-a.offsetHeight/2+100;a.scrollTo({top:s,behavior:"smooth"})}}}),500);case 47:case"end":return t.stop()}}),t)})))()},showQuickViewWindow:function(e){this.$refs.quickViewWindow.showWindow(e)},showPopover:function(e){var t=this;setImmediate((function(){t.showPopoverId=e}))},expandNode:function(e){var t=this;this.$set(this.expandedNodeMap,e,!0),setImmediate((function(){t.$refs.tree.getNode(e).expanded=!0}))},openEntity:function(e,t,a){var r=this;"setup"===a&&this.$refs.tree.setCurrentKey(t.id);var s=function(e){"code-editor"===r.$route.name&&r.$route.params.id!==e&&r.$store.commit("updateCodeEditor_isCodeLoaded",!1)};switch(t.type){case"refresh":this.loadData();break;case"addScriptSet":this.$router.push({name:"script-set-add"});break;case"scriptSet":"add"===a?this.$router.push({name:"script-add",params:{id:t.id}}):"setup"===a&&this.$router.push({name:"script-set-setup",params:{id:t.id}}),this.expandNode(t.id);break;case"script":"setup"===a?this.$router.push({name:"script-setup",params:{id:t.id}}):("code-viewer"!==this.$route.name&&"code-editor"!==this.$route.name||t.id!==this.$route.params.id)&&(s(t.id),this.$router.push({name:"code-viewer",params:{id:t.id}}),this.expandNode(t.id));break;case"func":s(t.scriptId),("code-viewer"!==this.$route.name&&"code-editor"!==this.$route.name||t.scriptId!==this.$route.params.id)&&this.$router.push({name:"code-viewer",params:{id:t.scriptId}});break;default:console.error("Unexcepted data type: ".concat(t.type));break}this.$store.commit("updateAsideScript_currentNodeKey",t.id),this.$store.commit("updateEditor_highlightedFuncId","func"===t.type?t.id:null)}},computed:{highlightedFuncId:function(){switch(this.$route.name){case"code-editor":case"code-viewer":return this.$store.state.Editor_highlightedFuncId;default:return null}}},props:{},data:function(){return{loading:!1,filterText:"",data:[],expandedNodeMap:{},defaultExpandedNodeKeys:[],showPopoverId:null}},created:function(){this.loadData()}},_=h,E=(a("238f"),a("d178")),y=Object(p["a"])(_,i,n,!1,null,"a2196b08",null);"function"===typeof E["default"]&&Object(E["default"])(y);var v=y.exports,g=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-input",{attrs:{placeholder:e.$t("filter content"),size:"small",clearable:!0},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}},[a("el-button",{attrs:{slot:"prefix",type:"text"},slot:"prefix"})],1),e._v(" "),a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tree",attrs:{data:e.data,"filter-node-method":e.filterNode,"highlight-current":!0,indent:10,"node-key":"id"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,s=t.data;return a("span",{staticClass:"aside-tree-node",on:{click:function(t){return e.openEntity(r,s)}}},[a("span",["refresh"===s.type?a("el-link",{attrs:{type:"primary",underline:!1}},[a("i",{staticClass:"fa fa-fw fa-refresh"}),e._v(" "+e._s(e.$t("Refresh"))+"\n        ")]):"addDataSource"===s.type?a("el-link",{attrs:{type:"primary",underline:!1}},[a("i",{staticClass:"fa fa-fw fa-plus"}),e._v(" "+e._s(e.$t("Add Data Source"))+"\n        ")]):a("div",[a("el-tag",{staticClass:"aside-tree-node-tag",attrs:{type:e.C.DATA_SOURCE_MAP.get(s.dataSourceType).tagType,size:"mini"}},[a("span",[e._v(e._s(e.C.DATA_SOURCE_MAP.get(s.dataSourceType).name))])]),e._v(" "),a("span",{class:{builtin:s.isBuiltin}},[e._v(e._s(r.label))])],1)],1),e._v(" "),"dataSource"===s.type?a("div",[a("el-tooltip",{attrs:{effect:"dark",content:e.$t("Simple Debug Panel"),placement:"left",enterable:!1}},[a("span",[e.C.DATA_SOURCE_MAP.get(s.dataSourceType).debugSupported?a("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.showSimpleDebugWindow(s.dataSource)}}},[a("i",{staticClass:"fa fa-fw fa-window-restore text-info"})]):e._e()],1)]),e._v(" "),a("el-tooltip",{attrs:{effect:"dark",content:s.isBuiltin?e.$t("View"):e.$t("Setup"),placement:"top",enterable:!1}},[a("span",["addDataSource"!==s.type?a("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.openEntity(r,s,"setup")}}},[s.isBuiltin?a("i",{staticClass:"fa fa-fw fa-search text-info"}):a("i",{staticClass:"fa fa-fw fa-wrench text-info"})]):e._e()],1)]),e._v(" "),s.id?a("el-popover",{attrs:{placement:"right-start",trigger:"click","popper-class":"aside-tip",value:e.showPopoverId===s.id}},[a("div",{staticClass:"aside-tree-node-description"},[a("code",[e._v(e._s(s.title||s.id))]),e._v(" "),s.description?a("pre",[e._v(e._s(s.description))]):e._e()]),e._v(" "),s.sampleCode?[a("div",{staticClass:"aside-tree-node-sample-code"},[e._v("\n              "+e._s(e.$t("Example"))+e._s(e.$t(":"))+"\n              "),a("pre",[e._v(e._s(s.sampleCode))])])]:e._e(),e._v(" "),a("br"),a("CopyButton",{attrs:{title:e.$t("Copy {name} ID",{name:e.C.ASIDE_ITEM_TYPE_MAP.get(s.type).name}),content:s.id}}),e._v(" "),a("br"),s.sampleCode?a("CopyButton",{attrs:{title:e.$t("Copy example"),content:s.sampleCode}}):e._e(),e._v(" "),a("br"),e.C.DATA_SOURCE_MAP.get(s.dataSourceType).debugSupported?a("el-button",{staticClass:"aside-tree-node-simple-debug",attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.showSimpleDebugWindow(s.dataSource)}}},[a("i",{staticClass:"fa fa-fw fa-window-restore"}),e._v(" "+e._s(e.$t("Open Simple Debug Panel"))+"\n          ")]):e._e(),e._v(" "),a("el-button",{attrs:{slot:"reference",type:"text"},on:{click:function(t){return t.stopPropagation(),e.showPopover(s.id)}},slot:"reference"},[a("i",{staticClass:"fa fa-fw fa-question-circle"})])],2):e._e()],1):e._e()])}}])}),e._v(" "),a("SimpleDebugWindow",{ref:"simpleDebugWindow"})],1)},w=[],S=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.show&&e.dataSource?a("div",{staticClass:"simple-debug-window",style:{top:e.showPosition.top+"px",left:e.showPosition.left+"px"},attrs:{id:"simpleDebugWindow"}},[a("div",{staticClass:"simple-debug-header",on:{mousedown:e.startDrag}},[a("span",{staticClass:"simple-debug-title"},[a("el-tag",{attrs:{type:e.DATA_SOURCE_DEBUGGER_META_MAP[e.dataSource.type].tagType,size:"mini"}},[a("span",[e._v(e._s(e.DATA_SOURCE_DEBUGGER_META_MAP[e.dataSource.type].name))])]),e._v(" "),a("span",{class:{builtin:e.dataSource.isBuiltin}},[e._v(e._s(e.dataSource.title||e.dataSource.id))])],1),e._v(" "),a("el-link",{staticClass:"simple-debug-close",on:{click:function(t){return t.stopPropagation(),e.hideWindow()}},nativeOn:{mousedown:function(e){e.stopPropagation()}}},[a("i",{staticClass:"fa fa-times"}),e._v(" 关闭")])],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.isDragging,expression:"isDragging"}],staticClass:"simple-debug-dragging-cover"},[a("span",{staticClass:"simple-debug-dragging-cover-tip"},[e._v("调整位置...")])]),e._v(" "),a("el-tabs",{class:{"simple-debug-window-fade":e.isDragging},attrs:{"tab-position":"bottom",type:"border-card"},model:{value:e.selectedTab,callback:function(t){e.selectedTab=t},expression:"selectedTab"}},[e.DATA_SOURCE_DEBUGGER_META_MAP[e.dataSource.type].supportBrowser?a("el-tab-pane",{attrs:{label:"数据结构浏览",name:"browser"}},[a("div",{staticClass:"simple-debug-browser"},[e.browserCascaderErrorMessage?a("el-link",{attrs:{type:"danger",underline:!1}},[e._v("\n          获取数据源信息失败，请检查数据源配置是否正确。\n          "),a("br"),e._v("错误信息如下：\n          "),a("pre",{staticClass:"simple-debug-browser-error"},[e._v(e._s(e.browserCascaderErrorMessage))]),e._v("\n          请关闭本面板后重新尝试\n          "),a("br"),e._v("如问题反复出现，可能是由于数据源配置改变而无法连接\n        ")]):a("el-form",[a("el-form-item",[a("el-cascader-panel",{ref:"browserCascader",staticClass:"simple-debug-browser-cascader",attrs:{placeholder:"--",size:"mini",props:e.browserCascaderProps},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,s=t.data;return a("div",{staticClass:"simple-debug-browser-cascader-item",on:{click:function(t){return e.updateCodeExample(r)}}},[s.showDefaultTag?a("el-tag",{attrs:{plain:"",size:"mini"}},[e._v("默认")]):e._e(),e._v(" "),s.dbTag?a("el-tag",{attrs:{plain:"",type:s.dbTag.type,size:"mini"}},[e._v(e._s(s.dbTag.title))]):e._e(),e._v(" "),a("span",{class:{"text-bad":s.isError}},[e._v(e._s(s.label||s.value))]),e._v(" "),s.itemCount?a("span",[e._v(" ("+e._s(s.itemCount)+") ")]):e._e()],1)}}],null,!1,2602145171)})],1),e._v(" "),a("el-form-item",[a("pre",{staticClass:"simple-debug-browser-example-code",attrs:{rows:"2"}},[e._v(e._s(e.browserCascaderExampleCode))]),e._v(" "),a("div",{staticClass:"simple-debug-browser-example-code-edit"},[a("i",{staticClass:"fa fa-fw fa-terminal text-main"})]),e._v(" "),a("CopyButton",{directives:[{name:"show",rawName:"v-show",value:e.browserCascaderExampleCode,expression:"browserCascaderExampleCode"}],staticClass:"simple-debug-browser-example-code-copy",attrs:{content:e.browserCascaderExampleCode}})],1)],1)],1)]):e._e(),e._v(" "),e.DATA_SOURCE_DEBUGGER_META_MAP[e.dataSource.type].supportDebugger?a("el-tab-pane",{attrs:{label:e.DATA_SOURCE_DEBUGGER_META_MAP[e.dataSource.type].debuggerName,name:"debugger"}},[a("div",{directives:[{name:"loading",rawName:"v-loading.lock",value:e.isQuerying,expression:"isQuerying",modifiers:{lock:!0}}],staticClass:"simple-debug-sql",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-text":"查询执行中，最多等待 5 秒，长时间无响应后再尝试刷新页面"}},[a("el-form",[a("el-form-item",[a("el-input",{attrs:{type:"textarea",resize:"none",rows:"3"},model:{value:e.latestQueryOptionsMap[e.dataSource.id].queryStatement,callback:function(t){e.$set(e.latestQueryOptionsMap[e.dataSource.id],"queryStatement",t)},expression:"latestQueryOptionsMap[dataSource.id].queryStatement"}})],1),e._v(" "),a("el-form-item",[e.DATA_SOURCE_DEBUGGER_META_MAP[e.dataSource.type].supportDatabase?[a("span",[e._v("数据库")]),e._v(" "),e.dataSource.configJSON.database?a("el-input",{staticClass:"simple-debug-database",attrs:{size:"mini",disabled:!0,value:e.dataSource.configJSON.database}}):a("el-input",{staticClass:"simple-debug-database",attrs:{size:"mini"},model:{value:e.latestQueryOptionsMap[e.dataSource.id].database,callback:function(t){e.$set(e.latestQueryOptionsMap[e.dataSource.id],"database",t)},expression:"latestQueryOptionsMap[dataSource.id].database"}})]:e._e(),e._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:function(t){return t.stopPropagation(),e.queryDataSource(e.latestQueryOptionsMap[e.dataSource.id])}}},[a("i",{staticClass:"fa fa-fw fa-play"}),e._v(" 执行\n            ")]),e._v(" "),e.latestQueryResultMap[e.dataSource.id]&&e.latestQueryResultMap[e.dataSource.id].ok?a("div",{staticClass:"simple-debug-copy-content"},[a("CopyButton",{attrs:{tipPlacement:"bottom",title:"查询语句",content:e.latestQueryOptionsMap[e.dataSource.id].queryStatement}}),e._v("\n               \n              "),a("CopyButton",{attrs:{tipPlacement:"bottom",title:"代码",content:e.latestQueryOptionsMap[e.dataSource.id].queryCode}}),e._v("\n               \n              "),a("CopyButton",{attrs:{tipPlacement:"bottom",title:"结果",content:e.latestQueryResultMap[e.dataSource.id].data}})],1):e._e()],2),e._v(" "),a("el-form-item",[a("pre",{staticClass:"simple-debug-result",class:{"simple-debug-query-failed":e.latestQueryResultMap[e.dataSource.id]&&!e.latestQueryResultMap[e.dataSource.id].ok},attrs:{rows:"5"}},[e._v(e._s(e.latestQueryResultMap[e.dataSource.id]&&e.latestQueryResultMap[e.dataSource.id].data||"执行后在此显示结果"))])])],1)],1)]):e._e()],1)],1):e._e()},C=[],T=(a("b2a3"),a("cf91"),a("da83"),a("88e0"),a("2df5")),x=a.n(T),k={name:"SimpleDebugWindow",components:{},watch:{dataSource:function(e){this.$refs.browserCascader&&(this.$refs.browserCascader.clearCheckedNodes(),this.$refs.browserCascader.initStore(),this.browserCascaderExampleCode="")}},methods:{showWindow:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var r,s,i,n,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.browserCascaderErrorMessage="",r=t.DATA_SOURCE_DEBUGGER_META_MAP[e.type],r.supportDebugger&&(s=r.command,i=r.exampleCommandArgs,t.latestQueryOptionsMap[e.id]||(n="helper = DFF.SRC('".concat(e.id,"')"),o="helper.".concat(s,"('").concat(i.join("', '"),"')"),t.$set(t.latestQueryOptionsMap,e.id,{database:e.database,queryStatement:i.join(" "),queryCode:"".concat(n,"\n").concat(o)}))),t.show||t.$message({type:"warning",duration:3e3,message:"简易调试窗口仅在数据源侧边栏激活时显示，拖拽标题栏可以移动位置"}),t.dataSource=e,t.show=!0,r.supportBrowser?t.selectedTab="browser":r.supportDebugger&&(t.selectedTab="debugger"),setImmediate((function(){t.fixShowPosition()}));case 8:case"end":return a.stop()}}),a)})))()},hideWindow:function(){this.show=!1},startDrag:function(e){var t=this,a=document.getElementById("simpleDebugWindow"),r=e.screenX-a.offsetLeft,s=e.screenY-a.offsetTop;this.isDragging=!0,document.onmousemove=function(i){var n=(i||e).screenX-r,o=(i||e).screenY-s,d=window.innerWidth-a.offsetWidth-10,c=window.innerHeight-a.offsetHeight-10;n<0&&(n=0),o<0&&(o=0),n>d&&(n=d),o>c&&(o=c);var l={left:n,top:o};t.dragPosition=l,t.$store.commit("updateAsideDataSource_simpleDebugWindowPosition",t.dragPosition),t.fixShowPosition()},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null,t.isDragging=!1}},fixShowPosition:function(){var e={top:this.dragPosition.top,left:this.dragPosition.left},t=document.getElementById("simpleDebugWindow");if(t){var a=window.innerWidth-t.offsetWidth-10,r=window.innerHeight-t.offsetHeight-10;e.left<0&&(e.left=0),e.top<0&&(e.top=0),e.left>a&&(e.left=a),e.top>r&&(e.top=r),this.showPosition=e}},queryDataSource:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var r,s,i,n,o,d,c,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.isQuerying=!0,a.next=3,t.T.callAPI("post","/api/v1/data-sources/:id/do/query",{params:{id:t.dataSource.id},body:{database:e.database,queryStatement:e.queryStatement,returnType:"repr"},alert:{muteError:!0},extraOptions:{noCountProcessing:!0}});case 3:if(r=a.sent,s={ok:r.ok},!r.ok){a.next=33;break}s.data="# pprint.pprint(db_res)\n"+r.data,i=t.DATA_SOURCE_DEBUGGER_META_MAP[t.dataSource.type].command,n=null,o="",d="",a.t0=t.dataSource.type,a.next="influxdb"===a.t0?14:"mysql"===a.t0||"clickhouse"===a.t0||"oracle"===a.t0||"sqlserver"===a.t0||"postgresql"===a.t0?17:"redis"===a.t0||"memcached"===a.t0?20:"elasticsearch"===a.t0?25:28;break;case 14:return n=[e.queryStatement],d="if len(db_res.get('series', [])) > 0:\n    for d in db_res['series'][0]['values']:\n        # 循环处理\n        pass",a.abrupt("break",28);case 17:return n=[e.queryStatement],d="for d in db_res:\n    # 循环处理\n    pass",a.abrupt("break",28);case 20:return n=x()(e.queryStatement),o=r.data+"",t.validator.isInt(o)?d="db_res = int(db_res)\n":t.validator.isFloat(o)&&(d="db_res = float(db_res)\n"),d+="\n# 进一步处理",a.abrupt("break",28);case 25:return n=[e.queryStatement],d+="\n# 进一步处理",a.abrupt("break",28);case 28:c="helper = DFF.SRC('".concat(t.dataSource.id,"')"),l="db_res = helper.".concat(i,"('").concat((n||[]).join("', '"),"')"),t.$set(t.latestQueryOptionsMap,t.dataSource.id,{database:e.database,queryStatement:e.queryStatement,queryCode:"".concat(c,"\n").concat(l,"\n").concat(d)}),a.next=35;break;case 33:s.data="查询执行失败";try{s.data+="\n"+r.detail.error}catch(u){}case 35:t.$set(t.latestQueryResultMap,t.dataSource.id,s),t.isQuerying=!1;case 37:case"end":return a.stop()}}),a)})))()},browserDataLoader:function(e,t){var a=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var s,i,n,o,d,c,l,u,p,f,b,m,h,_;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!e.isLeaf){r.next=2;break}return r.abrupt("return",t());case 2:if(s=a.DATA_SOURCE_DEBUGGER_META_MAP[a.dataSource.type],s.browsers){r.next=5;break}return r.abrupt("return",t());case 5:if(i=[],e.root){r.next=18;break}n=e,o=0;case 9:if(!(o<10)){r.next=17;break}if(n&&!n.root&&n.data){r.next=12;break}return r.abrupt("break",17);case 12:i.push(n.data),n=n.parent;case 14:o++,r.next=9;break;case 17:i.reverse();case 18:d=s.browsers,c=0;case 20:if(!(c<e.level)){r.next=38;break}r.t0=d.type,r.next="static"===r.t0?24:"query"===r.t0||"api"===r.t0?33:35;break;case 24:l=0;case 25:if(!(l<d.data.length)){r.next=32;break}if(d.data[l].value!==i[c].value){r.next=29;break}return d=d.data[l].sub,r.abrupt("break",32);case 29:l++,r.next=25;break;case 32:return r.abrupt("break",35);case 33:return d=d.sub,r.abrupt("break",35);case 35:c++,r.next=20;break;case 38:u=function(e,t,a){return e?(i.forEach((function(t){t.ref&&t.value&&(e=e.replace("{".concat(t.ref,"}"),t.value))})),t&&a&&(e=e.replace("{".concat(t,"}"),a)),e):null},p=null,f=[],r.t1=d.type,r.next="static"===r.t1?44:"query"===r.t1?46:"api"===r.t1?86:97;break;case 44:return d.data.forEach((function(e){f.push({label:e.label,value:e.value,ref:e.ref,leaf:!e.sub,example:u(e.example,e.ref,e.value),defaultExample:u(e.defaultExample,e.ref,e.value)})})),r.abrupt("break",97);case 46:return b=u(d.query),r.next=49,a.T.callAPI("post","/api/v1/data-sources/:id/do/query",{params:{id:a.dataSource.id},body:{database:a.dataSource.configJSON.database,queryStatement:b,returnType:"json"},extraOptions:{noCountProcessing:!0}});case 49:if(p=r.sent,p.ok){r.next=53;break}return e.root?a.browserCascaderErrorMessage=p.message:t([{label:"查询失败",value:null,leaf:!0,disabled:!0,isError:!0}]),r.abrupt("return");case 53:r.t2=a.dataSource.type,r.next="influxdb"===r.t2?56:"mysql"===r.t2?58:"redis"===r.t2?60:"clickhouse"===r.t2?62:"oracle"===r.t2?64:"sqlserver"===r.t2?66:"postgresql"===r.t2?68:"mongodb"===r.t2?70:"elasticsearch"===r.t2?72:84;break;case 56:return p.data.series&&p.data.series.length>0&&p.data.series[0].values.forEach((function(e){f.push({value:e[0]})})),r.abrupt("break",85);case 58:return p.data.forEach((function(e){switch(d.ref){case"database":f.push({value:e["Database"]});break;case"table":f.push({value:Object.values(e)[0]});break;case"field":f.push({value:e["Field"]});break;default:break}})),r.abrupt("break",85);case 60:return p.data[1].forEach((function(e){f.push({value:e})})),r.abrupt("break",85);case 62:return p.data.forEach((function(e){switch(d.ref){case"database":case"table":f.push({value:e["name"]});break;case"field":f.push({value:e["name"]});break;default:break}})),r.abrupt("break",85);case 64:return p.data.forEach((function(e){switch(d.ref){case"owner":f.push({value:e["OWNER"]});break;case"table":f.push({value:e["TABLE_NAME"]});break;case"field":f.push({value:e["COLUMN_NAME"]});break;default:break}})),r.abrupt("break",85);case 66:return p.data.forEach((function(e){switch(d.ref){case"database":f.push({value:e["name"]});break;case"table":f.push({value:e["TABLE_NAME"]});break;case"field":f.push({value:e["COLUMN_NAME"]});break;default:break}})),r.abrupt("break",85);case 68:return p.data.forEach((function(e){switch(d.ref){case"database":f.push({value:e["current_database"]});break;case"schema":f.push({value:e["schemaname"]});break;case"table":f.push({value:e["tablename"]});break;case"field":f.push({value:e["attname"]});break;default:break}})),r.abrupt("break",85);case 70:return p.data.forEach((function(e){switch(d.ref){case"database":case"collection":f.push({value:e});break}})),r.abrupt("break",85);case 72:r.t3=d.ref,r.next="index"===r.t3?75:"field"===r.t3?77:82;break;case 75:return p.data.forEach((function(e){f.push({value:e["index"]})})),r.abrupt("break",83);case 77:m=[];try{m=Object.keys(Object.values(p.data)[0]["mappings"]["properties"])}catch(E){}return m.forEach((function(e){f.push({value:e})})),r.abrupt("break",83);case 82:return r.abrupt("break",83);case 83:return r.abrupt("break",85);case 84:return r.abrupt("break",85);case 85:return r.abrupt("break",97);case 86:return r.next=88,a.T.callAPI_get(d.api,{extraOptions:{noCountProcessing:!0}});case 88:if(p=r.sent,p.ok){r.next=92;break}return e.root?a.browserCascaderErrorMessage=p.message:t([{label:"查询失败",value:null,leaf:!0,disabled:!0,isError:!0}]),r.abrupt("return");case 92:r.t4=a.dataSource.type,r.next=95;break;case 95:return r.abrupt("break",96);case 96:return r.abrupt("break",97);case 97:r.t5=d.type,r.next="api"===r.t5||"query"===r.t5?100:(r.t5,102);break;case 100:return f.forEach((function(e){e.ref=d.ref,e.leaf=!d.sub,e.example=u(d.example,e.ref,e.value),e.defaultExample=u(d.defaultExample,e.ref,e.value)})),r.abrupt("break",103);case 102:return r.abrupt("break",103);case 103:return f.forEach((function(e){e.isDefaultDatabase="database"===e.ref&&e.value===a.dataSource.configJSON.database,e.isDefaultDatabase||i.forEach((function(t){"database"===t.ref&&t.value===a.dataSource.configJSON.database&&(e.isDefaultDatabase=!0)})),e.isDefaultDatabase&&"database"===e.ref&&(e.showDefaultTag=!0)})),h=f.length,_=d.title||"",_&&h>0&&(_="".concat(_," (").concat(h,")")),f.unshift({label:_,value:null,leaf:!0,disabled:!0,isTitle:!0}),e.root||a.$set(e.data,"itemCount",h),r.abrupt("return",t(f));case 110:case"end":return r.stop()}}),r)})))()},updateCodeExample:function(e){this.browserCascaderExampleCode=e.data.isDefaultDatabase&&e.data.defaultExample||e.data.example}},computed:{DATA_SOURCE_DEBUGGER_META_MAP:function(){for(var e={title:"键（部分）",type:"query",query:'SCAN 0 MATCH "{pattern}" COUNT 100',example:'TYPE "{key}"',ref:"key"},t={title:"首字母",type:"static",data:[]},a=[],r="a".charCodeAt();r<="z".charCodeAt();r++){var s=String.fromCharCode(r);t.data.push({label:"".concat(s).concat(s.toUpperCase()),value:"[".concat(s.toUpperCase()).concat(s,"]*"),example:'SCAN 0 MATCH "{pattern}" COUNT 100',ref:"pattern",sub:e}),a.push("".concat(s.toUpperCase()).concat(s))}return t.data.push({label:"其他",value:"[^".concat(a.join(),"]*"),example:'SCAN 0 MATCH "{pattern}" COUNT 100',ref:"pattern",sub:e}),{df_dataway:{name:"观测云DataWay",supportDebugger:!1,supportBrowser:!1,supportDatabase:!1,tagType:"info"},influxdb:{name:"InfluxDB",supportDebugger:!0,supportBrowser:!0,supportDatabase:!0,tagType:null,command:"query",exampleCommandArgs:["SELECT * FROM some_measurement LIMIT 10"],debuggerName:"SQL 调试",browsers:{title:"数据库",type:"query",query:"SHOW DATABASES",example:'SHOW MEASUREMENTS ON "{database}"',defaultExample:"SHOW MEASUREMENTS",ref:"database",sub:{title:"数据项",type:"static",data:[{value:"指标",example:'SHOW MEASUREMENTS ON "{database}"',defaultExample:"SHOW MEASUREMENTS",sub:{title:"指标",type:"query",query:'SHOW MEASUREMENTS ON "{database}"',example:'SELECT * FROM "{database}".."{measurement}"',defaultExample:'SELECT * FROM "{measurement}"',ref:"measurement",sub:{type:"static",data:[{value:"标签",example:'SHOW TAG KEYS ON "{database}" FROM "{measurement}"',defaultExample:'SHOW TAG KEYS FROM "{measurement}"',sub:{title:"标签",type:"query",query:'SHOW TAG KEYS ON "{database}" FROM "{measurement}"',example:'SELECT * FROM "{database}".."{measurement}" WHERE "{tagKey}" = \'标签值\'',defaultExample:'SELECT * FROM "{measurement}" WHERE "{tagKey}" = \'标签值\'',ref:"tagKey"}},{value:"字段",example:'SHOW FIELD KEYS ON "{database}" FROM "{measurement}"',defaultExample:'SHOW FIELD KEYS FROM "{measurement}"',sub:{title:"字段",type:"query",query:'SHOW FIELD KEYS ON "{database}" FROM "{measurement}"',example:'SELECT "{fieldKey}" FROM "{database}".."{measurement}"',defaultExample:'SELECT "{fieldKey}" FROM "{measurement}"',ref:"fieldKey"}}]}}},{value:"保留策略",example:'SHOW RETENTION POLICIES ON "{database}"',defaultExample:"SHOW RETENTION POLICIES",sub:{title:"保留策略",type:"query",query:'SHOW RETENTION POLICIES ON "{database}"',example:'SELECT * FROM "{database}"."{retentionPolicy}"."指标"',ref:"retentionPolicy"}}]}}},mysql:{name:"MySQL",supportDebugger:!0,supportBrowser:!0,supportDatabase:!0,tagType:"success",command:"query",exampleCommandArgs:["SELECT * FROM `some_table` LIMIT 10"],debuggerName:"SQL 调试",browsers:{title:"数据库",type:"query",query:"SHOW DATABASES",example:"SHOW TABLES FROM `{database}`",defaultExample:"SHOW TABLES",ref:"database",sub:{title:"表",type:"query",query:"SHOW TABLES FROM `{database}`",example:"SELECT * FROM `{database}`.`{table}`",defaultExample:"SELECT * FROM `{table}`",ref:"table",sub:{title:"字段",type:"query",query:"SHOW FULL COLUMNS FROM `{table}` FROM `{database}`",example:"SELECT `{field}` FROM `{database}`.`{table}`",defaultExample:"SELECT `{field}` FROM `{table}`",ref:"field"}}}},redis:{name:"Redis",supportDebugger:!0,supportBrowser:!0,supportDatabase:!0,tagType:"danger",command:"query",exampleCommandArgs:["SCAN","0","COUNT","10"],debuggerName:"命令调试",browsers:t},memcached:{name:"Memcached",supportDebugger:!0,supportBrowser:!1,supportDatabase:!1,tagType:"success",command:"query",exampleCommandArgs:["GET","key"],debuggerName:"命令调试"},clickhouse:{name:"ClickHouse",supportDebugger:!0,supportBrowser:!0,supportDatabase:!0,tagType:"warning",command:"query",exampleCommandArgs:["SELECT * FROM some_table LIMIT 10"],debuggerName:"SQL 调试",browsers:{title:"数据库",type:"query",query:"SHOW DATABASES",example:"SHOW TABLES FROM `{database}`",defaultExample:"SHOW TABLES",ref:"database",sub:{title:"表",type:"query",query:"SHOW TABLES FROM `{database}`",example:"SELECT * FROM `{database}`.`{table}`",defaultExample:"SELECT * FROM `{table}`",ref:"table",sub:{title:"字段",type:"query",query:"DESCRIBE TABLE `{database}`.`{table}`",example:"SELECT `{field}` FROM `{database}`.`{table}`",defaultExample:"SELECT `{field}` FROM `{table}`",ref:"field"}}}},oracle:{name:"Oracle",supportDebugger:!0,supportBrowser:!0,supportDatabase:!0,tagType:"danger",command:"query",exampleCommandArgs:["SELECT * FROM SOME_TABLE WHERE ROWNUM <= 10"],debuggerName:"SQL 调试",browsers:{title:"用户",type:"query",query:"SELECT DISTINCT OWNER FROM ALL_TABLES",example:"SELECT TABLE_NAME FROM ALL_TABLES WHERE OWNER = '{owner}'",defaultExample:"SELECT TABLE_NAME FROM ALL_TABLES WHERE OWNER = '{owner}'",ref:"owner",sub:{title:"表",type:"query",query:"SELECT TABLE_NAME FROM ALL_TABLES WHERE OWNER = '{owner}'",example:"SELECT * FROM {owner}.{table}",defaultExample:"SELECT * FROM {table}",ref:"table",sub:{title:"字段",type:"query",query:"SELECT COLUMN_NAME FROM ALL_TAB_COLUMNS WHERE OWNER = '{owner}' AND TABLE_NAME = '{table}'",example:"SELECT {field} FROM {owner}.{table}",defaultExample:"SELECT {field} FROM {table}",ref:"field"}}}},sqlserver:{name:"SQLServer",supportDebugger:!0,supportBrowser:!0,supportDatabase:!0,tagType:"info",command:"query",exampleCommandArgs:["SELECT TOP 10 * FROM some_table"],debuggerName:"SQL 调试",browsers:{title:"数据库",type:"query",query:"SELECT [name] FROM [master].[dbo].[sysdatabases]",example:"SELECT [TABLE_NAME] FROM [{database}].[INFORMATION_SCHEMA].[TABLES] WHERE [TABLE_TYPE] = 'BASE TABLE'",defaultExample:"SELECT [TABLE_NAME] FROM [INFORMATION_SCHEMA].[TABLES] WHERE [TABLE_TYPE] = 'BASE TABLE'",ref:"database",sub:{title:"表",type:"query",query:"SELECT [TABLE_NAME] FROM [{database}].[INFORMATION_SCHEMA].[TABLES] WHERE [TABLE_TYPE] = 'BASE TABLE'",example:"SELECT * FROM [{database}].[dbo].[{table}]",defaultExample:"SELECT * FROM [{table}]",ref:"table",sub:{title:"字段",type:"query",query:"SELECT [COLUMN_NAME] FROM [{database}].[INFORMATION_SCHEMA].[COLUMNS] WHERE [TABLE_NAME] = '{table}'",example:"SELECT [{field}] FROM [{database}].[dbo].[{table}]",defaultExample:"SELECT [{field}] FROM [{table}]",ref:"field"}}}},postgresql:{name:"PostgreSQL",supportDebugger:!0,supportBrowser:!0,supportDatabase:!0,tagType:"info",command:"query",exampleCommandArgs:["SELECT * FROM some_table LIMIT 10"],debuggerName:"SQL 调试",browsers:{title:"数据库",type:"query",query:"SELECT current_database()",example:'SELECT "tablename" FROM "pg_tables" WHERE "schemaname" = \'public\'',defaultExample:'SELECT "tablename" FROM "pg_tables" WHERE "schemaname" = \'public\'',ref:"database",sub:{title:"Schema",type:"query",query:'SELECT DISTINCT "schemaname" FROM "pg_tables" GROUP BY "schemaname" ORDER BY "schemaname"',example:'SELECT "tablename" FROM "pg_tables" WHERE "schemaname" = \'public\'',defaultExample:'SELECT "tablename" FROM "pg_tables" WHERE "schemaname" = \'public\'',ref:"schema",sub:{title:"表",type:"query",query:'SELECT "tablename" FROM "pg_tables" WHERE "schemaname" = \'{schema}\'',example:'SELECT * FROM "{schema}"."{table}"',defaultExample:'SELECT * FROM "{table}"',ref:"table",sub:{title:"字段",type:"query",query:'SELECT "A"."attname" FROM "pg_class" AS "C", "pg_attribute" AS "A" WHERE "A"."attrelid" = "C"."oid" AND "A"."attnum" > 0 AND "C"."relname" = \'{table}\'',example:'SELECT "{field}" FROM "{schema}"."{table}"',defaultExample:'SELECT "{field}" FROM {table}"',ref:"field"}}}}},mongodb:{name:"mongoDB",supportDebugger:!1,supportBrowser:!0,supportDatabase:!1,tagType:"success",command:"query",exampleCommandArgs:["GET /_search?q=field:value"],debuggerName:"URI Query 调试",browsers:{title:"数据库",type:"query",query:'{"method": "list_database_names"}',example:"# Python\ndata = helper.db('{database}')",defaultExample:"# Python\ndata = helper.db()",ref:"database",sub:{title:"集合",type:"query",query:'{"method": "list_collection_names", "db_name": "{database}"}',example:"# Python\ndata = helper.db('{database}')['{collection}'].find_one()",defaultExample:"# Python\ndata = helper.db()['{collection}'].find_one()",ref:"collection"}}},elasticsearch:{name:"ES",supportDebugger:!0,supportBrowser:!0,supportDatabase:!1,tagType:"success",command:"query",exampleCommandArgs:["GET /_search?q=field:value"],debuggerName:"URI Query 调试",browsers:{title:"索引",type:"query",query:"GET /_cat/indices",example:"GET /{index}/_search",defaultExample:"GET /{index}/_search",ref:"index",sub:{title:"字段",type:"query",query:"GET /{index}/_mapping",example:"GET /{index}/_search?q={field}:something",defaultExample:"GET /{index}/_search?q={field}:something",ref:"field"}}}}}},props:{},data:function(){var e=this.$store.state.asideDataSource_simpleDebugWindowPosition||{left:10,bottom:10};return{show:!1,isQuerying:!1,selectedTab:"browser",showPosition:this.T.jsonCopy(e),dragPosition:this.T.jsonCopy(e),isDragging:!1,dataSource:{},latestQueryOptionsMap:{},latestQueryResultMap:{},browserCascaderProps:{lazy:!0,lazyLoad:this.browserDataLoader},browserCascaderExampleCode:"",browserCascaderErrorMessage:""}},mounted:function(){window.addEventListener("resize",this.fixShowPosition,!1)},destroyed:function(){window.removeEventListener("resize",this.fixShowPosition,!1)}},M=k,O=(a("316f"),a("1d9a"),a("ebd4")),A=Object(p["a"])(M,S,C,!1,null,"3200b670",null);"function"===typeof O["default"]&&Object(O["default"])(A);var D=A.exports,L={name:"AsideDataSource",components:{SimpleDebugWindow:D},watch:{$route:function(){this.showPopoverId=null},filterText:function(e){this.$refs.tree.filter(e)},"$store.state.dataSourceListSyncTime":function(){this.loadData()}},methods:{filterNode:function(e,t){if(!e)return!0;if(["addDataSource","refresh"].indexOf(t.type)>=0)return!0;var a=(""+e).toLowerCase(),r=(""+t.searchTEXT).toLowerCase();return r.indexOf(a)>=0},loadData:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.T.callAPI_getAll("/api/v1/data-sources/do/list",{query:{fields:["id","title","description","type","configJSON","isBuiltin"]}});case 3:if(a=t.sent,a.ok){t.next=6;break}return t.abrupt("return");case 6:r=[],window._DFF_dataSourceIds=[],a.data.forEach((function(t){window._DFF_dataSourceIds.push(t.id),t.description=e.T.limitLines(t.description,10);var a=e.T.strf(e.C.DATA_SOURCE_MAP.get(t.type).sampleCode,t.id);r.push({id:t.id,label:t.title||t.id,type:"dataSource",dataSourceType:t.type,isBuiltin:t.isBuiltin,searchTEXT:"".concat(t.title," ").concat(t.type," ").concat(t.id),title:t.title,description:t.description,sampleCode:a,dataSource:t})})),r.sort(e.T.asideItemSorter),r.unshift({type:"addDataSource"}),r.unshift({type:"refresh"}),e.loading=!1,e.data=r;case 14:case"end":return t.stop()}}),t)})))()},showSimpleDebugWindow:function(e){this.$refs.simpleDebugWindow.showWindow(e)},showPopover:function(e){var t=this;setImmediate((function(){t.showPopoverId=e}))},openEntity:function(e,t,a){switch("setup"===a&&this.$refs.tree.setCurrentKey(t.id),t.type){case"refresh":this.loadData();break;case"addDataSource":this.$router.push({name:"data-source-add"});break;case"dataSource":this.$router.push({name:"data-source-setup",params:{id:t.id}});break;default:console.error("Unexcepted data type: ".concat(t.type));break}}},props:{},data:function(){return{loading:!1,filterText:"",data:[],showPopoverId:null}},created:function(){this.loadData()}},P=L,R=(a("eef6"),a("5ff8")),N=Object(p["a"])(P,g,w,!1,null,"2987538b",null);"function"===typeof R["default"]&&Object(R["default"])(N);var I=N.exports,q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-input",{attrs:{placeholder:e.$t("filter content"),size:"small",clearable:!0},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}},[a("el-button",{attrs:{slot:"prefix",type:"text"},slot:"prefix"})],1),e._v(" "),a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tree",attrs:{data:e.data,"filter-node-method":e.filterNode,"highlight-current":!0,indent:10,"node-key":"id"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,s=t.data;return a("span",{staticClass:"aside-tree-node",on:{click:function(t){return e.openEntity(r,s)}}},[a("span",["refresh"===s.type?a("el-link",{attrs:{type:"primary",underline:!1}},[a("i",{staticClass:"fa fa-fw fa-refresh"}),e._v(" "+e._s(e.$t("Refresh"))+"\n        ")]):"addEnvVariable"===s.type?a("el-link",{attrs:{type:"primary",underline:!1}},[a("i",{staticClass:"fa fa-fw fa-plus"}),e._v(" "+e._s(e.$t("Add ENV"))+"\n        ")]):a("div",[a("span",[e._v(e._s(r.label))])])],1),e._v(" "),a("div",["envVariable"===s.type?a("div",[a("el-tooltip",{attrs:{effect:"dark",content:e.$t("Setup"),placement:"top",enterable:!1}},[a("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.openEntity(r,s,"setup")}}},[a("i",{staticClass:"fa fa-fw fa-wrench text-info"})])],1),e._v(" "),s.id?a("el-popover",{attrs:{placement:"right-start",trigger:"click","popper-class":"aside-tip",value:e.showPopoverId===s.id}},[a("div",{staticClass:"aside-tree-node-description"},[a("code",[e._v(e._s(s.title||s.id))]),e._v(" "),s.description?a("pre",[e._v(e._s(s.description))]):e._e()]),e._v(" "),s.sampleCode?[a("div",{staticClass:"aside-tree-node-sample-code"},[e._v("\n                "+e._s(e.$t("Example"))+e._s(e.$t(":"))+"\n                "),a("pre",[e._v(e._s(s.sampleCode))])])]:e._e(),e._v(" "),a("br"),a("CopyButton",{attrs:{title:e.$t("Copy {name} ID",{name:e.C.ASIDE_ITEM_TYPE_MAP.get(s.type).name}),content:s.id}}),e._v(" "),a("br"),s.sampleCode?a("CopyButton",{attrs:{title:e.$t("Copy example"),content:s.sampleCode}}):e._e(),e._v(" "),a("el-button",{attrs:{slot:"reference",type:"text"},on:{click:function(t){return t.stopPropagation(),e.showPopover(s.id)}},slot:"reference"},[a("i",{staticClass:"fa fa-fw fa-question-circle"})])],2):e._e()],1):e._e()])])}}])})],1)},$=[],B={name:"AsideEnvVariable",components:{},watch:{$route:function(){this.showPopoverId=null},filterText:function(e){this.$refs.tree.filter(e)},"$store.state.envVariableListSyncTime":function(){this.loadData()}},methods:{filterNode:function(e,t){if(!e)return!0;if(["addEnvVariable","refresh"].indexOf(t.type)>=0)return!0;var a=(""+e).toLowerCase(),r=(""+t.searchTEXT).toLowerCase();return r.indexOf(a)>=0},loadData:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.T.callAPI_getAll("/api/v1/env-variables/do/list",{query:{fields:["id","title","description"]}});case 3:if(a=t.sent,a.ok){t.next=6;break}return t.abrupt("return");case 6:r=[],window._DFF_envVariableIds=[],a.data.forEach((function(t){window._DFF_envVariableIds.push(t.id),t.description=e.T.limitLines(t.description);var a="".concat(t.id," = DFF.ENV('").concat(t.id,"')");r.push({id:t.id,label:t.title||t.id,type:"envVariable",searchTEXT:"".concat(t.title," ").concat(t.id),title:t.title,description:t.description,sampleCode:a})})),r.sort(e.T.asideItemSorter),r.unshift({type:"addEnvVariable"}),r.unshift({type:"refresh"}),e.loading=!1,e.data=r;case 14:case"end":return t.stop()}}),t)})))()},showPopover:function(e){var t=this;setImmediate((function(){t.showPopoverId=e}))},openEntity:function(e,t,a){switch("setup"===a&&this.$refs.tree.setCurrentKey(t.id),t.type){case"refresh":this.loadData();break;case"addEnvVariable":this.$router.push({name:"env-variable-add"});break;case"envVariable":this.$router.push({name:"env-variable-setup",params:{id:t.id}});break;default:console.error("Unexcepted data type: ".concat(t.type));break}}},props:{},data:function(){return{loading:!0,filterText:"",data:[],showPopoverId:null}},created:function(){this.loadData()}},F=B,W=(a("4209"),a("9edc")),U=Object(p["a"])(F,q,$,!1,null,"433b480b",null);"function"===typeof W["default"]&&Object(W["default"])(U);var H=U.exports,V={name:"Editor",components:{AsideScript:v,AsideDataSource:I,AsideEnvVariable:H},watch:{$route:{immediate:!0,handler:function(e,t){var a=["code-editor","code-viewer"];a.indexOf(e.name)>=0?this.transitionName=null:this.transitionName="fade"}},splitPanePercent:function(e){this.resizeVueSplitPane(e)}},methods:{resizeVueSplitPane:function(e){e>this.SPLIT_PANE_MAX_PERCENT?e=this.SPLIT_PANE_MAX_PERCENT:e<this.SPLIT_PANE_MIN_PERCENT&&(e=this.SPLIT_PANE_MIN_PERCENT),this.$refs.vueSplitPane.percent=e,this.debouncedUpdatePanePercent(this.$store,e)}},computed:{SPLIT_PANE_MAX_PERCENT:function(){return 35},SPLIT_PANE_MIN_PERCENT:function(){return 10},currentTabFromRoute:function(){switch(this.$route.name){case"data-source-add":case"data-source-setup":return"aside-data-source";case"env-variable-add":case"env-variable-setup":return"aside-env-variable";default:return"aside-script"}},currentTabIcon:function(){var e=["fa","fa-fw","icon-bg"];switch(this.currentTab){case"aside-script":e.push("fa-file-code-o");break;case"aside-data-source":e.push("fa-database");break;case"aside-env-variable":e.push("fa-cogs");break}return e},splitPanePercent:function(){return this.$store.state.Editor_splitPanePercent||this.$store.getters.DEFAULT_STATE.Editor_splitPanePercent}},data:function(){return{currentTab:null}},created:function(){this.debouncedUpdatePanePercent=this.T.debounce((function(e,t){e.commit("updateEditor_splitPanePercent",t)}),100),this.currentTab=this.currentTabFromRoute},mounted:function(){this.resizeVueSplitPane(this.splitPanePercent)}},Q=V,j=(a("b61f"),a("e578"),a("937d")),z=Object(p["a"])(Q,r,s,!1,null,"0dab523c",null);"function"===typeof j["default"]&&Object(j["default"])(z);t["default"]=z.exports},"5ff8":function(e,t,a){"use strict";var r=a("620a"),s=a.n(r);t["default"]=s.a},"620a":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"zh-CN":{"filter content":"过滤内容","Refresh":"刷新列表","Add Data Source":"添加数据源","Simple Debug Panel":"简易调试面板","View":"查看","Setup":"配置","Example":"示例","Copy example":"复制示例","Copy {name} ID":"复制{name}ID","Open Simple Debug Panel":"打开简易调试面板"}}'),delete e.options._Ctor}},"72c0":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"zh-CN":{"Script Lib":"脚本库","Data Source":"数据源","Env":"环境变量"}}'),delete e.options._Ctor}},"937d":function(e,t,a){"use strict";var r=a("72c0"),s=a.n(r);t["default"]=s.a},"9edc":function(e,t,a){"use strict";var r=a("eb87"),s=a.n(r);t["default"]=s.a},aa16:function(e,t,a){"use strict";a("06a7")},af92:function(e,t,a){},b2a3:function(e,t,a){e.exports=a("7ab4")(1162)},b321:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"zh-CN":{"Drag to place":"调整位置","Published":"已发布","Draft":"草稿"}}'),delete e.options._Ctor}},b61f:function(e,t,a){"use strict";a("146c")},c4dd:function(e,t,a){},ce37:function(e,t,a){"use strict";var r=a("b321"),s=a.n(r);t["default"]=s.a},d178:function(e,t,a){"use strict";var r=a("dc66"),s=a.n(r);t["default"]=s.a},d464:function(e,t,a){},dc66:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"zh-CN":{"filter content":"过滤内容","Refresh":"刷新列表","Add Script":"添加脚本","Add Script Set":"添加脚本集","Edited":"已修改","Builtin":"内置","Locked by someone else":"被其他人锁定","Locked by you":"被您锁定","Quick View Panel":"快速查看面板","View":"查看","Setup":"配置","Copy example":"复制示例","Copy {name} ID":"复制{name}ID","Example":"示例","Code edited but not published yet":"代码已修改但尚未发布","Import/Calling will run the published version":"引用/API调用实际将运行已发布代码","Open Quick View Panel":"打开快速预览面板","Script Set {id}":"脚本集 {id}","Script {id}":"脚本 {id}"}}'),delete e.options._Ctor}},e578:function(e,t,a){"use strict";a("16d6")},e621:function(e,t,a){},eb87:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"zh-CN":{"filter content":"过滤内容","Refresh":"刷新列表","Add ENV":"添加环境变量","Setup":"配置","Example":"示例","Copy example":"复制示例","Copy {name} ID":"复制{name}ID"}}'),delete e.options._Ctor}},ebd4:function(e,t,a){"use strict";var r=a("23e9"),s=a.n(r);t["default"]=s.a},eef6:function(e,t,a){"use strict";a("d464")}}]);